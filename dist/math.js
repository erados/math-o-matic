var math=function(t){var e={};function __webpack_require__(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,r){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)__webpack_require__.d(r,n,function(e){return t[e]}.bind(null,n));return r},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=11)}([function(t,e,r){var n=r(1),a=0;function Node(t){this._id=++a,this.scope=t||null}Node.prototype.error=function(t){return this.scope?this.scope.error(t):new Error(t)},Node.prototype.escapeTeX=function(t){return t.replace(/&|%|\$|#|_|{|}|~|\^|\\/g,t=>({"&":"\\&","%":"\\%",$:"\\$","#":"\\#",_:"\\_","{":"\\{","}":"\\}","~":"\\textasciitilde","^":"\\textasciicircum","\\":"\\textbackslash"}[t]))},Node.prototype.parseTeX=function(t){var e=!1,r=t.replace(/^!<prec=([0-9]+)>/,(t,r)=>(e=1*r,""));return{precedence:e,code:r}},Node.prototype.isProved=function(t){return!!(t=t||[]).some(t=>n.equals(t,this))},Node.prototype.PREC_FUNEXPR=1e3,Node.prototype.PREC_COMMA=1e3,Node.prototype.PREC_COLONEQQ=1e5,Node.prototype.normalizePrecedence=function(t){if(!1===t)return[0,0];if(!0===t)return[2,0];if("number"==typeof t)return[0,t];if(!(t instanceof Array&&2==t.length))throw console.log(t),Error("wut");return t},Node.prototype.shouldConsolidate=function(t){var e=this.normalizePrecedence(this.precedence||!1),r=this.normalizePrecedence(t||!1);return(0!=e[0]||0!=e[1])&&!(e[0]<r[0]||e[0]==r[0]&&e[1]<r[1])},Node.prototype.makeTeX=function(t,e,r){e=e||[],r=r||!1;var n=this.tex;return this.shouldConsolidate(r)&&(n="\\left("+n+"\\right)"),n.replace(/#([0-9]+)/g,(t,r)=>e[1*r-1]||`\\texttt{\\textcolor{red}{\\#${r}}}`).replace(/<<(.+?)>>/,(e,r)=>`\\href{#${t}}{${r}}`)},t.exports=Node},function(t,e){var r,n,a,o,i,s,p={};function iscall(t){return["schemacall","funcall"].includes(t._type)}function callee(t){return"schemacall"==t._type?t.schema:"funcall"==t._type?t.fun:(()=>{throw console.log(t),Error()})()}function makecall(t,e){return"fun"==t._type||"typevar"==t._type?new a({fun:t,args:e}):"schema"==t._type?new s({schema:t,args:e}):(()=>{throw console.log(t),Error()})()}p.init=function(t){t.Type,r=t.Typevar,n=t.Fun,a=t.Funcall,o=t.Tee,t.Ruleset,i=t.Schema,s=t.Schemacall},p.substitute=function(t,e){switch(t._type){case"funcall":var r=p.substitute(t.fun,e),c=t.args.map(t=>p.substitute(t,e));return"schema"==r._type?new s({schema:r,args:c}):new a({fun:r,args:c});case"fun":if(!t.expr)return e.get(t)||t;if(t.name)return e.get(t)||t;if(t.params.some(t=>e.has(t)))throw Error("Parameter collision");return new n({name:null,params:t.params,expr:p.substitute(t.expr,e)});case"typevar":return e.get(t)||t;case"tee":var l=t.left.map(t=>p.substitute(t,e)),u=p.substitute(t.right,e);return new o({left:l,right:u});case"schemacall":return new s({schema:p.substitute(t.schema,e),args:t.args.map(t=>p.substitute(t,e))});case"schema":if(t.name)return t;if(t.params.some(t=>e.has(t)))throw Error("Parameter collision");return new i({axiomatic:t.axiomatic,name:null,params:t.params,expr:p.substitute(t.expr,e)});case"reduction":return p.substitute(t.reduced,e);default:throw Error("Unknown type "+t._type)}},p.call=function(t,e){if(!function iscallable(t){return["schema","fun"].includes(t._type)}(t))throw console.log(t),Error("Illegal type");if(!t.expr)throw Error("Cannot call a callable without a body");if(t.params.length!=e.length)throw Error("Illegal arguments length");for(var r=new Map,n=0;n<t.params.length;n++)r.set(t.params[n],e[n]);return p.substitute(t.expr,r)},p.expandCallOnce=function(t){if(!iscall(t))throw Error("Illegal type");if(iscall(callee(t)))return makecall(p.expandCallOnce(callee(t)),t.args);if(!callee(t).expr)throw Error("Could not expand");return p.call(callee(t),t.args)},p.expand0Funcalls=function(t){if("funcall"==t._type){var e=p.expand0Funcalls(t.fun),r=t.args.map(p.expand0Funcalls);return"fun"!=e._type||e.name?new a({fun:e,args:r}):p.expand0Funcalls(p.call(e,r))}return"fun"!=t._type||t.name?t:new n({name:null,params:t.params,expr:p.expand0Funcalls(t.expr)})},p.expandMeta=function(t){if(t.native)return t;switch(t._type){case"tee":var e=t.left.map(p.expandMeta),r=p.expandMeta(t.right);return new o({left:e,right:r});case"schemacall":var n=p.expandMeta(t.schema),a=t.args;return p.expandMeta(p.call(n,a));case"reduction":return p.expandMeta(t.reduced);case"schema":return new i({axiomatic:t.axiomatic,name:null,params:t.params,expr:p.expandMeta(t.expr)});case"funcall":case"fun":case"typevar":return t;default:throw console.log(t),Error("Unknown metaexpr")}},p.expandMetaAndFuncalls=function(t){switch(t._type){case"tee":var e=t.left.map(p.expandMetaAndFuncalls),r=p.expandMetaAndFuncalls(t.right);return new o({left:e,right:r});case"schemacall":var n=p.expandMetaAndFuncalls(t.schema),a=t.args.map(p.expand0Funcalls);return p.expandMetaAndFuncalls(p.call(n,a));case"reduction":return p.expandMetaAndFuncalls(t.reduced);case"schema":return new i({axiomatic:t.axiomatic,name:null,params:t.params,expr:p.expandMetaAndFuncalls(t.expr)});case"funcall":case"fun":case"typevar":return p.expand0Funcalls(t);default:throw console.log(t),Error("Unknown metaexpr")}},p.nequalscall=p.nequalstrue=p.nrecursecall=p.nrecursetrue=0,p.equals=function(t,e){var n=function recurse(t,e,a){if(t==e)return!0;if(!t.type.equals(e.type))return!1;if("reduction"==t._type)return n(t.reduced,e,a+1);if("reduction"==e._type)return n(t,e.reduced,a+1);if(iscall(t)&&iscall(e)){if(iscall(callee(t)))return n(p.expandCallOnce(t),e,a+1);if(iscall(callee(e)))return n(t,p.expandCallOnce(e),a+1);if(callee(t)==callee(e)||!callee(t).expr&&!callee(e).expr){if(callee(t)!=callee(e))return!1;if(!callee(t).expr&&!callee(e).expr){for(var o=0;o<t.args.length;o++)if(!n(t.args[o],e.args[o],a+1))return!1;return!0}if(t.args.every((r,o)=>n(t.args[o],e.args[o],a+1)))return!0}return callee(t).expr?n(p.expandCallOnce(t),e,a+1):n(t,p.expandCallOnce(e),a+1)}if(iscall(t))return(iscall(callee(t))||!!callee(t).expr)&&n(p.expandCallOnce(t),e,a+1);if(iscall(e))return(iscall(callee(e))||!!callee(e).expr)&&n(t,p.expandCallOnce(e),a+1);if("tee"==t._type){for(o=0;o<t.left.length;o++)if(!n(t.left[o],e.left[o],a+1))return!1;return n(t.right,e.right,a+1)}if(t.type.isFunctional){var i=Array(t.type.resolve().from.length).fill().map((e,n)=>new r({type:t.type.resolve().from[n],name:"$"+n}));return n(makecall(t,i),makecall(e,i),a+1)}return!1};p.nequalscall++;var a=n(t,e,0);return a&&p.nequalstrue++,a},p.chain=function(t){if(!t.every(t=>"tee"==t._type))throw Error("no");return p.expandMetaAndFuncalls(t.reduceRight((t,e)=>{for(var r=0;r<t.left.length;r++)if(p.equals(e.right,t.left[r])){var n=t.left.slice(0,r).concat(e.left).concat(t.left.slice(r+1));return new o({left:n,right:t.right})}throw Error(`Chaining failed:\n\n--- LEFT ---\n${e}\n------------\n\n--- RIGHT ---\n${t}\n-------------`)}))},t.exports=p},function(t,e,r){var n=r(0);function Type(t){if(n.call(this),this.doc=t.doc,this.isBaseType=!!t.base,t.origin){if("string"!=typeof t.name)throw this.error("typeof o.name != 'string'");if(this.name=t.name,!(t.origin instanceof Type))throw this.error("!(o.origin instanceof Type)");this.isFunctional=t.origin.isFunctional,this.isSimple=t.origin.isSimple,this.origin=t.origin}else{if("boolean"!=typeof t.functional)throw this.error("typeof o.functional != 'boolean'");if(this.isFunctional=t.functional,this.isSimple=!t.functional,t.functional){if(t.from.map(t=>t instanceof Type).some(t=>!t))throw this.error("o.from.map(f => f instanceof Type).some(e => !e)");if(!(t.to instanceof Type))throw this.error("!(o.to instanceof Type)");this.from=t.from,this.to=t.to}else{if("string"!=typeof t.name)throw this.error("typeof o.name != 'string'");this.name=t.name}}}Type.prototype=Object.create(n.prototype),Type.prototype.constructor=Type,Type.prototype._type="type",Type.prototype.toString=function(){return this.toIndentedString(0)},Type.prototype.toSimpleString=function(){if(this.name)return this.name;var t=this.resolve();return`[${t.from.map(t=>t.toSimpleString()).join(", ")} -> ${t.to.toSimpleString()}]`},Type.prototype.toIndentedString=function(t){return this.isSimple?this.name:`${this.name?this.name+": ":""}[${this.resolve().from.join(", ")} -> ${this.resolve().to}]`},Type.prototype.toTeXString=function(t){return this.isSimple||!t&&this.name?`\\href{#type-${this.name}}\\mathsf{${this.name}}`:(this.name?`\\href{#type-${this.name}}\\mathsf{${this.name}}: `:"")+"\\left["+this.resolve().from.map(t=>t.toTeXString()).join(" \\times ")+` \\to ${this.resolve().to.toTeXString()} \\right]`},Type.prototype.resolve=function(){return this.origin?this.origin.resolve():this},Type.prototype.equals=function(t){if(!(t instanceof Type))return!1;if(this.origin)return this.origin.equals(t);if(t.origin)return this.equals(t.origin);if(this.isSimple!=t.isSimple)return!1;if(this.isSimple)return this===t;if(this.from.length!=t.from.length)return!1;for(var e=0;e<this.from.length;e++)if(!this.from[e].equals(t.from[e]))return!1;return this.to.equals(t.to)},t.exports=Type},function(t,e,r){var n=r(0);function Typevar({type:t,isParam:e,guess:r,name:a,doc:o,tex:i},s){if(n.call(this,s),this.doc=o,this.tex=i,this.isParam=!!e,this.guess=r||null,"type"!=t._type)throw this.error("Assertion failed");if("string"!=typeof a)throw this.error("Assertion failed");this.type=t,this.name=a}Typevar.prototype=Object.create(n.prototype),Typevar.prototype.constructor=Typevar,Typevar.prototype._type="typevar",Typevar.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)},Typevar.prototype.toString=function(){return this.toIndentedString(0)},Typevar.prototype.toSimpleString=function(){return this.type.toSimpleString()+" "+this.name},Typevar.prototype.toIndentedString=function(t,e){return`${e?this.type+" ":""}${this.name}<${this._id}>`},Typevar.prototype.toTeXString=function(t,e){return`\\href{#${this.isParam?"id-"+this._id:"def-"+this.name}}{${this.tex||(1==this.name.length?this.escapeTeX(this.name):`\\mathrm{${this.escapeTeX(this.name)}}`)}}`},t.exports=Typevar},function(t,e,r){var n=r(0),a=r(2),o=r(1);function Fun({name:t,type:e,params:r,expr:o,doc:i,tex:s},p){if(n.call(this,p),this.doc=i,s){var{precedence:c,code:l}=this.parseTeX(s);this.precedence=c,this.tex=l}else this.precedence=!1,this.tex=!1;if(!t&&!o)throw this.error("Anonymous fun cannot be primitive");if(e&&o)throw this.error("no");if(!e&&!o)throw this.error("Cannot guess the type of a primitive fun");if(null!==t&&"string"!=typeof t)throw this.error("Assertion failed");if(e&&"type"!=e._type)throw this.error("Assertion failed");if(!(r instanceof Array)||r.map(t=>t instanceof n).some(t=>!t))throw this.error("Assertion failed");if(null!==o&&!(o instanceof n))throw this.error("Assertion failed");this.name=t,this.type=e||new a({functional:!0,from:r.map(t=>t.type),to:o.type}),this.params=r,this.expr=o}Fun.prototype=Object.create(n.prototype),Fun.prototype.constructor=Fun,Fun.prototype._type="fun",Fun.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)},Fun.prototype.toString=function(){return this.toIndentedString(0)},Fun.prototype.toIndentedString=function(t){return this.expr?[(this.name?"ƒ "+this.type.to+" "+this.name:"ƒ ")+`(${this.params.join(", ")}) => {`,"\t"+this.expr.toIndentedString(t+1),"}"].join("\n"+"\t".repeat(t)):`ƒ ${this.type.to} ${this.name}(${this.params.join(", ")});`},Fun.prototype.toTeXString=function(t,e){return this.name?e?this.expr?this.funcallToTeXString(this.params,this.PREC_COLONEQQ)+"\\coloneqq "+this.expr.toTeXString(this.PREC_COLONEQQ):this.funcallToTeXString(this.params,t):`\\href{#def-${this.name}}\\mathrm{${this.escapeTeX(this.name)}}`:(this.precedence=this.PREC_FUNEXPR,[this.shouldConsolidate(t)?"\\left(":"",1==this.params.length?this.params[0].toTeXString(!1):`\\left(${this.params.map(t=>t.toTeXString(this.PREC_COMMA)).join(", ")}\\right)`,"\\mapsto "+o.expandMetaAndFuncalls(this.expr).toTeXString(!1),this.shouldConsolidate(t)?"\\right)":""].join(""))},Fun.prototype.funcallToTeXString=function(t,e){return t=t.map(t=>t.toTeXString(this.tex?this.precedence:this.PREC_COMMA)),this.tex?this.makeTeX("def-"+this.name,t,e):(this.name?`\\href{#def-${this.name}}{${1==this.name.length?this.escapeTeX(this.name):`\\mathrm{${this.escapeTeX(this.name)}}`}}`:this.toTeXString(!1))+`(${t.join(", ")})`},t.exports=Fun},function(t,e,r){var n=r(0),a=r(3),o=r(1);function Schemacall({schema:t,args:e},r){if(n.call(this,r),!t)throw this.error("Assertion failed");if(!(e instanceof Array))throw this.error("Assertion failed");this.schema=t,this.args=e;var a=t.type.from,i=e.map(t=>t.type);if(a.length!=i.length)throw this.error(`Invalid number of arguments (expected ${a.length}): ${i.length}`);for(var s=0;s<a.length;s++)if(!a[s].equals(i[s]))throw this.error(`Argument #${s+1} has illegal argument type (expected ${a[s]}): ${i[s]}`);this.type=t.type.to,this.expanded=o.expandMetaAndFuncalls(this)}Schemacall.prototype=Object.create(n.prototype),Schemacall.prototype.constructor=Schemacall,Schemacall.prototype._type="schemacall",Schemacall.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)||this.schema.isProved(t)},Schemacall.prototype.toString=function(){return this.toIndentedString(0)},Schemacall.prototype.toIndentedString=function(t){var e=this.args.map(e=>e instanceof a?`${e.name}<${e._id}>`:e.toIndentedString(t+1));return e.join("").length<=50?(e=(e=this.args.map(e=>e instanceof a?`${e.name}<${e._id}>`:e.toIndentedString(t))).join(", "),[(this.schema.name||`(${this.schema})`)+"(",e,")"].join("")):(e=e.join(",\n"+"\t".repeat(t+1)),[(this.schema.name||`(${this.schema.toIndentedString(t)})`)+"(","\t"+e,")"].join("\n"+"\t".repeat(t)))},Schemacall.prototype.toTeXString=function(t,e){return(this.schema.name?`\\href{#schema-${this.schema.proved?"p":"np"}-${this.schema.name}}{\\textsf{${this.escapeTeX(this.schema.name)}}}`:this.schema.toTeXString(!1))+`(${this.args.map(t=>t.toTeXString(this.PREC_COMMA)).join(", ")})`},t.exports=Schemacall},function(t,e,r){var n=r(0),a=r(3),o=r(4);function Funcall({fun:t,args:e},r){if(n.call(this,r),!(t instanceof n))throw this.error("Assertion failed");if(!["typevar","fun","funcall"].includes(t._type))throw console.log(t),this.error("Assertion failed");if(t.type.isSimple)throw this.error(t.name+" is not callable");if(!(e instanceof Array)||e.map(t=>t instanceof n).some(t=>!t))throw this.error("Assertion failed");var a=t.type.resolve(),o=a.from,i=e.map(t=>t.type);if(o.length!=i.length)throw this.error(`Invalid number of arguments (expected ${o.length}): ${i.length}`);for(var s=0;s<o.length;s++)if(!o[s].equals(i[s]))throw this.error(`Argument #${s+1} has illegal argument type (expected ${o[s]}): ${i[s]}`);this.fun=t,this.type=a.to,this.args=e}Funcall.prototype=Object.create(n.prototype),Funcall.prototype.constructor=Funcall,Funcall.prototype._type="funcall",Funcall.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)||this.fun.isProved(t)},Funcall.prototype.toString=function(){return this.toIndentedString(0)},Funcall.prototype.toIndentedString=function(t){var e=this.args.map(e=>e instanceof a?`${e.name}<${e._id}>`:e.toIndentedString(t+1));return e.join("").length<=50?(e=(e=this.args.map(e=>e instanceof a?`${e.name}<${e._id}>`:e.toIndentedString(t))).join(", "),[("fun"==this.fun._type&&this.fun.name?this.fun.name:"("+this.fun.toIndentedString(t)+")")+"(",e,")"].join("")):(e=e.join(",\n"+"\t".repeat(t+1)),[("fun"==this.fun._type&&this.fun.name?this.fun.name:"("+this.fun.toIndentedString(t)+")")+"(","\t"+e,")"].join("\n"+"\t".repeat(t)))},Funcall.prototype.toTeXString=function(t,e){if(this.fun instanceof o)return this.fun.funcallToTeXString(this.args,t);var r=this.args.map(t=>t.toTeXString(this.PREC_COMMA));return(this.fun.name&&"typevar"!=this.fun._type?1==this.fun.name.length?this.escapeTeX(this.fun.name):`\\mathrm{${this.escapeTeX(this.fun.name)}}`:this.fun.toTeXString(!1))+`(${r.join(", ")})`},t.exports=Funcall},function(t,e,r){var n=r(0),a=r(10),o=r(1);function Tee({left:t,right:e},r){if(n.call(this,r),!(t instanceof Array&&t.every(t=>["type","metatype"].includes(t.type._type))))throw console.log(t),this.error("Assertion failed");if(!["type","metatype"].includes(e.type._type))throw console.log(e),this.error("Assertion failed");if(e.type.isFunctional)throw this.error("RHS of a rule cannot be a schema");this.left=t.reduce((t,e)=>{for(var r=0;r<t.length;r++)if(o.equals(t[r],e))return t;return t.push(e),t},[]),this.right=e,this.type=new a({functional:!1,left:t.map(t=>t.type),right:e.type})}Tee.prototype=Object.create(n.prototype),Tee.prototype.constructor=Tee,Tee.prototype._type="tee",Tee.prototype.precedence=n.prototype.PREC_COMMA,Tee.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)||this.right.isProved(t.concat(this.left))},Tee.prototype.toString=function(){return this.toIndentedString(0)},Tee.prototype.toIndentedString=function(t){return this.left.length?["\t"+this.left.map(e=>e.toIndentedString(t+1)).join(",\n"+"\t".repeat(t+1)),"|-","\t"+this.right.toIndentedString(t+1)].join("\n"+"\t".repeat(t)):"|- "+this.right.toIndentedString(t)},Tee.prototype.toTeXString=function(t,e){var r=o.expandMetaAndFuncalls(this);return[this.shouldConsolidate(t)?"\\left(":"",`{${r.left.map(t=>t.toTeXString(this.PREC_COMMA)).join(", ")} \\vdash ${r.right.toTeXString(this.PREC_COMMA)}}`,this.shouldConsolidate(t)?"\\right)":""].join("")},t.exports=Tee},function(t,e,r){var n=r(0);function Ruleset({axiomatic:t,name:e,native:r,doc:a},o){if(n.call(this,o),this.doc=a,"string"!=typeof e)throw this.error("Assertion failed");if(!r)throw this.error("Assertion failed");this.axiomatic=t,this.name=e,this.native=r||!1}Ruleset.prototype=Object.create(n.prototype),Ruleset.prototype.constructor=Ruleset,Ruleset.prototype._type="ruleset",Ruleset.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)||this.axiomatic},Ruleset.prototype.toString=function(){return this.toIndentedString(0)},Ruleset.prototype.toIndentedString=function(t){return"RS "+this.name+(this.native?" <native>":" <error>")},Ruleset.prototype.toTeXString=function(t,e){return`\\href{#ruleset-${this.name}}{\\mathsf{${this.escapeTeX(this.name)}}}`+(this.native?"\\ (\\textrm{native})":"\\ (\\textit{error})")},t.exports=Ruleset},function(t,e,r){var n=r(0),a=r(2),o=r(10),i=r(1);function Schema({axiomatic:t,name:e,native:r,params:i,expr:s,doc:p},c){if(n.call(this,c),this.doc=p,"boolean"!=typeof t)throw this.error("Assertion failed");if(null!==e&&"string"!=typeof e)throw this.error("Assertion failed");if(!r&&!["type","metatype"].includes(s.type._type))throw this.error("Assertion failed");if(this.axiomatic=t,this.name=e,r)this.native=r,this.expr=null,this.type=null;else{if(!(i instanceof Array)||i.map(t=>"typevar"==t._type).some(t=>!t))throw this.error("Assertion failed");this.params=i,this.expr=s,this.type=new("type"==s.type._type?a:o)({functional:!0,from:i.map(t=>t.type),to:s.type})}this.proved=this.isProved()}Schema.prototype=Object.create(n.prototype),Schema.prototype.constructor=Schema,Schema.prototype._type="schema",Schema.prototype.isProved=function(t){return t=t||[],this.proved||!this.native&&n.prototype.isProved.call(this,t)||this.axiomatic||this.expr&&this.expr.isProved(t)},Schema.prototype.toString=function(){return this.toIndentedString(0)},Schema.prototype.toIndentedString=function(t){return this.native?`∫ ${this.name} <native>`:[`∫ ${this.name||""}(${this.params.map(e=>e.toIndentedString(t)).join(", ")}) => {`,"\t"+this.expr.toIndentedString(t+1),"}"].join("\n"+"\t".repeat(t))},Schema.prototype.toTeXString=function(t,e){if(!this.name)return this.precedence=this.PREC_FUNEXPR,[this.shouldConsolidate(t)?"\\left(":"",1==this.params.length?this.params[0].toTeXString():`\\left(${this.params.map(t=>t.toTeXString(this.PREC_COMMA)).join(", ")}\\right)`,"\\mapsto "+this.expr.toTeXString(!1),this.shouldConsolidate(t)?"\\right)":""].join("");var r=`schema-${this.proved?"p":"np"}-${this.name}`;return e?this.native?`\\href{#${r}}{\\mathsf{${this.escapeTeX(this.name)}}}\\ (\\textrm{native})`:`\\href{#${r}}{\\mathsf{${this.escapeTeX(this.name)}}}(${this.params.map(t=>t.toTeXString(this.PREC_COMMA)+(t.guess?`: \\texttt{@${t.guess}}`:"")).join(", ")}):\\\\\\quad`+i.expandMetaAndFuncalls(this.expr).toTeXString(!0):`\\href{#${r}}\\mathsf{${this.escapeTeX(this.name)}}`},t.exports=Schema},function(t,e,r){var n=r(0),a=r(2);function MetaType(t){if(n.call(this),"boolean"!=typeof t.functional)throw this.error("typeof o.functional != 'boolean'");if(this.isFunctional=t.functional,this.isSimple=!t.functional,t.functional){if(t.from.some(t=>!(t instanceof a)))throw this.error("o.from.some(f => !(f instanceof Type))");if(!(t.to instanceof MetaType))throw this.error("!(o.to instanceof MetaType)");if(t.to.isFunctional)throw this.error("Functional metatype in functional metatype is not supported");this.from=t.from,this.to=t.to}else{if(!(t.left instanceof Array))throw this.error("left should be an array");this.left=t.left,this.right=t.right}}MetaType.prototype=Object.create(n.prototype),MetaType.prototype.constructor=MetaType,MetaType.prototype._type="metatype",MetaType.prototype.resolve=function(){return this},MetaType.prototype.toString=function(){return this.isSimple?`[${this.left.join(", ")} |- ${this.right}]`:`[${this.from.join(", ")} -> ${this.to}]`},MetaType.prototype.equals=function(t){if(!(t instanceof MetaType))return!1;if(this.isSimple!=t.isSimple)return!1;if(this.isSimple){if(this.left.length!=t.left.length)return!1;for(let e=0;e<this.left.length;e++)if(!this.left[e].equals(t.left[e]))return!1;return!!this.right.equals(t.right)}if(this.from.length!=t.from.length)return!1;for(let e=0;e<this.from.length;e++)if(!this.from[e].equals(t.from[e]))return!1;return this.to.equals(t.to)},t.exports=MetaType},function(t,e,r){var n;n=r(12).default;var a=r(13);t.exports={grammar:n,Program:a}},function(t,e,r){"use strict";r.r(e),e.default='start =\r\n\t_ lines:(a:line _ {return a})* {return lines}\r\n\r\nline =\r\n\ttypedef\r\n\t/ defv\r\n\t/ defun\r\n\t/ defruleset\r\n\t/ defschema\r\n\r\nevaluable =\r\n\t_ e:evaluable_internal _ {return e}\r\n\r\nevaluable_internal =\r\n\ttypedef\r\n\t/ defv\r\n\t/ defun\r\n\t/ defruleset\r\n\t/ defschema\r\n\t/ metaexpr\r\n\r\ntypedef =\r\n\tdoc:(documentation __)?\r\n\tbase:("base" __)?\r\n\t"type" __\r\n\torigin:(o:ftype __ {return o})?\r\n\tname:ident _ sem\r\n\t{\r\n\t\tdoc = doc && doc[0];\r\n\t\t\r\n\t\treturn {\r\n\t\t\t_type: \'typedef\',\r\n\t\t\tdoc,\r\n\t\t\tbase: !!base,\r\n\t\t\torigin,\r\n\t\t\tname,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\ndefv =\r\n\tdoc:(documentation __)? tex:(tex __)? type:type __ name:ident _ sem\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defv\',\r\n\t\t\tdoc: doc && doc[0],\r\n\t\t\ttex: tex && tex[0],\r\n\t\t\ttype,\r\n\t\t\tname,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\ndefparam =\r\n\ttex:(tex __)? type:type __ name:ident\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defv\',\r\n\t\t\tisParam: true,\r\n\t\t\ttype,\r\n\t\t\ttex: tex && tex[0],\r\n\t\t\tname,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\ndefschemaparam =\r\n\ttex:(tex __)? type:type __ name:ident\r\n\tguess:(_ \':\' _ \'@\' g:$[a-z0-9_]+ {return g})?\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defv\',\r\n\t\t\tisParam: true,\r\n\t\t\tguess,\r\n\t\t\ttype,\r\n\t\t\ttex: tex && tex[0],\r\n\t\t\tname,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n \r\ndefun =\r\n\tdoc:(documentation __)?\r\n\ttex:(tex __)?\r\n\trettype:type __\r\n\tname:ident _\r\n\tparams:(\r\n\t\t"(" _\r\n\t\tp:(\r\n\t\t\thead:defparam _\r\n\t\t\ttail:("," _ tv:defparam _ {return tv})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")" _\r\n\t\t{return p || []}\r\n\t)\r\n\texpr:(\r\n\t\t"{" _\r\n\t\texpr:expr0 _\r\n\t\t"}"\r\n\t\t{return expr}\r\n\t\t/ sem {return null}\r\n\t)\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defun\',\r\n\t\t\tdoc: doc && doc[0],\r\n\t\t\ttex: tex && tex[0],\r\n\t\t\trettype,\r\n\t\t\tname,\r\n\t\t\tparams,\r\n\t\t\texpr,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\ndefschema =\r\n\t// native schemata\r\n\tdoc:(documentation __)?\r\n\taxiomatic:("axiomatic" __)?\r\n\t"native" __\r\n\t"schema" __\r\n\tname:ident _\r\n\tsem\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defschema\',\r\n\t\t\tdoc: doc && doc[0],\r\n\t\t\taxiomatic: !!axiomatic,\r\n\t\t\tname,\r\n\t\t\tnative: true,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\t/\r\n\t// non-native schemata\r\n\tdoc:(documentation __)?\r\n\taxiomatic:("axiomatic" __)?\r\n\t"schema" __\r\n\tname:ident _\r\n\tparams:(\r\n\t\t"(" _\r\n\t\tp:(\r\n\t\t\thead:defschemaparam _\r\n\t\t\ttail:("," _ tv:defschemaparam _ {return tv})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")" _\r\n\t\t{return p || []}\r\n\t)\r\n\t"{" _\r\n\texpr:metaexpr _\r\n\t"}"\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defschema\',\r\n\t\t\tdoc: doc && doc[0],\r\n\t\t\taxiomatic: !!axiomatic,\r\n\t\t\tname,\r\n\t\t\tnative: false,\r\n\t\t\tparams,\r\n\t\t\texpr,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\ndefruleset =\r\n\tdoc:(documentation __)?\r\n\taxiomatic:("axiomatic" __)?\r\n\t"native" __\r\n\t"ruleset" __\r\n\tname:ident _\r\n\tsem\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'defruleset\',\r\n\t\t\tdoc: doc && doc[0],\r\n\t\t\taxiomatic: !!axiomatic,\r\n\t\t\tname,\r\n\t\t\tnative: true,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\n// var[...]\r\n// foo(...)[...]\r\n// foo[...][...]\r\n// (metaexpr)[...]\r\n// schema(?, ...)[...]\r\nreduction =\r\n\tsubject:(\r\n\t\tschemacall\r\n\t\t/ var\r\n\t\t/ "(" _\r\n\t\te:metaexpr _\r\n\t\t")"\r\n\t\t{return e}\r\n\t) _\r\n\tguesses:(\r\n\t\t"(" _\r\n\t\ta:(\r\n\t\t\thead:(\'?\' {return null} / expr0) _\r\n\t\t\ttail:("," _ e:(\'?\' {return null} / expr0) _ {return e})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")"\r\n\t\t{return a || []}\r\n\t)?\r\n\tleftargs:(\r\n\t\t"[" _\r\n\t\ta:(\r\n\t\t\thead:metaexpr _\r\n\t\t\ttail:("," _ e:metaexpr _ {return e})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t"]"\r\n\t\t{return a || []}\r\n\t)+\r\n\t{\r\n\t\tvar ret = {\r\n\t\t\t_type: \'reduction\',\r\n\t\t\tsubject,\r\n\t\t\tguesses,\r\n\t\t\tleftargs: leftargs[0],\r\n\t\t\tlocation: location()\r\n\t\t};\r\n\r\n\t\tfor (var i = 1; i < leftargs.length; i++) {\r\n\t\t\tret = {\r\n\t\t\t\t_type: \'reduction\',\r\n\t\t\t\tsubject: ret,\r\n\t\t\t\tguesses: null,\r\n\t\t\t\tleftargs: leftargs[i],\r\n\t\t\t\tlocation: location()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t}\r\n\r\n// var(...)\r\n// (metaexpr)(...)\r\nschemacall =\r\n\tschema:(\r\n\t\tvar\r\n\t\t/ "(" _\r\n\t\te:metaexpr _\r\n\t\t")"\r\n\t\t{return e}\r\n\t) _\r\n\targs:(\r\n\t\t"(" _\r\n\t\ta:(\r\n\t\t\thead:expr0 _\r\n\t\t\ttail:("," _ e:expr0 _ {return e})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")"\r\n\t\t{return a || []}\r\n\t)\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'schemacall\',\r\n\t\t\tschema,\r\n\t\t\targs,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\n// forall(f, g)\r\n// (expr0)(f, g)\r\nfuncall =\r\n\tfun:(\r\n\t\tvar\r\n\t\t/ "(" _\r\n\t\te:expr0 _\r\n\t\t")"\r\n\t\t{return e}\r\n\t) _\r\n\targs:(\r\n\t\t"(" _\r\n\t\ta:(\r\n\t\t\thead:expr0 _\r\n\t\t\ttail:("," _ e:expr0 _ {return e})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")"\r\n\t\t{return a || []}\r\n\t)\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'funcall\',\r\n\t\t\tfun,\r\n\t\t\targs,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\n// (T t) => { expr0 }\r\nfunexpr =\r\n\tparams:(\r\n\t\t"(" _\r\n\t\tp:(\r\n\t\t\thead:defparam _\r\n\t\t\ttail:("," _ tv:defparam _ {return tv})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")" _\r\n\t\t{return p || []}\r\n\t)\r\n\t"=>" _\r\n\t"{" _ expr:expr0 _ "}"\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'funexpr\',\r\n\t\t\tparams,\r\n\t\t\texpr,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\n// (T t) => { metaexpr }\r\nschemaexpr =\r\n\tparams:(\r\n\t\t"(" _\r\n\t\tp:(\r\n\t\t\thead:defparam _\r\n\t\t\ttail:("," _ tv:defparam _ {return tv})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)?\r\n\t\t")" _\r\n\t\t{return p || []}\r\n\t)\r\n\t"=>" _\r\n\t"{" _ expr:metaexpr _ "}"\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'schemaexpr\',\r\n\t\t\tdoc: false,\r\n\t\t\taxiomatic: false,\r\n\t\t\tname: null,\r\n\t\t\tparams,\r\n\t\t\texpr,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\nmetaexpr =\r\n\t// right associativity\r\n\ta:(\r\n\t\tmetaexpr_internal_1\r\n\t) _ "~" _ b:metaexpr\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'reduction\',\r\n\t\t\tsubject: {\r\n\t\t\t\t_type: \'var\',\r\n\t\t\t\ttype: \'normal\',\r\n\t\t\t\tname: \'cut\',\r\n\t\t\t\tlocation: location()\r\n\t\t\t},\r\n\t\t\tleftargs: [a, b],\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\t/ metaexpr_internal_1\r\n\r\nmetaexpr_internal_1 =\r\n\tleft:(\r\n\t\tl:(\r\n\t\t\thead:metaexpr_internal_2 _\r\n\t\t\ttail:("," _ e:metaexpr_internal_2 _ {return e})*\r\n\t\t\t{return [head].concat(tail)}\r\n\t\t)? {return l || []}\r\n\t)\r\n\t"|-" _\r\n\tright:metaexpr_internal_1\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'tee\',\r\n\t\t\tleft,\r\n\t\t\tright,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\t/ metaexpr_internal_2\r\n\r\n/*\r\n * 다음이 성립하여야 한다.\r\n *\r\n * - reduction이 schemacall보다 앞이다.\r\n * - schemacall이 var보다 앞이다.\r\n *\r\n */\r\nmetaexpr_internal_2 =\r\n\treduction\r\n\t/ schemacall\r\n\t/ var\r\n\t/ schemaexpr\r\n\t/ "(" _ e:metaexpr _ ")" {return e}\r\n\r\nexpr0 =\r\n\tfuncall\r\n\t/ funexpr\r\n\t/ var\r\n\t/ "(" _ e:expr0 _ ")" {return e}\r\n\r\ntype =\r\n\tstype\r\n\t/ ftype\r\n\r\nstype =\r\n\tname:ident\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'type\',\r\n\t\t\tftype: false,\r\n\t\t\tname,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\nftype =\r\n\t"[" _\r\n\tfrom:(\r\n\t\ttype:type {return [type]}\r\n\t\t/ (\r\n\t\t\ttt:(\r\n\t\t\t\t"(" _\r\n\t\t\t\thead: type\r\n\t\t\t\ttail:(_ "," _ t:type {return t})*\r\n\t\t\t\t_ ")"\r\n\t\t\t\t{return [head].concat(tail)}\r\n\t\t\t)\r\n\t\t\t{return tt}\r\n\t\t)\r\n\t) _\r\n\t"->" _\r\n\tto:type _\r\n\t"]"\r\n\t{\r\n\t\treturn {\r\n\t\t\t_type: \'type\',\r\n\t\t\tftype: true,\r\n\t\t\tfrom,\r\n\t\t\tto,\r\n\t\t\tlocation: location()\r\n\t\t}\r\n\t}\r\n\r\nvar =\r\n\trulesetName:(id:ident _ "." _ {return id})?\r\n\tname:ident\r\n\t{\r\n\t\treturn rulesetName\r\n\t\t\t? {\r\n\t\t\t\t_type: \'var\',\r\n\t\t\t\ttype: \'ruleset\',\r\n\t\t\t\trulesetName,\r\n\t\t\t\tname,\r\n\t\t\t\tlocation: location()\r\n\t\t\t}\r\n\t\t\t: {\r\n\t\t\t\t_type: \'var\',\r\n\t\t\t\ttype: \'normal\',\r\n\t\t\t\tname,\r\n\t\t\t\tlocation: location()\r\n\t\t\t}\r\n\t}\r\n\r\nkeyword =\r\n\t"axiomatic"\r\n\t/ "base"\r\n\t/ "native"\r\n\t/ "ruleset"\r\n\t/ "schema"\r\n\t/ "type";\r\n\r\nident =\r\n\t$(!keyword [a-zA-Z0-9_]+)\r\n\r\ndocumentation =\r\n\t\'"\' b:$(!\'"\' a:. {return a})* \'"\' {\r\n\t\treturn b\r\n\t}\r\n\r\ntex =\r\n\t\'$\' b:$(!\'$\' a:. {return a})* \'$\' {\r\n\t\treturn b\r\n\t}\r\n\r\ncomment =\r\n\t"#" (!newline .)*\r\n\t/ "//" (!newline .)*\r\n\t/ "/*" (!"*/" .)* "*/"\r\n\r\nnewline =\r\n\t"\\r\\n" / "\\r" / "\\n"\r\n\r\n// optional whitespace\r\n_ =\r\n\t([ \\t\\n\\r] / comment)*\r\n\r\n// mandatory whitespace\r\n__ =\r\n\t([ \\t\\n\\r] / comment)+\r\n\r\nsem =\r\n\t";"'},function(t,e,r){"use strict";var n=r(14),a=r(2),o=r(3),i=r(4),s=r(6),p=r(7),c=r(8),l=r(9),u=r(5),h=r(17),f=r(1);f.init({Type:a,Typevar:o,Fun:i,Funcall:s,Tee:p,Ruleset:c,Schema:l,Schemacall:u});class Program{constructor(){this.scope=new n(null)}feed(t,e){t.forEach(t=>{switch(t._type){case"typedef":var r=h.type(t,this.scope);if(this.scope.hasType(r.name))throw r.scope.error(`Type ${r.name} has already been declared`);this.scope.addType(r);break;case"defv":var n=h.typevar(t,this.scope);if(this.scope.hasTypevar(n.name))throw n.scope.error(`Definition ${n.name} has already been declared`);this.scope.addTypevar(n);break;case"defun":var a=h.fun(t,this.scope);if(this.scope.hasTypevar(a.name))throw a.scope.error(`Definition ${a.name} has already been declared`);this.scope.addFun(a);break;case"defruleset":var o=h.ruleset(t,this.scope,e);if(this.scope.hasRuleset(o.name))throw o.scope.error(`Ruleset ${o.name} has already been declared`);this.scope.addRuleset(o);break;case"defschema":var i=h.schema(t,this.scope,e);if(this.scope.hasSchema(i.name))throw i.scope.error(`Schema ${i.name} has already been declared`);this.scope.addSchema(i);break;default:throw Error("Unknown line type "+t._type)}})}evaluate(t){switch(t._type){case"typedef":case"defv":case"defun":case"defruleset":case"defschema":case"tee":case"reduction":case"schemacall":case"var":case"schemaexpr":return h[{typedef:"type",defv:"typevar",defun:"fun",defruleset:"ruleset",defschema:"schema",tee:"tee",reduction:"reduction",schemacall:"schemacall",var:"metavar",schemaexpr:"schemaexpr"}[t._type]](t,this.scope);default:throw Error("Unknown line type "+t._type)}}}Program.prototype.ExpressionResolver=f,t.exports=Program},function(t,e,r){"use strict";var n=r(2),a=r(3),o=r(4),i=r(6),s=r(7),p=r(8),c=r(9),l=r(5),u=r(15);function Scope(t,e){if(this.typedefMap={},this.defMap={},this.schemaMap={},this.rulesetMap={},this.parent=t,this.root=t?t.root:this,e&&!(e instanceof u))throw Error("Assertion failed");this.trace=e||new u,this.baseType=t?t.baseType:null}Scope.prototype.Type=n,Scope.prototype.Typevar=a,Scope.prototype.Fun=o,Scope.prototype.Funcall=i,Scope.prototype.Tee=s,Scope.prototype.Ruleset=p,Scope.prototype.Schema=c,Scope.prototype.Schemacall=l,Scope.prototype.extend=function(t,e,r){return new Scope(this,this.trace.extend(t,e,r))},Scope.prototype.error=function(t){return this.trace.error(t)},Scope.prototype.hasOwnType=function(t){if("string"==typeof t)return!!this.typedefMap[t];if(!(t instanceof Array))throw this.error("Argument is malformed");if(t.length<2)throw this.error("Illegal array length");return t.map(t=>this.hasOwnType(t)).every(t=>t)},Scope.prototype.hasType=function(t){if("string"==typeof t)return this.hasOwnType(t)||!!this.parent&&this.parent.hasType(t);if(!(t instanceof Array))throw this.error("Argument is malformed");if(t.length<2)throw this.error("Illegal array length");return t.map(t=>this.hasType(t)).every(t=>t)},Scope.prototype.addType=function(t){if(!(t instanceof n))throw this.error("Illegal argument type");if(!t.name)throw this.error("Something's wrong");if(this.hasOwnType(t.name))throw this.error(`Type ${t.name} has already been declared`);if(t.isBaseType){if(this.baseType)throw this.error("A base type already exists");!function broadcast(e){e.baseType=t,e.parent&&broadcast(e.parent)}(this)}return this.typedefMap[t.name]=t},Scope.prototype.getType=function(t){if("string"==typeof t){if(!this.hasType(t))throw this.error(`Type ${t} is not defined`);return this.typedefMap[t]||!!this.parent&&this.parent.getType(t)}if(!(t instanceof Array))throw this.error("Argument is malformed");if(t.length<2)throw this.error("Illegal array length");var e=t.slice(0,t.length-1).map(t=>this.getType(t)),r=this.getType(t[t.length-1]);return new n({functional:!0,from:e,to:r})},Scope.prototype.hasOwnTypevar=function(t){return!!this.defMap[t]},Scope.prototype.hasTypevar=function(t){return this.hasOwnTypevar(t)||!!this.parent&&this.parent.hasTypevar(t)},Scope.prototype.addTypevar=function(t){if(!(t instanceof a))throw this.error("Illegal argument type");if(this.hasOwnTypevar(t.name))throw this.error(`Definition ${t.name} has already been declared`);return this.defMap[t.name]=t},Scope.prototype.addFun=function(t){if(!(t instanceof o))throw this.error("Illegal argument type");if(!t.name)throw this.error("Cannot add anonymous fun to scope");if(this.hasOwnTypevar(t.name))throw this.error(`Definition ${t.name} has already been declared`);return this.defMap[t.name]=t},Scope.prototype.getTypevar=function(t){if(!this.hasTypevar(t))throw this.error(`Definition ${t} is not defined`);return this.defMap[t]||!!this.parent&&this.parent.getTypevar(t)},Scope.prototype.hasOwnRuleset=function(t){return!!this.rulesetMap[t]},Scope.prototype.hasRuleset=function(t){return this.hasOwnRuleset(t)||!!this.parent&&this.parent.hasRuleset(t)},Scope.prototype.addRuleset=function(t){if(!(t instanceof p))throw this.error("Illegal argument type");if(this.hasOwnRuleset(t.name))throw this.error(`Ruleset ${t.name} has already been declared`);return this.rulesetMap[t.name]=t},Scope.prototype.getRuleset=function(t){if(!this.hasRuleset(t))throw this.error(`Ruleset ${t} is not defined`);return this.rulesetMap[t]||!!this.parent&&this.parent.getRuleset(t)},Scope.prototype.hasOwnSchema=function(t){return!!this.schemaMap[t]||!!this.defMap[t]},Scope.prototype.hasSchema=function(t){return this.hasOwnSchema(t)||!!this.parent&&this.parent.hasSchema(t)},Scope.prototype.addSchema=function(t){if(!(t instanceof c))throw this.error("Illegal argument type");if(this.hasOwnSchema(t.name))throw this.error(`Schema ${t.name} has already been declared`);return this.schemaMap[t.name]=t},Scope.prototype.getSchema=function(t){if(!this.hasSchema(t))throw this.error(`Schema ${t} is not defined`);return this.schemaMap[t]||this.defMap[t]||!!this.parent&&this.parent.getSchema(t)},t.exports=Scope},function(t,e,r){"use strict";(function(e){function StackTrace(t){this.stack=t||[]}StackTrace.prototype.extend=function(t,e,r){return new StackTrace([[t,e,r]].concat(this.stack))},StackTrace.prototype.error=function(t){var r=void 0!==e&&e.argv[2];return new Error(t+"\n\tat "+(this.stack.length?this.stack.map(([t,e,n])=>`${t} ${e||"<anonymous>"} (${r||"<unknown>"}:${n.start.line}:${n.start.column})`).join("\n\tat "):`<root> (${r||"<unknown>"}:1:1)`))},t.exports=StackTrace}).call(this,r(16))},function(t,e){var r,n,a=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(r===setTimeout)return setTimeout(t,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){r=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){n=defaultClearTimeout}}();var o,i=[],s=!1,p=-1;function cleanUpNextTick(){s&&o&&(s=!1,o.length?i=o.concat(i):p=-1,i.length&&drainQueue())}function drainQueue(){if(!s){var t=runTimeout(cleanUpNextTick);s=!0;for(var e=i.length;e;){for(o=i,i=[];++p<e;)o&&o[p].run();p=-1,e=i.length}o=null,s=!1,function runClearTimeout(t){if(n===clearTimeout)return clearTimeout(t);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];i.push(new Item(t,e)),1!==i.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,e,r){var n=r(2),a=r(3),o=r(4),i=r(6),s=r(7),p=r(8),c=r(9),l=r(5),u=r(18),h=r(1),f={};function typeObjToString(t){if("type"!=t._type)throw Error("Assertion failed");return t.ftype?"["+t.from.map(typeObjToString).join(", ")+" -> "+typeObjToString(t.to)+"]":t.name}function typeObjToNestedArr(t){if("type"!=t._type)throw Error("Assertion failed");if(t.ftype){if(!t.from||!t.to)throw Error("Assertion failed");return t.from.map(typeObjToNestedArr).concat([typeObjToNestedArr(t.to)])}if(!t.name)throw Error("Assertion failed");return t.name}f.type=function(t,e){if("typedef"!=t._type)throw Error("Assertion failed");var r=e.extend("type",t.name,t.location),a=t.origin?r.getType(typeObjToNestedArr(t.origin)):null,o=t.name,i=t.doc,s=t.base;if(s&&a)throw r.error("Base type should not be an alias");return new n(a?{name:o,doc:i,base:s,origin:a}:{functional:!1,name:o,doc:i,base:s})},f.typevar=function(t,e){if(!["defv","var"].includes(t._type))throw Error("Assertion failed");var r=e.extend("typevar",t.name,t.location);if("var"==t._type){if(!r.hasTypevar(t.name))throw r.error("Undefined identifier "+t.name);return r.getTypevar(t.name)}if(!r.hasType(typeObjToNestedArr(t.type)))throw r.error(`Type ${typeObjToString(t.type)} is not defined`);var n=r.getType(typeObjToNestedArr(t.type));return new a({type:n,isParam:!!t.isParam,guess:t.guess||null,name:t.name,doc:t.doc,tex:t.tex},r)},f.fun=function(t,e){if("defun"!=t._type&&"funexpr"!=t._type)throw Error("Assertion failed");var r=e.extend("fun",t.name||null,t.location),a=t.name||null,i=null,s=t.params.map(t=>{if(!r.hasType(typeObjToNestedArr(t.type)))throw r.error(`Type ${typeObjToString(t.type)} is not defined`);var e=f.typevar(t,r);if(r.hasOwnTypevar(e.name))throw e.scope.error(`Parameter ${e.name} has already been declared`);return r.addTypevar(e)}),p=null,c=t.doc||null,l=t.tex||null;switch(t._type){case"defun":if(!r.hasType(typeObjToNestedArr(t.rettype)))throw r.error(`Type ${typeObjToString(t.rettype)} is not defined`);var u=r.getType(typeObjToNestedArr(t.rettype));if(t.expr){if(p=f.expr0(t.expr,r),!u.equals(p.type))throw r.error(`Expression type ${p.type} failed to match the return type ${u} of fun ${a}`)}else i=new n({functional:!0,from:s.map(t=>t.type),to:u});break;case"funexpr":p=f.expr0(t.expr,r),i=null;break;default:throw Error("wut")}return new o({name:a,type:i,params:s,expr:p,doc:c,tex:l},r)},f.funcall=function(t,e){if("funcall"!=t._type)throw Error("Assertion failed");var r=e.extend("funcall",t.fun.name||null,t.location),n=f.expr0(t.fun,r),a=t.args.map(t=>f.expr0(t,r));return new i({fun:n,args:a},r)},f.metaexpr=function(t,e){if(!["tee","reduction","schemacall","schemaexpr","var"].includes(t._type))throw Error("Assertion failed");var r=e;switch(t._type){case"tee":return f.tee(t,r);case"reduction":return f.reduction(t,r);case"schemacall":return f.schemacall(t,r);case"schemaexpr":return f.schema(t,r);case"var":return f.metavar(t,r);default:throw Error("wut")}},f.expr0=function(t,e){if(!["funcall","funexpr","var"].includes(t._type))throw console.log(t),Error("Assertion failed");var r=e;switch(t._type){case"funcall":return f.funcall(t,r);case"funexpr":return f.fun(t,r);case"var":return f.typevar(t,r);default:throw Error("wut")}},f.metavar=function(t,e){if("var"!=t._type)throw Error("Assertion failed");var r=e;switch(t.type){case"ruleset":if(!r.hasRuleset(t.rulesetName))throw r.error(`Ruleset ${t.rulesetName} is not defined`);var n=r.getRuleset(t.rulesetName);if(!n.native)throw r.error("Behavior undefined for non-native rulesets");var a=n.native.get(t.name,r);if(!a)throw r.error(`Schema ${function varObjToString(t){switch(t.type){case"ruleset":return`${t.rulesetName}.${t.name}`;case"normal":return""+t.name;default:throw Error("Unknown type "+t.type)}}(t)} is not defined`);return a;case"normal":if(!r.hasSchema(t.name))throw r.error(`Schema ${t.name} is not defined`);return r.getSchema(t.name);default:throw r.error("Unknown type "+t.type)}},f.tee=function(t,e){if("tee"!=t._type)throw Error("Assertion failed");var r=e.extend("tee",null,t.location),foo=t=>f.metaexpr(t,r),n=t.left.map(foo),a=foo(t.right);return new s({left:n,right:a},r)},f.schema=function(t,e,r){if("defschema"!=t._type&&"schemaexpr"!=t._type)throw Error("Assertion failed");var n=e.extend("schema",t.name,t.location),a=t.axiomatic,o=t.name;if(t.native){if(!r.schema[o])throw n.error(`Native code for native schema ${o} not found`);return new c({axiomatic:a,name:o,native:{get:t=>r.schema[o].get(t,n,h)},doc:t.doc},n)}var i=t.params.map(t=>{if(!n.hasType(typeObjToNestedArr(t.type)))throw n.error(`Type ${typeObjToString(t.type)} is not defined`);var e=f.typevar(t,n);if(n.hasOwnTypevar(e.name))throw e.scope.error(`Parameter ${e.name} has already been declared`);return n.addTypevar(e)}),s=f.metaexpr(t.expr,n);return new c({axiomatic:a,name:o,params:i,expr:s,doc:t.doc},n)},f.schemacall=function(t,e){if("schemacall"!=t._type)throw Error("Assertion failed");var r=e.extend("schemacall",t.schema.name||null,t.location),n=f.metaexpr(t.schema,r);if("type"==n.type._type)return f.funcall({_type:"funcall",fun:t.schema,args:t.args,location:t.location},e);var a=t.args.map(t=>f.expr0(t,r));return new l({schema:n,args:a},r)},f.ruleset=function(t,e,r){if("defruleset"!=t._type)throw Error("Assertion failed");var n=e.extend("ruleset",t.name,t.location),a=t.axiomatic,o=t.name;if(!t.native)throw n.error("Assertion failed");if(!r.ruleset[o])throw n.error(`Native code for native ruleset ${o} not found`);var i=r.ruleset[o];return new p({axiomatic:a,name:o,native:i,doc:t.doc},n)},f.reduction=function(t,e){if("reduction"!=t._type)throw Error("Assertion failed");var r=e.extend("reduction",t.subject.name||null,t.location),n=f.metaexpr(t.subject,r),a=t.guesses?t.guesses.map(t=>t&&f.expr0(t,r)):null,o=t.leftargs.map(t=>f.metaexpr(t,r));return new u({subject:n,guesses:a,leftargs:o},r)},t.exports=f},function(t,e,r){var n=r(0),a=r(5),o=r(1);function Reduction({subject:t,guesses:e,leftargs:r},i){if(n.call(this,i),t.native||"schema"!=t._type){if(e)throw this.error("Something's wrong")}else{t.params.forEach((t,r)=>{if(!(e&&e[r]||t.guess))throw this.error(`Argument #${r+1} could not be guessed`)});var s=t.params.map((n,a)=>e&&e[a]?e[a]:this.query(n.guess,o.expandMeta(t.expr).left,r));t=new a({schema:t,args:s},i)}if(!(t.native||"metatype"==t.type._type&&t.type.isSimple))throw this.error("Subject is not reducible");if(!(r instanceof Array)||r.map(t=>t instanceof n).some(t=>!t))throw this.error("Assertion failed");if(this.subject=t,this.leftargs=r,t.native)this.reduced=t.native.get(r),this.type=this.reduced.type;else{var p=t.type.left,c=r.map(t=>t.type);if(p.length!=c.length)throw this.error(`Invalid number of arguments (expected ${p.length}): ${c.length}`);for(let t=0;t<p.length;t++)if(!p[t].equals(c[t]))throw this.error(`Illegal argument type (expected ${p[t]}): ${c[t]}`);this.type=t.type.right;var l=o.expandMetaAndFuncalls(t);if("tee"!=l._type)throw this.error("Assertion failed");for(let t=0;t<l.left.length;t++)if(!o.equals(l.left[t],r[t]))throw this.error(`LHS #${t+1} failed to match:\n\n--- EXPECTED ---\n${o.expandMetaAndFuncalls(l.left[t])}\n----------------\n\n--- RECEIVED ---\n${o.expandMetaAndFuncalls(r[t])}\n----------------`);this.reduced=l.right}}Reduction.prototype=Object.create(n.prototype),Reduction.prototype.constructor=Reduction,Reduction.prototype._type="reduction",Reduction.prototype.isProved=function(t){return t=t||[],n.prototype.isProved.call(this,t)||this.subject.isProved(t)&&this.leftargs.every(e=>e.isProved(t))},Reduction.prototype.query=function(t,e,r){if(0==t.length)throw this.error("wut");if(!(1<=1*t[0]&&1*t[0]<=r.length))throw this.error(`Cannot dereference @${t}: antecedent index out of range`);var n=e[1*t[0]-1],a=r[1*t[0]-1],i=this;return function recurse(t,e,r,n){if(r=o.expandMetaAndFuncalls(r),t.length<=n)return r;if(/[0-9]/.test(t[n])){var a=1*t[n];if("tee"==e._type&&"tee"==r._type){if(e.left.length!=r.left.length)throw i.error(`Cannot dereference @${t}: antecedent length mismatch`);if(!(1<=a&&a<=r.left.length))throw i.error(`Cannot dereference @${t}: antecedent index out of range`);return recurse(t,e.left[a-1],r.left[a-1],n+1)}for(;;){if(!e.fun||!r.fun)throw i.error("Cannot dereference @"+t);if(o.equals(e.fun,r.fun))break;if(!r.fun.expr)throw i.error("Cannot dereference @"+t);r=o.expandCallOnce(r)}if(!r.args||!(1<=a&&a<=r.args.length))throw i.error("Cannot dereference @"+t);return recurse(t,e.args[a-1],r.args[a-1],n+1)}if("r"==t[n]){if("tee"==e._type&&"tee"==r._type)return recurse(t,e.right,r.right,n+1);throw i.error("Cannot dereference @"+t)}throw i.error("Cannot dereference @"+t)}(t,n,a,1)},Reduction.prototype.toString=function(){return this.toIndentedString(0)},Reduction.prototype.toIndentedString=function(t){var e=this.leftargs.map(e=>e.toIndentedString(t+1));return e.join("").length<=50?(e=(e=this.leftargs.map(e=>e.toIndentedString(t))).join(", "),[this.subject.toIndentedString(t)+"[",e,"]"].join("")):(e=e.join(",\n"+"\t".repeat(t+1)),[this.subject.toIndentedString(t)+"[","\t"+e,"]"].join("\n"+"\t".repeat(t)))},Reduction.prototype.toTeXString=function(t,e){return`${this.subject.toTeXString(!1)}[${this.leftargs.map(t=>t.toTeXString(this.PREC_COMMA)).join(", ")}]`},t.exports=Reduction}]);