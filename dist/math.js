var math=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t,r){var n=r(1),o=0;function i(e){this._id=++o,this.scope=e||null}i.prototype.error=function(e){return this.scope?this.scope.error(e):new Error(e)},i.prototype.escapeTeX=function(e){return e.replace(/&|%|\$|#|_|{|}|~|\^|\\/g,e=>({"&":"\\&","%":"\\%",$:"\\$","#":"\\#",_:"\\_","{":"\\{","}":"\\}","~":"\\textasciitilde","^":"\\textasciicircum","\\":"\\textbackslash"}[e]))},i.prototype.parseTeX=function(e){var t=!1,r=e.replace(/^!<prec=([0-9]+)>/,(e,r)=>(t=1*r,""));return{precedence:t,code:r}},i.prototype.isProved=function(e){return!!(e=e||[]).some(e=>n.equals(e,this))},i.prototype.PREC_FUNEXPR=1e3,i.prototype.PREC_COMMA=1e3,i.prototype.PREC_COLONEQQ=1e5,i.prototype.normalizePrecedence=function(e){if(!1===e)return[0,0];if(!0===e)return[2,0];if("number"==typeof e)return[0,e];if(!(e instanceof Array&&2==e.length))throw console.log(e),Error("wut");return e},i.prototype.shouldConsolidate=function(e){var t=this.normalizePrecedence(this.precedence||!1),r=this.normalizePrecedence(e||!1);return(0!=t[0]||0!=t[1])&&!(t[0]<r[0]||t[0]==r[0]&&t[1]<r[1])},i.prototype.makeTeX=function(e,t,r){t=t||[],r=r||!1;var n=this.tex;return this.shouldConsolidate(r)&&(n="\\left("+n+"\\right)"),n.replace(/#([0-9]+)/g,(e,r)=>t[1*r-1]||`\\texttt{\\textcolor{red}{\\#${r}}}`).replace(/<<(.+?)>>/,(t,r)=>`\\href{#${e}}{${r}}`)},e.exports=i},function(e,t){var r,n,o,i,a,s,u={};function l(e){return["schemacall","funcall"].includes(e._type)}function h(e){return"schemacall"==e._type?e.schema:"funcall"==e._type?e.fun:(()=>{throw console.log(e),Error()})()}function c(e,t){return"fun"==e._type||"typevar"==e._type?new o({fun:e,args:t}):"schema"==e._type?new s({schema:e,args:t}):(()=>{throw console.log(e),Error()})()}u.init=function(e){e.Type,r=e.Typevar,n=e.Fun,o=e.Funcall,i=e.Tee,e.Ruleset,a=e.Schema,s=e.Schemacall},u.substitute=function(e,t){switch(e._type){case"funcall":return new o({fun:u.substitute(e.fun,t),args:e.args.map(e=>u.substitute(e,t))});case"fun":if(!e.expr)return t.get(e)||e;if(e.name)return t.get(e)||e;if(e.params.some(e=>t.has(e)))throw Error("Parameter collision");return new n({name:null,params:e.params,expr:u.substitute(e.expr,t)});case"typevar":return t.get(e)||e;case"tee":var r=e.left.map(e=>u.substitute(e,t)),l=u.substitute(e.right,t);return new i({left:r,right:l});case"schemacall":return new s({schema:u.substitute(e.schema,t),args:e.args.map(e=>u.substitute(e,t))});case"schema":if(e.name)return e;if(e.params.some(e=>t.has(e)))throw Error("Parameter collision");return new a({axiomatic:e.axiomatic,name:null,params:e.params,expr:u.substitute(e.expr,t)});case"reduction":return u.substitute(e.reduced,t);default:throw Error("Unknown type "+e._type)}},u.call=function(e,t){if(!["schema","fun"].includes(e._type))throw console.log(e),Error("Illegal type");if(!e.expr)throw Error("Cannot call a callable without a body");if(e.params.length!=t.length)throw Error("Illegal arguments length");for(var r=new Map,n=0;n<e.params.length;n++)r.set(e.params[n],t[n]);return u.substitute(e.expr,r)},u.expandCallOnce=function(e){if(!l(e))throw Error("Illegal type");if(l(h(e)))return c(u.expandCallOnce(h(e)),e.args);if(!h(e).expr)throw Error("Could not expand");return u.call(h(e),e.args)},u.expand0Funcalls=function(e){if("funcall"==e._type){var t=u.expand0Funcalls(e.fun),r=e.args.map(u.expand0Funcalls);return"fun"!=t._type||t.name?new o({fun:t,args:r}):u.expand0Funcalls(u.call(t,r))}return"fun"!=e._type||e.name?e:new n({name:null,params:e.params,expr:u.expand0Funcalls(e.expr)})},u.expandMeta=function(e){if(e.native)return e;switch(e._type){case"tee":var t=e.left.map(u.expandMeta),r=u.expandMeta(e.right);return new i({left:t,right:r});case"schemacall":var n=u.expandMeta(e.schema),o=e.args;return u.expandMeta(u.call(n,o));case"reduction":return u.expandMeta(e.reduced);case"schema":return new a({axiomatic:e.axiomatic,name:null,params:e.params,expr:u.expandMeta(e.expr)});case"funcall":case"fun":case"typevar":return e;default:throw console.log(e),Error("Unknown metaexpr")}},u.expandMetaAndFuncalls=function(e){switch(e._type){case"tee":var t=e.left.map(u.expandMetaAndFuncalls),r=u.expandMetaAndFuncalls(e.right);return new i({left:t,right:r});case"schemacall":var n=u.expandMetaAndFuncalls(e.schema),o=e.args.map(u.expand0Funcalls);return u.expandMetaAndFuncalls(u.call(n,o));case"reduction":return u.expandMetaAndFuncalls(e.reduced);case"schema":return new a({axiomatic:e.axiomatic,name:null,params:e.params,expr:u.expandMetaAndFuncalls(e.expr)});case"funcall":case"fun":case"typevar":return u.expand0Funcalls(e);default:throw console.log(e),Error("Unknown metaexpr")}},u.nequalscall=u.nequalstrue=u.nrecursecall=u.nrecursetrue=0,u.equals=function(e,t){var n=function(e,t,o){if(e==t)return!0;if(!e.type.equals(t.type))return!1;if("reduction"==e._type)return n(e.reduced,t,o+1);if("reduction"==t._type)return n(e,t.reduced,o+1);if(l(e)&&l(t)){if(l(h(e)))return n(u.expandCallOnce(e),t,o+1);if(l(h(t)))return n(e,u.expandCallOnce(t),o+1);if(h(e)==h(t)||!h(e).expr&&!h(t).expr){if(h(e)!=h(t))return!1;if(!h(e).expr&&!h(t).expr){for(var i=0;i<e.args.length;i++)if(!n(e.args[i],t.args[i],o+1))return!1;return!0}if(e.args.every((r,i)=>n(e.args[i],t.args[i],o+1)))return!0}return h(e).expr?n(u.expandCallOnce(e),t,o+1):n(e,u.expandCallOnce(t),o+1)}if(l(e))return(l(h(e))||!!h(e).expr)&&n(u.expandCallOnce(e),t,o+1);if(l(t))return(l(h(t))||!!h(t).expr)&&n(e,u.expandCallOnce(t),o+1);if("tee"==e._type){for(i=0;i<e.left.length;i++)if(!n(e.left[i],t.left[i],o+1))return!1;return n(e.right,t.right,o+1)}if(e.type.isFunctional){var a=Array(e.type.resolve().from.length).fill().map((t,n)=>new r({type:e.type.resolve().from[n],name:"$"+n}));return n(c(e,a),c(t,a),o+1)}return!1};u.nequalscall++;var o=n(e,t,0);return o&&u.nequalstrue++,o},u.chain=function(e){if(!e.every(e=>"tee"==e._type))throw Error("no");return u.expandMetaAndFuncalls(e.reduceRight((e,t)=>{for(var r=0;r<e.left.length;r++)if(u.equals(t.right,e.left[r])){var n=e.left.slice(0,r).concat(t.left).concat(e.left.slice(r+1));return new i({left:n,right:e.right})}throw Error(`Chaining failed:\n\n--- LEFT ---\n${t}\n------------\n\n--- RIGHT ---\n${e}\n-------------`)}))},e.exports=u},function(e,t,r){var n=r(0);function o(e){if(n.call(this),this.doc=e.doc,this.isBaseType=!!e.base,e.origin){if("string"!=typeof e.name)throw this.error("typeof o.name != 'string'");if(this.name=e.name,!(e.origin instanceof o))throw this.error("!(o.origin instanceof Type)");this.isFunctional=e.origin.isFunctional,this.isSimple=e.origin.isSimple,this.origin=e.origin}else{if("boolean"!=typeof e.functional)throw this.error("typeof o.functional != 'boolean'");if(this.isFunctional=e.functional,this.isSimple=!e.functional,e.functional){if(e.from.map(e=>e instanceof o).some(e=>!e))throw this.error("o.from.map(f => f instanceof Type).some(e => !e)");if(!(e.to instanceof o))throw this.error("!(o.to instanceof Type)");this.from=e.from,this.to=e.to}else{if("string"!=typeof e.name)throw this.error("typeof o.name != 'string'");this.name=e.name}}}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._type="type",o.prototype.toString=function(){return this.toIndentedString(0)},o.prototype.toSimpleString=function(){if(this.name)return this.name;var e=this.resolve();return`[${e.from.map(e=>e.toSimpleString()).join(", ")} -> ${e.to.toSimpleString()}]`},o.prototype.toIndentedString=function(e){return this.isSimple?this.name:`${this.name?this.name+": ":""}[${this.resolve().from.join(", ")} -> ${this.resolve().to}]`},o.prototype.toTeXString=function(e){return this.isSimple||!e&&this.name?`\\href{#type-${this.name}}\\mathsf{${this.name}}`:(this.name?`\\href{#type-${this.name}}\\mathsf{${this.name}}: `:"")+"\\left["+this.resolve().from.map(e=>e.toTeXString()).join(" \\times ")+` \\to ${this.resolve().to.toTeXString()} \\right]`},o.prototype.resolve=function(){return this.origin?this.origin.resolve():this},o.prototype.equals=function(e){if(!(e instanceof o))return!1;if(this.origin)return this.origin.equals(e);if(e.origin)return this.equals(e.origin);if(this.isSimple!=e.isSimple)return!1;if(this.isSimple)return this===e;if(this.from.length!=e.from.length)return!1;for(var t=0;t<this.from.length;t++)if(!this.from[t].equals(e.from[t]))return!1;return this.to.equals(e.to)},e.exports=o},function(e,t,r){var n=r(0);function o({type:e,isParam:t,guess:r,name:o,doc:i,tex:a},s){if(n.call(this,s),this.doc=i,this.tex=a,this.isParam=!!t,this.guess=r||null,"type"!=e._type)throw this.error("Assertion failed");if("string"!=typeof o)throw this.error("Assertion failed");this.type=e,this.name=o}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._type="typevar",o.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)},o.prototype.toString=function(){return this.toIndentedString(0)},o.prototype.toSimpleString=function(){return this.type.toSimpleString()+" "+this.name},o.prototype.toIndentedString=function(e,t){return`${t?this.type+" ":""}${this.name}<${this._id}>`},o.prototype.toTeXString=function(e,t){return`\\href{#${this.isParam?"id-"+this._id:"def-"+this.name}}{${this.tex||(1==this.name.length?this.escapeTeX(this.name):`\\mathrm{${this.escapeTeX(this.name)}}`)}}`},e.exports=o},function(e,t,r){var n=r(0),o=r(2),i=r(1);function a({name:e,type:t,params:r,expr:i,doc:a,tex:s},u){if(n.call(this,u),this.doc=a,s){var{precedence:l,code:h}=this.parseTeX(s);this.precedence=l,this.tex=h}else this.precedence=!1,this.tex=!1;if(!e&&!i)throw this.error("Anonymous fun cannot be primitive");if(t&&i)throw this.error("no");if(!t&&!i)throw this.error("Cannot guess the type of a primitive fun");if(null!==e&&"string"!=typeof e)throw this.error("Assertion failed");if(t&&"type"!=t._type)throw this.error("Assertion failed");if(!(r instanceof Array)||r.map(e=>e instanceof n).some(e=>!e))throw this.error("Assertion failed");if(null!==i&&!(i instanceof n))throw this.error("Assertion failed");this.name=e,this.type=t||new o({functional:!0,from:r.map(e=>e.type),to:i.type}),this.params=r,this.expr=i}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._type="fun",a.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)},a.prototype.toString=function(){return this.toIndentedString(0)},a.prototype.toIndentedString=function(e){return this.expr?[(this.name?"ƒ "+this.type.to+" "+this.name:"ƒ ")+`(${this.params.join(", ")}) => {`,"\t"+this.expr.toIndentedString(e+1),"}"].join("\n"+"\t".repeat(e)):`ƒ ${this.type.to} ${this.name}(${this.params.join(", ")});`},a.prototype.toTeXString=function(e,t){return this.name?t?this.expr?this.funcallToTeXString(this.params,this.PREC_COLONEQQ)+"\\coloneqq "+this.expr.toTeXString(this.PREC_COLONEQQ):this.funcallToTeXString(this.params,e):`\\href{#def-${this.name}}\\mathrm{${this.escapeTeX(this.name)}}`:(this.precedence=this.PREC_FUNEXPR,[this.shouldConsolidate(e)?"\\left(":"",1==this.params.length?this.params[0].toTeXString(!1):`\\left(${this.params.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}\\right)`,"\\mapsto "+i.expandMetaAndFuncalls(this.expr).toTeXString(!1),this.shouldConsolidate(e)?"\\right)":""].join(""))},a.prototype.funcallToTeXString=function(e,t){return e=e.map(e=>e.toTeXString(this.tex?this.precedence:this.PREC_COMMA)),this.tex?this.makeTeX("def-"+this.name,e,t):(this.name?`\\href{#def-${this.name}}{${1==this.name.length?this.escapeTeX(this.name):`\\mathrm{${this.escapeTeX(this.name)}}`}}`:this.toTeXString(!1))+`(${e.join(", ")})`},e.exports=a},function(e,t,r){var n=r(0),o=r(3),i=r(1);function a({schema:e,args:t},r){if(n.call(this,r),!e)throw this.error("Assertion failed");if(!(t instanceof Array))throw this.error("Assertion failed");this.schema=e,this.args=t;var o=e.type.from,a=t.map(e=>e.type);if(o.length!=a.length)throw this.error(`Invalid number of arguments (expected ${o.length}): ${a.length}`);for(var s=0;s<o.length;s++)if(!o[s].equals(a[s]))throw this.error(`Argument #${s+1} has illegal argument type (expected ${o[s]}): ${a[s]}`);this.type=e.type.to,this.expanded=i.expandMetaAndFuncalls(this)}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._type="schemacall",a.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.schema.isProved(e)},a.prototype.toString=function(){return this.toIndentedString(0)},a.prototype.toIndentedString=function(e){var t=this.args.map(t=>t instanceof o?`${t.name}<${t._id}>`:t.toIndentedString(e+1));return t.join("").length<=50?(t=(t=this.args.map(t=>t instanceof o?`${t.name}<${t._id}>`:t.toIndentedString(e))).join(", "),[(this.schema.name||`(${this.schema})`)+"(",t,")"].join("")):(t=t.join(",\n"+"\t".repeat(e+1)),[(this.schema.name||`(${this.schema.toIndentedString(e)})`)+"(","\t"+t,")"].join("\n"+"\t".repeat(e)))},a.prototype.toTeXString=function(e,t){return(this.schema.name?`\\href{#schema-${this.schema.name}-${this.schema.proved?"p":"np"}}{\\textsf{${this.escapeTeX(this.schema.name)}}}`:this.schema.toTeXString(!1))+`(${this.args.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")})`},e.exports=a},function(e,t,r){var n=r(0),o=r(3),i=r(4);function a({fun:e,args:t},r){if(n.call(this,r),!(e instanceof n))throw this.error("Assertion failed");if(!["typevar","fun","funcall"].includes(e._type))throw console.log(e),this.error("Assertion failed");if(e.type.isSimple)throw this.error(e.name+" is not callable");if(!(t instanceof Array)||t.map(e=>e instanceof n).some(e=>!e))throw this.error("Assertion failed");var o=e.type.resolve(),i=o.from,a=t.map(e=>e.type);if(i.length!=a.length)throw this.error(`Invalid number of arguments (expected ${i.length}): ${a.length}`);for(var s=0;s<i.length;s++)if(!i[s].equals(a[s]))throw this.error(`Argument #${s+1} has illegal argument type (expected ${i[s]}): ${a[s]}`);this.fun=e,this.type=o.to,this.args=t}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._type="funcall",a.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)},a.prototype.toString=function(){return this.toIndentedString(0)},a.prototype.toIndentedString=function(e){var t=this.args.map(t=>t instanceof o?`${t.name}<${t._id}>`:t.toIndentedString(e+1));return t.join("").length<=50?(t=(t=this.args.map(t=>t instanceof o?`${t.name}<${t._id}>`:t.toIndentedString(e))).join(", "),[("fun"==this.fun._type&&this.fun.name?this.fun.name:"("+this.fun.toIndentedString(e)+")")+"(",t,")"].join("")):(t=t.join(",\n"+"\t".repeat(e+1)),[("fun"==this.fun._type&&this.fun.name?this.fun.name:"("+this.fun.toIndentedString(e)+")")+"(","\t"+t,")"].join("\n"+"\t".repeat(e)))},a.prototype.toTeXString=function(e,t){if(this.fun instanceof i)return this.fun.funcallToTeXString(this.args,e);var r=this.args.map(e=>e.toTeXString(this.PREC_COMMA));return(this.fun.name&&"typevar"!=this.fun._type?1==this.fun.name.length?this.escapeTeX(this.fun.name):`\\mathrm{${this.escapeTeX(this.fun.name)}}`:this.fun.toTeXString(!1))+`(${r.join(", ")})`},e.exports=a},function(e,t,r){var n=r(0),o=r(10),i=r(1);function a({left:e,right:t},r){if(n.call(this,r),!(e instanceof Array&&e.every(e=>["type","metatype"].includes(e.type._type))))throw console.log(e),this.error("Assertion failed");if(!["type","metatype"].includes(t.type._type))throw console.log(t),this.error("Assertion failed");if(t.type.isFunctional)throw this.error("RHS of a rule cannot be a schema");this.left=e.reduce((e,t)=>{for(var r=0;r<e.length;r++)if(i.equals(e[r],t))return e;return e.push(t),e},[]),this.right=t,this.type=new o({functional:!1,left:e.map(e=>e.type),right:t.type})}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._type="tee",a.prototype.precedence=n.prototype.PREC_COMMA,a.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.right.isProved(e.concat(this.left))},a.prototype.toString=function(){return this.toIndentedString(0)},a.prototype.toIndentedString=function(e){return this.left.length?["\t"+this.left.map(t=>t.toIndentedString(e+1)).join(",\n"+"\t".repeat(e+1)),"|-","\t"+this.right.toIndentedString(e+1)].join("\n"+"\t".repeat(e)):"|- "+this.right.toIndentedString(e)},a.prototype.toTeXString=function(e,t){var r=i.expandMetaAndFuncalls(this);return[this.shouldConsolidate(e)?"\\left(":"",`{${r.left.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")} \\vdash ${r.right.toTeXString(this.PREC_COMMA)}}`,this.shouldConsolidate(e)?"\\right)":""].join("")},e.exports=a},function(e,t,r){var n=r(0);function o({axiomatic:e,name:t,native:r,doc:o},i){if(n.call(this,i),this.doc=o,"string"!=typeof t)throw this.error("Assertion failed");if(!r)throw this.error("Assertion failed");this.axiomatic=e,this.name=t,this.native=r||!1}o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._type="ruleset",o.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.axiomatic},o.prototype.toString=function(){return this.toIndentedString(0)},o.prototype.toIndentedString=function(e){return"RS "+this.name+(this.native?" <native>":" <error>")},o.prototype.toTeXString=function(e,t){return`\\href{#ruleset-${this.name}}{\\mathsf{${this.escapeTeX(this.name)}}}`+(this.native?"\\ (\\textrm{native})":"\\ (\\textit{error})")},e.exports=o},function(e,t,r){var n=r(0),o=r(2),i=r(10),a=r(1);function s({axiomatic:e,name:t,native:r,params:a,expr:s,doc:u},l){if(n.call(this,l),this.doc=u,"boolean"!=typeof e)throw this.error("Assertion failed");if(null!==t&&"string"!=typeof t)throw this.error("Assertion failed");if(!r&&!["type","metatype"].includes(s.type._type))throw this.error("Assertion failed");if(this.axiomatic=e,this.name=t,r)this.native=r,this.expr=null,this.type=null;else{if(!(a instanceof Array)||a.map(e=>"typevar"==e._type).some(e=>!e))throw this.error("Assertion failed");this.params=a,this.expr=s,this.type=new("type"==s.type._type?o:i)({functional:!0,from:a.map(e=>e.type),to:s.type})}this.proved=this.isProved()}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._type="schema",s.prototype.isProved=function(e){return e=e||[],this.proved||!this.native&&n.prototype.isProved.call(this,e)||this.axiomatic||this.expr&&this.expr.isProved(e)},s.prototype.toString=function(){return this.toIndentedString(0)},s.prototype.toIndentedString=function(e){return this.native?`∫ ${this.name} <native>`:[`∫ ${this.name||""}(${this.params.map(t=>t.toIndentedString(e)).join(", ")}) => {`,"\t"+this.expr.toIndentedString(e+1),"}"].join("\n"+"\t".repeat(e))},s.prototype.toTeXString=function(e,t){if(!this.name)return this.precedence=this.PREC_FUNEXPR,[this.shouldConsolidate(e)?"\\left(":"",1==this.params.length?this.params[0].toTeXString():`\\left(${this.params.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}\\right)`,"\\mapsto "+this.expr.toTeXString(!1),this.shouldConsolidate(e)?"\\right)":""].join("");var r=`schema-${this.name}-${this.proved?"p":"np"}`;return t?this.native?`\\href{#${r}}{\\mathsf{${this.escapeTeX(this.name)}}}\\ (\\textrm{native})`:`\\href{#${r}}{\\mathsf{${this.escapeTeX(this.name)}}}(${this.params.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}):\\\\\\quad`+a.expandMetaAndFuncalls(this.expr).toTeXString(!0):`\\href{#${r}}\\mathsf{${this.escapeTeX(this.name)}}`},e.exports=s},function(e,t,r){var n=r(0),o=r(2);function i(e){if(n.call(this),"boolean"!=typeof e.functional)throw this.error("typeof o.functional != 'boolean'");if(this.isFunctional=e.functional,this.isSimple=!e.functional,e.functional){if(e.from.some(e=>!(e instanceof o)))throw this.error("o.from.some(f => !(f instanceof Type))");if(!(e.to instanceof i))throw this.error("!(o.to instanceof MetaType)");if(e.to.isFunctional)throw this.error("Functional metatype in functional metatype is not supported");this.from=e.from,this.to=e.to}else{if(!(e.left instanceof Array))throw this.error("left should be an array");this.left=e.left,this.right=e.right}}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._type="metatype",i.prototype.resolve=function(){return this},i.prototype.toString=function(){return this.isSimple?`[${this.left.join(", ")} |- ${this.right}]`:`[${this.from.join(", ")} -> ${this.to}]`},i.prototype.equals=function(e){if(!(e instanceof i))return!1;if(this.isSimple!=e.isSimple)return!1;if(this.isSimple){if(this.left.length!=e.left.length)return!1;for(let t=0;t<this.left.length;t++)if(!this.left[t].equals(e.left[t]))return!1;return!!this.right.equals(e.right)}if(this.from.length!=e.from.length)return!1;for(let t=0;t<this.from.length;t++)if(!this.from[t].equals(e.from[t]))return!1;return this.to.equals(e.to)},e.exports=i},function(e,t,r){var n=r(12),o=r(13);e.exports={parser:n,Program:o}},function(e,t,r){"use strict";function n(e,t,r,o){this.message=e,this.expected=t,this.found=r,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}!function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(n,Error),n.buildMessage=function(e,t){var r={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,o,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(o=e[t],r[o.type](o));if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:n,parse:function(e,t){t=void 0!==t?t:{};var r,o={},i={start:xe},a=xe,s=fe("base",!1),u=fe("type",!1),l=fe(":",!1),h=fe("@",!1),c=/^[a-z0-9_]/,p=de([["a","z"],["0","9"],"_"],!1,!1),f=fe("(",!1),d=fe(",",!1),m=function(e,t,r,n,o,i){return i},y=fe(")",!1),g=fe("{",!1),v=fe("}",!1),x="axiomatic",w=fe("axiomatic",!1),A=fe("native",!1),C=fe("schema",!1),T=function(e,t,r,n,o){return o},S=fe("ruleset",!1),b=fe("?",!1),$=function(e,t,r){return r},_=fe("[",!1),P=function(e,t,r,n){return n},E=function(e,t,r,n){return[r].concat(n)},M=fe("]",!1),j=function(e,t,r){return r||[]},O=function(e,t,r){return r},X=function(e,t,r){return r},I=function(e,t){return t},F=function(e,t){return[e].concat(t)},R=function(e){return e||[]},q=fe("=>",!1),k=fe("~",!1),N=function(e,t){return t},U=fe("|-",!1),L=function(e,t){return t},z=fe("->",!1),D=fe(".",!1),Q=/^[a-zA-Z0-9_]/,B=de([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),H=fe('"',!1),Z={type:"any"},G=fe("$",!1),V=fe("#",!1),J=fe("//",!1),K=fe("/*",!1),W=fe("*/",!1),Y=fe("\r\n",!1),ee=fe("\r",!1),te=fe("\n",!1),re=/^[ \t\n\r]/,ne=de([" ","\t","\n","\r"],!1,!1),oe=fe(";",!1),ie=0,ae=0,se=[{line:1,column:1}],ue=0,le=[],he=0,ce={};if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=i[t.startRule]}function pe(){return ye(ae,ie)}function fe(e,t){return{type:"literal",text:e,ignoreCase:t}}function de(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function me(t){var r,n=se[t];if(n)return n;for(r=t-1;!se[r];)r--;for(n={line:(n=se[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return se[t]=n,n}function ye(e,t){var r=me(e),n=me(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function ge(e){ie<ue||(ie>ue&&(ue=ie,le=[]),le.push(e))}function ve(e,t,r){return new n(n.buildMessage(e,t),e,t,r)}function xe(){var e,t,r,n,i=31*ie+0,a=ce[i];if(a)return ie=a.nextPos,a.result;if(e=ie,Ue()!==o){for(t=[],r=ie,(n=we())!==o&&Ue()!==o?(ae=r,r=n=n):(ie=r,r=o);r!==o;)t.push(r),r=ie,(n=we())!==o&&Ue()!==o?(ae=r,r=n=n):(ie=r,r=o);t!==o?(ae=e,e=t):(ie=e,e=o)}else ie=e,e=o;return ce[i]={nextPos:ie,result:e},e}function we(){var t,r=31*ie+1,n=ce[r];return n?(ie=n.nextPos,n.result):((t=function(){var t,r,n,i,a,l,h,c=31*ie+2,p=ce[c];if(p)return ie=p.nextPos,p.result;t=ie,r=ie,(n=Re())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o);r===o&&(r=null);r!==o?(n=ie,"base"===e.substr(ie,4)?(i="base",ie+=4):(i=o,0===he&&ge(s)),i!==o&&(a=Le())!==o?n=i=[i,a]:(ie=n,n=o),n===o&&(n=null),n!==o?("type"===e.substr(ie,4)?(i="type",ie+=4):(i=o,0===he&&ge(u)),i!==o&&(a=Le())!==o?(l=ie,(h=Xe())!==o&&Le()!==o?(ae=l,l=h=h):(ie=l,l=o),l===o&&(l=null),l!==o&&(h=Fe())!==o&&Ue()!==o&&ze()!==o?(ae=t,d=n,m=l,y=h,r={_type:"typedef",doc:f=(f=r)&&f[0],base:!!d,origin:m,name:y,location:pe()},t=r):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o);var f,d,m,y;return ce[c]={nextPos:ie,result:t},t}())===o&&(t=function(){var e,t,r,n,i,a,s=31*ie+3,u=ce[s];if(u)return ie=u.nextPos,u.result;e=ie,t=ie,(r=Re())!==o&&(n=Le())!==o?t=r=[r,n]:(ie=t,t=o);t===o&&(t=null);t!==o?(r=ie,(n=qe())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o),r===o&&(r=null),r!==o&&(n=Oe())!==o&&(i=Le())!==o&&(a=Fe())!==o&&Ue()!==o&&ze()!==o?(ae=e,h=r,c=n,p=a,t={_type:"defv",doc:(l=t)&&l[0],tex:h&&h[0],type:c,name:p,location:pe()},e=t):(ie=e,e=o)):(ie=e,e=o);var l,h,c,p;return ce[s]={nextPos:ie,result:e},e}())===o&&(t=function(){var t,r,n,i,a,s,u,l,h,c,p,x,w,A,C,T=31*ie+6,S=ce[T];if(S)return ie=S.nextPos,S.result;t=ie,r=ie,(n=Re())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o);r===o&&(r=null);if(r!==o)if(n=ie,(i=qe())!==o&&(a=Le())!==o?n=i=[i,a]:(ie=n,n=o),n===o&&(n=null),n!==o)if((i=Oe())!==o)if((a=Le())!==o)if((s=Fe())!==o)if(Ue()!==o){if(u=ie,40===e.charCodeAt(ie)?(l="(",ie++):(l=o,0===he&&ge(f)),l!==o)if((h=Ue())!==o){if(c=ie,(p=Ae())!==o)if(Ue()!==o){for(x=[],w=ie,44===e.charCodeAt(ie)?(A=",",ie++):(A=o,0===he&&ge(d)),A!==o&&Ue()!==o&&(C=Ae())!==o&&Ue()!==o?(ae=w,A=m(0,0,0,0,0,C),w=A):(ie=w,w=o);w!==o;)x.push(w),w=ie,44===e.charCodeAt(ie)?(A=",",ie++):(A=o,0===he&&ge(d)),A!==o&&Ue()!==o&&(C=Ae())!==o&&Ue()!==o?(ae=w,A=m(0,0,0,0,0,C),w=A):(ie=w,w=o);x!==o?(ae=c,p=[p].concat(x),c=p):(ie=c,c=o)}else ie=c,c=o;else ie=c,c=o;c===o&&(c=null),c!==o?(41===e.charCodeAt(ie)?(p=")",ie++):(p=o,0===he&&ge(y)),p!==o&&Ue()!==o?(ae=u,u=l=c||[]):(ie=u,u=o)):(ie=u,u=o)}else ie=u,u=o;else ie=u,u=o;u!==o?(l=ie,123===e.charCodeAt(ie)?(h="{",ie++):(h=o,0===he&&ge(g)),h!==o&&(c=Ue())!==o&&(p=je())!==o&&Ue()!==o?(125===e.charCodeAt(ie)?(x="}",ie++):(x=o,0===he&&ge(v)),x!==o?(ae=l,l=h=p):(ie=l,l=o)):(ie=l,l=o),l===o&&(l=ie,(h=ze())!==o&&(ae=l,h=null),l=h),l!==o?(ae=t,r=function(e,t,r,n,o,i){return{_type:"defun",doc:e&&e[0],tex:t&&t[0],rettype:r,name:n,params:o,expr:i,location:pe()}}(r,n,i,s,u,l),t=r):(ie=t,t=o)):(ie=t,t=o)}else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;return ce[T]={nextPos:ie,result:t},t}())===o&&(t=function(){var t,r,n,i,a,s,u,l=31*ie+8,h=ce[l];if(h)return ie=h.nextPos,h.result;t=ie,r=ie,(n=Re())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o);r===o&&(r=null);r!==o?(n=ie,e.substr(ie,9)===x?(i=x,ie+=9):(i=o,0===he&&ge(w)),i!==o&&(a=Le())!==o?n=i=[i,a]:(ie=n,n=o),n===o&&(n=null),n!==o?("native"===e.substr(ie,6)?(i="native",ie+=6):(i=o,0===he&&ge(A)),i!==o&&(a=Le())!==o?("ruleset"===e.substr(ie,7)?(s="ruleset",ie+=7):(s=o,0===he&&ge(S)),s!==o&&Le()!==o&&(u=Fe())!==o&&Ue()!==o&&ze()!==o?(ae=t,p=n,f=u,r={_type:"defruleset",doc:(c=r)&&c[0],axiomatic:!!p,name:f,native:!0,location:pe()},t=r):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o);var c,p,f;return ce[l]={nextPos:ie,result:t},t}())===o&&(t=function(){var t,r,n,i,a,s,u,l,h,c,p,m,S,b,$,_=31*ie+7,P=ce[_];if(P)return ie=P.nextPos,P.result;t=ie,r=ie,(n=Re())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o);r===o&&(r=null);r!==o?(n=ie,e.substr(ie,9)===x?(i=x,ie+=9):(i=o,0===he&&ge(w)),i!==o&&(a=Le())!==o?n=i=[i,a]:(ie=n,n=o),n===o&&(n=null),n!==o?("native"===e.substr(ie,6)?(i="native",ie+=6):(i=o,0===he&&ge(A)),i!==o&&(a=Le())!==o?("schema"===e.substr(ie,6)?(s="schema",ie+=6):(s=o,0===he&&ge(C)),s!==o&&Le()!==o&&(u=Fe())!==o&&(l=Ue())!==o&&ze()!==o?(ae=t,M=n,j=u,r={_type:"defschema",doc:(E=r)&&E[0],axiomatic:!!M,name:j,native:!0,location:pe()},t=r):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o);var E,M,j;if(t===o)if(t=ie,r=ie,(n=Re())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o),r===o&&(r=null),r!==o)if(n=ie,e.substr(ie,9)===x?(i=x,ie+=9):(i=o,0===he&&ge(w)),i!==o&&(a=Le())!==o?n=i=[i,a]:(ie=n,n=o),n===o&&(n=null),n!==o)if("schema"===e.substr(ie,6)?(i="schema",ie+=6):(i=o,0===he&&ge(C)),i!==o)if((a=Le())!==o)if((s=Fe())!==o)if(Ue()!==o){if(u=ie,40===e.charCodeAt(ie)?(l="(",ie++):(l=o,0===he&&ge(f)),l!==o)if(Ue()!==o){if(h=ie,(c=Ce())!==o)if((p=Ue())!==o){for(m=[],S=ie,44===e.charCodeAt(ie)?(b=",",ie++):(b=o,0===he&&ge(d)),b!==o&&Ue()!==o&&($=Ce())!==o&&Ue()!==o?(ae=S,b=T(0,0,0,0,$),S=b):(ie=S,S=o);S!==o;)m.push(S),S=ie,44===e.charCodeAt(ie)?(b=",",ie++):(b=o,0===he&&ge(d)),b!==o&&Ue()!==o&&($=Ce())!==o&&Ue()!==o?(ae=S,b=T(0,0,0,0,$),S=b):(ie=S,S=o);m!==o?(ae=h,c=[c].concat(m),h=c):(ie=h,h=o)}else ie=h,h=o;else ie=h,h=o;h===o&&(h=null),h!==o?(41===e.charCodeAt(ie)?(c=")",ie++):(c=o,0===he&&ge(y)),c!==o&&(p=Ue())!==o?(ae=u,u=l=h||[]):(ie=u,u=o)):(ie=u,u=o)}else ie=u,u=o;else ie=u,u=o;u!==o?(123===e.charCodeAt(ie)?(l="{",ie++):(l=o,0===he&&ge(g)),l!==o&&Ue()!==o&&(h=Pe())!==o&&(c=Ue())!==o?(125===e.charCodeAt(ie)?(p="}",ie++):(p=o,0===he&&ge(v)),p!==o?(ae=t,r=function(e,t,r,n,o){return{_type:"defschema",doc:e&&e[0],axiomatic:!!t,name:r,native:!1,params:n,expr:o,location:pe()}}(r,n,s,u,h),t=r):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)}else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;return ce[_]={nextPos:ie,result:t},t}()),ce[r]={nextPos:ie,result:t},t)}function Ae(){var e,t,r,n,i,a,s,u=31*ie+4,l=ce[u];return l?(ie=l.nextPos,l.result):(e=ie,t=ie,(r=qe())!==o&&(n=Le())!==o?t=r=[r,n]:(ie=t,t=o),t===o&&(t=null),t!==o&&(r=Oe())!==o&&(n=Le())!==o&&(i=Fe())!==o?(ae=e,s=i,e=t={_type:"defv",isParam:!0,type:r,tex:(a=t)&&a[0],name:s,location:pe()}):(ie=e,e=o),ce[u]={nextPos:ie,result:e},e)}function Ce(){var t,r,n,i,a,s,u,f,d,m,y,g,v,x=31*ie+5,w=ce[x];if(w)return ie=w.nextPos,w.result;if(t=ie,r=ie,(n=qe())!==o&&(i=Le())!==o?r=n=[n,i]:(ie=r,r=o),r===o&&(r=null),r!==o)if((n=Oe())!==o)if((i=Le())!==o)if((a=Fe())!==o){if(s=ie,Ue()!==o)if(58===e.charCodeAt(ie)?(u=":",ie++):(u=o,0===he&&ge(l)),u!==o)if(Ue()!==o)if(64===e.charCodeAt(ie)?(f="@",ie++):(f=o,0===he&&ge(h)),f!==o){if(d=ie,m=[],c.test(e.charAt(ie))?(y=e.charAt(ie),ie++):(y=o,0===he&&ge(p)),y!==o)for(;y!==o;)m.push(y),c.test(e.charAt(ie))?(y=e.charAt(ie),ie++):(y=o,0===he&&ge(p));else m=o;(d=m!==o?e.substring(d,ie):m)!==o?(ae=s,s=d):(ie=s,s=o)}else ie=s,s=o;else ie=s,s=o;else ie=s,s=o;else ie=s,s=o;s===o&&(s=null),s!==o?(ae=t,v=a,t=r={_type:"defv",isParam:!0,guess:s,type:n,tex:(g=r)&&g[0],name:v,location:pe()}):(ie=t,t=o)}else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;else ie=t,t=o;return ce[x]={nextPos:ie,result:t},t}function Te(){var t,r,n,i,a,s,u,l,h,c,p,m,g,v,x,w,A=31*ie+9,C=ce[A];if(C)return ie=C.nextPos,C.result;if(t=ie,(r=Se())===o&&(r=Ie())===o&&(r=ie,40===e.charCodeAt(ie)?(n="(",ie++):(n=o,0===he&&ge(f)),n!==o&&(i=Ue())!==o&&(a=Pe())!==o&&(s=Ue())!==o?(41===e.charCodeAt(ie)?(u=")",ie++):(u=o,0===he&&ge(y)),u!==o?(ae=r,r=n=a):(ie=r,r=o)):(ie=r,r=o)),r!==o)if((n=Ue())!==o){if(i=ie,40===e.charCodeAt(ie)?(a="(",ie++):(a=o,0===he&&ge(f)),a!==o)if((s=Ue())!==o){if(u=ie,l=ie,63===e.charCodeAt(ie)?(h="?",ie++):(h=o,0===he&&ge(b)),h!==o&&(ae=l,h=null),(l=h)===o&&(l=je()),l!==o)if((h=Ue())!==o){for(c=[],p=ie,44===e.charCodeAt(ie)?(m=",",ie++):(m=o,0===he&&ge(d)),m!==o&&(g=Ue())!==o?(v=ie,63===e.charCodeAt(ie)?(x="?",ie++):(x=o,0===he&&ge(b)),x!==o&&(ae=v,x=null),(v=x)===o&&(v=je()),v!==o&&(x=Ue())!==o?(ae=p,p=m=$(0,0,v)):(ie=p,p=o)):(ie=p,p=o);p!==o;)c.push(p),p=ie,44===e.charCodeAt(ie)?(m=",",ie++):(m=o,0===he&&ge(d)),m!==o&&(g=Ue())!==o?(v=ie,63===e.charCodeAt(ie)?(x="?",ie++):(x=o,0===he&&ge(b)),x!==o&&(ae=v,x=null),(v=x)===o&&(v=je()),v!==o&&(x=Ue())!==o?(ae=p,p=m=$(0,0,v)):(ie=p,p=o)):(ie=p,p=o);c!==o?(ae=u,u=l=[l].concat(c)):(ie=u,u=o)}else ie=u,u=o;else ie=u,u=o;u===o&&(u=null),u!==o?(41===e.charCodeAt(ie)?(l=")",ie++):(l=o,0===he&&ge(y)),l!==o?(ae=i,i=a=u||[]):(ie=i,i=o)):(ie=i,i=o)}else ie=i,i=o;else ie=i,i=o;if(i===o&&(i=null),i!==o){if(a=[],s=ie,91===e.charCodeAt(ie)?(u="[",ie++):(u=o,0===he&&ge(_)),u!==o)if((l=Ue())!==o){if(h=ie,(c=Pe())!==o)if((p=Ue())!==o){for(m=[],g=ie,44===e.charCodeAt(ie)?(v=",",ie++):(v=o,0===he&&ge(d)),v!==o&&(x=Ue())!==o&&(w=Pe())!==o&&Ue()!==o?(ae=g,g=v=P(0,0,0,w)):(ie=g,g=o);g!==o;)m.push(g),g=ie,44===e.charCodeAt(ie)?(v=",",ie++):(v=o,0===he&&ge(d)),v!==o&&(x=Ue())!==o&&(w=Pe())!==o&&Ue()!==o?(ae=g,g=v=P(0,0,0,w)):(ie=g,g=o);m!==o?(ae=h,h=c=E(0,0,c,m)):(ie=h,h=o)}else ie=h,h=o;else ie=h,h=o;h===o&&(h=null),h!==o?(93===e.charCodeAt(ie)?(c="]",ie++):(c=o,0===he&&ge(M)),c!==o?(ae=s,s=u=j(0,0,h)):(ie=s,s=o)):(ie=s,s=o)}else ie=s,s=o;else ie=s,s=o;if(s!==o)for(;s!==o;)if(a.push(s),s=ie,91===e.charCodeAt(ie)?(u="[",ie++):(u=o,0===he&&ge(_)),u!==o)if((l=Ue())!==o){if(h=ie,(c=Pe())!==o)if((p=Ue())!==o){for(m=[],g=ie,44===e.charCodeAt(ie)?(v=",",ie++):(v=o,0===he&&ge(d)),v!==o&&(x=Ue())!==o&&(w=Pe())!==o&&Ue()!==o?(ae=g,g=v=P(0,0,0,w)):(ie=g,g=o);g!==o;)m.push(g),g=ie,44===e.charCodeAt(ie)?(v=",",ie++):(v=o,0===he&&ge(d)),v!==o&&(x=Ue())!==o&&(w=Pe())!==o&&Ue()!==o?(ae=g,g=v=P(0,0,0,w)):(ie=g,g=o);m!==o?(ae=h,h=c=E(0,0,c,m)):(ie=h,h=o)}else ie=h,h=o;else ie=h,h=o;h===o&&(h=null),h!==o?(93===e.charCodeAt(ie)?(c="]",ie++):(c=o,0===he&&ge(M)),c!==o?(ae=s,s=u=j(0,0,h)):(ie=s,s=o)):(ie=s,s=o)}else ie=s,s=o;else ie=s,s=o;else a=o;a!==o?(ae=t,t=r=function(e,t,r){for(var n={_type:"reduction",subject:e,guesses:t,leftargs:r[0],location:pe()},o=1;o<r.length;o++)n={_type:"reduction",subject:n,guesses:null,leftargs:r[o],location:pe()};return n}(r,i,a)):(ie=t,t=o)}else ie=t,t=o}else ie=t,t=o;else ie=t,t=o;return ce[A]={nextPos:ie,result:t},t}function Se(){var t,r,n,i,a,s,u,l,h,c,p,m=31*ie+10,g=ce[m];if(g)return ie=g.nextPos,g.result;if(t=ie,(r=Ie())===o&&(r=ie,40===e.charCodeAt(ie)?(n="(",ie++):(n=o,0===he&&ge(f)),n!==o&&(i=Ue())!==o&&(a=Pe())!==o&&Ue()!==o?(41===e.charCodeAt(ie)?(s=")",ie++):(s=o,0===he&&ge(y)),s!==o?(ae=r,r=n=a):(ie=r,r=o)):(ie=r,r=o)),r!==o)if((n=Ue())!==o){if(i=ie,40===e.charCodeAt(ie)?(a="(",ie++):(a=o,0===he&&ge(f)),a!==o)if(Ue()!==o){if(s=ie,(u=je())!==o)if(Ue()!==o){for(l=[],h=ie,44===e.charCodeAt(ie)?(c=",",ie++):(c=o,0===he&&ge(d)),c!==o&&Ue()!==o&&(p=je())!==o&&Ue()!==o?(ae=h,h=c=O(0,0,p)):(ie=h,h=o);h!==o;)l.push(h),h=ie,44===e.charCodeAt(ie)?(c=",",ie++):(c=o,0===he&&ge(d)),c!==o&&Ue()!==o&&(p=je())!==o&&Ue()!==o?(ae=h,h=c=O(0,0,p)):(ie=h,h=o);l!==o?(ae=s,s=u=[u].concat(l)):(ie=s,s=o)}else ie=s,s=o;else ie=s,s=o;s===o&&(s=null),s!==o?(41===e.charCodeAt(ie)?(u=")",ie++):(u=o,0===he&&ge(y)),u!==o?(ae=i,i=a=s||[]):(ie=i,i=o)):(ie=i,i=o)}else ie=i,i=o;else ie=i,i=o;i!==o?(ae=t,t=r={_type:"schemacall",schema:r,args:i,location:pe()}):(ie=t,t=o)}else ie=t,t=o;else ie=t,t=o;return ce[m]={nextPos:ie,result:t},t}function be(){var t,r,n,i,a,s,u,l,h,c,p,m=31*ie+11,g=ce[m];if(g)return ie=g.nextPos,g.result;if(t=ie,(r=Ie())===o&&(r=ie,40===e.charCodeAt(ie)?(n="(",ie++):(n=o,0===he&&ge(f)),n!==o&&(i=Ue())!==o&&(a=je())!==o&&Ue()!==o?(41===e.charCodeAt(ie)?(s=")",ie++):(s=o,0===he&&ge(y)),s!==o?(ae=r,r=n=a):(ie=r,r=o)):(ie=r,r=o)),r!==o)if((n=Ue())!==o){if(i=ie,40===e.charCodeAt(ie)?(a="(",ie++):(a=o,0===he&&ge(f)),a!==o)if(Ue()!==o){if(s=ie,(u=je())!==o)if(Ue()!==o){for(l=[],h=ie,44===e.charCodeAt(ie)?(c=",",ie++):(c=o,0===he&&ge(d)),c!==o&&Ue()!==o&&(p=je())!==o&&Ue()!==o?(ae=h,h=c=X(0,0,p)):(ie=h,h=o);h!==o;)l.push(h),h=ie,44===e.charCodeAt(ie)?(c=",",ie++):(c=o,0===he&&ge(d)),c!==o&&Ue()!==o&&(p=je())!==o&&Ue()!==o?(ae=h,h=c=X(0,0,p)):(ie=h,h=o);l!==o?(ae=s,s=u=[u].concat(l)):(ie=s,s=o)}else ie=s,s=o;else ie=s,s=o;s===o&&(s=null),s!==o?(41===e.charCodeAt(ie)?(u=")",ie++):(u=o,0===he&&ge(y)),u!==o?(ae=i,i=a=s||[]):(ie=i,i=o)):(ie=i,i=o)}else ie=i,i=o;else ie=i,i=o;i!==o?(ae=t,t=r={_type:"funcall",fun:r,args:i,location:pe()}):(ie=t,t=o)}else ie=t,t=o;else ie=t,t=o;return ce[m]={nextPos:ie,result:t},t}function $e(){var t,r,n,i,a,s,u,l,h,c,p=31*ie+12,m=ce[p];if(m)return ie=m.nextPos,m.result;if(t=ie,r=ie,40===e.charCodeAt(ie)?(n="(",ie++):(n=o,0===he&&ge(f)),n!==o)if(Ue()!==o){if(i=ie,(a=Ae())!==o)if((s=Ue())!==o){for(u=[],l=ie,44===e.charCodeAt(ie)?(h=",",ie++):(h=o,0===he&&ge(d)),h!==o&&Ue()!==o&&(c=Ae())!==o&&Ue()!==o?(ae=l,l=h=I(0,c)):(ie=l,l=o);l!==o;)u.push(l),l=ie,44===e.charCodeAt(ie)?(h=",",ie++):(h=o,0===he&&ge(d)),h!==o&&Ue()!==o&&(c=Ae())!==o&&Ue()!==o?(ae=l,l=h=I(0,c)):(ie=l,l=o);u!==o?(ae=i,i=a=F(a,u)):(ie=i,i=o)}else ie=i,i=o;else ie=i,i=o;i===o&&(i=null),i!==o?(41===e.charCodeAt(ie)?(a=")",ie++):(a=o,0===he&&ge(y)),a!==o&&(s=Ue())!==o?(ae=r,r=n=R(i)):(ie=r,r=o)):(ie=r,r=o)}else ie=r,r=o;else ie=r,r=o;return r!==o?("=>"===e.substr(ie,2)?(n="=>",ie+=2):(n=o,0===he&&ge(q)),n!==o&&Ue()!==o?(123===e.charCodeAt(ie)?(i="{",ie++):(i=o,0===he&&ge(g)),i!==o&&(a=Ue())!==o&&(s=je())!==o&&(u=Ue())!==o?(125===e.charCodeAt(ie)?(l="}",ie++):(l=o,0===he&&ge(v)),l!==o?(ae=t,t=r={_type:"funexpr",params:r,expr:s,location:pe()}):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o),ce[p]={nextPos:ie,result:t},t}function _e(){var t,r,n,i,a,s,u,l,h,c,p=31*ie+13,m=ce[p];if(m)return ie=m.nextPos,m.result;if(t=ie,r=ie,40===e.charCodeAt(ie)?(n="(",ie++):(n=o,0===he&&ge(f)),n!==o)if(Ue()!==o){if(i=ie,(a=Ae())!==o)if((s=Ue())!==o){for(u=[],l=ie,44===e.charCodeAt(ie)?(h=",",ie++):(h=o,0===he&&ge(d)),h!==o&&Ue()!==o&&(c=Ae())!==o&&Ue()!==o?(ae=l,l=h=I(0,c)):(ie=l,l=o);l!==o;)u.push(l),l=ie,44===e.charCodeAt(ie)?(h=",",ie++):(h=o,0===he&&ge(d)),h!==o&&Ue()!==o&&(c=Ae())!==o&&Ue()!==o?(ae=l,l=h=I(0,c)):(ie=l,l=o);u!==o?(ae=i,i=a=F(a,u)):(ie=i,i=o)}else ie=i,i=o;else ie=i,i=o;i===o&&(i=null),i!==o?(41===e.charCodeAt(ie)?(a=")",ie++):(a=o,0===he&&ge(y)),a!==o&&(s=Ue())!==o?(ae=r,r=n=R(i)):(ie=r,r=o)):(ie=r,r=o)}else ie=r,r=o;else ie=r,r=o;return r!==o?("=>"===e.substr(ie,2)?(n="=>",ie+=2):(n=o,0===he&&ge(q)),n!==o&&Ue()!==o?(123===e.charCodeAt(ie)?(i="{",ie++):(i=o,0===he&&ge(g)),i!==o&&(a=Ue())!==o&&(s=Pe())!==o&&(u=Ue())!==o?(125===e.charCodeAt(ie)?(l="}",ie++):(l=o,0===he&&ge(v)),l!==o?(ae=t,t=r={_type:"schemaexpr",doc:!1,axiomatic:!1,name:null,params:r,expr:s,location:pe()}):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o),ce[p]={nextPos:ie,result:t},t}function Pe(){var t,r,n,i,a,s,u=31*ie+14,l=ce[u];return l?(ie=l.nextPos,l.result):(t=ie,(r=Ee())!==o&&Ue()!==o?(126===e.charCodeAt(ie)?(n="~",ie++):(n=o,0===he&&ge(k)),n!==o&&Ue()!==o&&(i=Pe())!==o?(ae=t,a=r,s=i,t=r={_type:"reduction",subject:{_type:"var",type:"normal",name:"cut",location:pe()},leftargs:[a,s],location:pe()}):(ie=t,t=o)):(ie=t,t=o),t===o&&(t=Ee()),ce[u]={nextPos:ie,result:t},t)}function Ee(){var t,r,n,i,a,s,u,l,h,c=31*ie+15,p=ce[c];if(p)return ie=p.nextPos,p.result;if(t=ie,r=ie,n=ie,(i=Me())!==o)if((a=Ue())!==o){for(s=[],u=ie,44===e.charCodeAt(ie)?(l=",",ie++):(l=o,0===he&&ge(d)),l!==o&&Ue()!==o&&(h=Me())!==o&&Ue()!==o?(ae=u,u=l=N(0,h)):(ie=u,u=o);u!==o;)s.push(u),u=ie,44===e.charCodeAt(ie)?(l=",",ie++):(l=o,0===he&&ge(d)),l!==o&&Ue()!==o&&(h=Me())!==o&&Ue()!==o?(ae=u,u=l=N(0,h)):(ie=u,u=o);s!==o?(ae=n,n=i=F(i,s)):(ie=n,n=o)}else ie=n,n=o;else ie=n,n=o;return n===o&&(n=null),n!==o&&(ae=r,n=n||[]),(r=n)!==o?("|-"===e.substr(ie,2)?(n="|-",ie+=2):(n=o,0===he&&ge(U)),n!==o&&(i=Ue())!==o&&(a=Ee())!==o?(ae=t,t=r={_type:"tee",left:r,right:a,location:pe()}):(ie=t,t=o)):(ie=t,t=o),t===o&&(t=Me()),ce[c]={nextPos:ie,result:t},t}function Me(){var t,r,n,i,a=31*ie+16,s=ce[a];return s?(ie=s.nextPos,s.result):((t=Te())===o&&(t=Se())===o&&(t=Ie())===o&&(t=_e())===o&&(t=ie,40===e.charCodeAt(ie)?(r="(",ie++):(r=o,0===he&&ge(f)),r!==o&&Ue()!==o&&(n=Pe())!==o&&Ue()!==o?(41===e.charCodeAt(ie)?(i=")",ie++):(i=o,0===he&&ge(y)),i!==o?(ae=t,t=r=n):(ie=t,t=o)):(ie=t,t=o)),ce[a]={nextPos:ie,result:t},t)}function je(){var t,r,n,i,a=31*ie+17,s=ce[a];return s?(ie=s.nextPos,s.result):((t=be())===o&&(t=$e())===o&&(t=Ie())===o&&(t=ie,40===e.charCodeAt(ie)?(r="(",ie++):(r=o,0===he&&ge(f)),r!==o&&Ue()!==o&&(n=je())!==o&&Ue()!==o?(41===e.charCodeAt(ie)?(i=")",ie++):(i=o,0===he&&ge(y)),i!==o?(ae=t,t=r=n):(ie=t,t=o)):(ie=t,t=o)),ce[a]={nextPos:ie,result:t},t)}function Oe(){var e,t=31*ie+18,r=ce[t];return r?(ie=r.nextPos,r.result):((e=function(){var e,t,r=31*ie+19,n=ce[r];if(n)return ie=n.nextPos,n.result;e=ie,(t=Fe())!==o&&(ae=e,t={_type:"type",ftype:!1,name:t,location:pe()});return e=t,ce[r]={nextPos:ie,result:e},e}())===o&&(e=Xe()),ce[t]={nextPos:ie,result:e},e)}function Xe(){var t,r,n,i,a,s,u,l,h,c,p,m=31*ie+20,g=ce[m];if(g)return ie=g.nextPos,g.result;if(t=ie,91===e.charCodeAt(ie)?(r="[",ie++):(r=o,0===he&&ge(_)),r!==o)if(Ue()!==o){if(n=ie,(i=Oe())!==o&&(ae=n,i=[i]),(n=i)===o){if(n=ie,i=ie,40===e.charCodeAt(ie)?(a="(",ie++):(a=o,0===he&&ge(f)),a!==o)if(Ue()!==o)if((s=Oe())!==o){for(u=[],l=ie,(h=Ue())!==o?(44===e.charCodeAt(ie)?(c=",",ie++):(c=o,0===he&&ge(d)),c!==o&&Ue()!==o&&(p=Oe())!==o?(ae=l,l=h=L(0,p)):(ie=l,l=o)):(ie=l,l=o);l!==o;)u.push(l),l=ie,(h=Ue())!==o?(44===e.charCodeAt(ie)?(c=",",ie++):(c=o,0===he&&ge(d)),c!==o&&Ue()!==o&&(p=Oe())!==o?(ae=l,l=h=L(0,p)):(ie=l,l=o)):(ie=l,l=o);u!==o&&(l=Ue())!==o?(41===e.charCodeAt(ie)?(h=")",ie++):(h=o,0===he&&ge(y)),h!==o?(ae=i,i=a=F(s,u)):(ie=i,i=o)):(ie=i,i=o)}else ie=i,i=o;else ie=i,i=o;else ie=i,i=o;i!==o&&(ae=n,i=i),n=i}n!==o&&(i=Ue())!==o?("->"===e.substr(ie,2)?(a="->",ie+=2):(a=o,0===he&&ge(z)),a!==o&&Ue()!==o&&(s=Oe())!==o&&(u=Ue())!==o?(93===e.charCodeAt(ie)?(l="]",ie++):(l=o,0===he&&ge(M)),l!==o?(ae=t,t=r={_type:"type",ftype:!0,from:n,to:s,location:pe()}):(ie=t,t=o)):(ie=t,t=o)):(ie=t,t=o)}else ie=t,t=o;else ie=t,t=o;return ce[m]={nextPos:ie,result:t},t}function Ie(){var t,r,n,i,a,s,u=31*ie+21,l=ce[u];return l?(ie=l.nextPos,l.result):(t=ie,r=ie,(n=Fe())!==o&&Ue()!==o?(46===e.charCodeAt(ie)?(i=".",ie++):(i=o,0===he&&ge(D)),i!==o&&Ue()!==o?(ae=r,r=n=n):(ie=r,r=o)):(ie=r,r=o),r===o&&(r=null),r!==o&&(n=Fe())!==o?(ae=t,s=n,t=r=(a=r)?{_type:"var",type:"ruleset",rulesetName:a,name:s,location:pe()}:{_type:"var",type:"normal",name:s,location:pe()}):(ie=t,t=o),ce[u]={nextPos:ie,result:t},t)}function Fe(){var t,r,n,i,a,l,h=31*ie+23,c=ce[h];if(c)return ie=c.nextPos,c.result;if(t=ie,r=ie,n=ie,he++,i=function(){var t,r=31*ie+22,n=ce[r];return n?(ie=n.nextPos,n.result):(e.substr(ie,9)===x?(t=x,ie+=9):(t=o,0===he&&ge(w)),t===o&&("base"===e.substr(ie,4)?(t="base",ie+=4):(t=o,0===he&&ge(s)),t===o&&("native"===e.substr(ie,6)?(t="native",ie+=6):(t=o,0===he&&ge(A)),t===o&&("ruleset"===e.substr(ie,7)?(t="ruleset",ie+=7):(t=o,0===he&&ge(S)),t===o&&("schema"===e.substr(ie,6)?(t="schema",ie+=6):(t=o,0===he&&ge(C)),t===o&&("type"===e.substr(ie,4)?(t="type",ie+=4):(t=o,0===he&&ge(u))))))),ce[r]={nextPos:ie,result:t},t)}(),he--,i===o?n=void 0:(ie=n,n=o),n!==o){if(i=ie,a=[],Q.test(e.charAt(ie))?(l=e.charAt(ie),ie++):(l=o,0===he&&ge(B)),l!==o)for(;l!==o;)a.push(l),Q.test(e.charAt(ie))?(l=e.charAt(ie),ie++):(l=o,0===he&&ge(B));else a=o;(i=a!==o?e.substring(i,ie):a)!==o?r=n=[n,i]:(ie=r,r=o)}else ie=r,r=o;return t=r!==o?e.substring(t,ie):r,ce[h]={nextPos:ie,result:t},t}function Re(){var t,r,n,i,a,s,u=31*ie+24,l=ce[u];if(l)return ie=l.nextPos,l.result;if(t=ie,34===e.charCodeAt(ie)?(r='"',ie++):(r=o,0===he&&ge(H)),r!==o){for(n=[],i=ie,a=ie,he++,34===e.charCodeAt(ie)?(s='"',ie++):(s=o,0===he&&ge(H)),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?(ae=i,i=a=s):(ie=i,i=o)):(ie=i,i=o);i!==o;)n.push(i),i=ie,a=ie,he++,34===e.charCodeAt(ie)?(s='"',ie++):(s=o,0===he&&ge(H)),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?(ae=i,i=a=s):(ie=i,i=o)):(ie=i,i=o);n!==o?(34===e.charCodeAt(ie)?(i='"',ie++):(i=o,0===he&&ge(H)),i!==o?(ae=t,t=r=n.join("")):(ie=t,t=o)):(ie=t,t=o)}else ie=t,t=o;return ce[u]={nextPos:ie,result:t},t}function qe(){var t,r,n,i,a,s,u,l=31*ie+25,h=ce[l];if(h)return ie=h.nextPos,h.result;if(t=ie,36===e.charCodeAt(ie)?(r="$",ie++):(r=o,0===he&&ge(G)),r!==o){for(n=ie,i=[],a=ie,s=ie,he++,36===e.charCodeAt(ie)?(u="$",ie++):(u=o,0===he&&ge(G)),he--,u===o?s=void 0:(ie=s,s=o),s!==o?(e.length>ie?(u=e.charAt(ie),ie++):(u=o,0===he&&ge(Z)),u!==o?(ae=a,a=s=u):(ie=a,a=o)):(ie=a,a=o);a!==o;)i.push(a),a=ie,s=ie,he++,36===e.charCodeAt(ie)?(u="$",ie++):(u=o,0===he&&ge(G)),he--,u===o?s=void 0:(ie=s,s=o),s!==o?(e.length>ie?(u=e.charAt(ie),ie++):(u=o,0===he&&ge(Z)),u!==o?(ae=a,a=s=u):(ie=a,a=o)):(ie=a,a=o);(n=i!==o?e.substring(n,ie):i)!==o?(36===e.charCodeAt(ie)?(i="$",ie++):(i=o,0===he&&ge(G)),i!==o?(ae=t,t=r=n):(ie=t,t=o)):(ie=t,t=o)}else ie=t,t=o;return ce[l]={nextPos:ie,result:t},t}function ke(){var t,r,n,i,a,s,u=31*ie+26,l=ce[u];if(l)return ie=l.nextPos,l.result;if(t=ie,35===e.charCodeAt(ie)?(r="#",ie++):(r=o,0===he&&ge(V)),r!==o){for(n=[],i=ie,a=ie,he++,s=Ne(),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?i=a=[a,s]:(ie=i,i=o)):(ie=i,i=o);i!==o;)n.push(i),i=ie,a=ie,he++,s=Ne(),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?i=a=[a,s]:(ie=i,i=o)):(ie=i,i=o);n!==o&&(i=Ue())!==o?t=r=[r,n,i]:(ie=t,t=o)}else ie=t,t=o;if(t===o){if(t=ie,"//"===e.substr(ie,2)?(r="//",ie+=2):(r=o,0===he&&ge(J)),r!==o){for(n=[],i=ie,a=ie,he++,s=Ne(),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?i=a=[a,s]:(ie=i,i=o)):(ie=i,i=o);i!==o;)n.push(i),i=ie,a=ie,he++,s=Ne(),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?i=a=[a,s]:(ie=i,i=o)):(ie=i,i=o);n!==o&&(i=Ue())!==o?t=r=[r,n,i]:(ie=t,t=o)}else ie=t,t=o;if(t===o)if(t=ie,"/*"===e.substr(ie,2)?(r="/*",ie+=2):(r=o,0===he&&ge(K)),r!==o){for(n=[],i=ie,a=ie,he++,"*/"===e.substr(ie,2)?(s="*/",ie+=2):(s=o,0===he&&ge(W)),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?i=a=[a,s]:(ie=i,i=o)):(ie=i,i=o);i!==o;)n.push(i),i=ie,a=ie,he++,"*/"===e.substr(ie,2)?(s="*/",ie+=2):(s=o,0===he&&ge(W)),he--,s===o?a=void 0:(ie=a,a=o),a!==o?(e.length>ie?(s=e.charAt(ie),ie++):(s=o,0===he&&ge(Z)),s!==o?i=a=[a,s]:(ie=i,i=o)):(ie=i,i=o);n!==o?("*/"===e.substr(ie,2)?(i="*/",ie+=2):(i=o,0===he&&ge(W)),i!==o&&(a=Ue())!==o?t=r=[r,n,i,a]:(ie=t,t=o)):(ie=t,t=o)}else ie=t,t=o}return ce[u]={nextPos:ie,result:t},t}function Ne(){var t,r=31*ie+27,n=ce[r];return n?(ie=n.nextPos,n.result):("\r\n"===e.substr(ie,2)?(t="\r\n",ie+=2):(t=o,0===he&&ge(Y)),t===o&&(13===e.charCodeAt(ie)?(t="\r",ie++):(t=o,0===he&&ge(ee)),t===o&&(10===e.charCodeAt(ie)?(t="\n",ie++):(t=o,0===he&&ge(te)))),ce[r]={nextPos:ie,result:t},t)}function Ue(){var t,r,n=31*ie+28,i=ce[n];if(i)return ie=i.nextPos,i.result;for(t=[],re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=o,0===he&&ge(ne)),r===o&&(r=ke());r!==o;)t.push(r),re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=o,0===he&&ge(ne)),r===o&&(r=ke());return ce[n]={nextPos:ie,result:t},t}function Le(){var t,r,n=31*ie+29,i=ce[n];if(i)return ie=i.nextPos,i.result;if(t=[],re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=o,0===he&&ge(ne)),r===o&&(r=ke()),r!==o)for(;r!==o;)t.push(r),re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=o,0===he&&ge(ne)),r===o&&(r=ke());else t=o;return ce[n]={nextPos:ie,result:t},t}function ze(){var t,r=31*ie+30,n=ce[r];return n?(ie=n.nextPos,n.result):(59===e.charCodeAt(ie)?(t=";",ie++):(t=o,0===he&&ge(oe)),ce[r]={nextPos:ie,result:t},t)}if((r=a())!==o&&ie===e.length)return r;throw r!==o&&ie<e.length&&ge({type:"end"}),ve(le,ue<e.length?e.charAt(ue):null,ue<e.length?ye(ue,ue+1):ye(ue,ue))}}},function(e,t,r){"use strict";var n=r(14),o=r(2),i=r(3),a=r(4),s=r(6),u=r(7),l=r(8),h=r(9),c=r(5),p=r(17),f=r(1);f.init({Type:o,Typevar:i,Fun:a,Funcall:s,Tee:u,Ruleset:l,Schema:h,Schemacall:c});class d{constructor(){this.scope=new n(null)}feed(e,t){e.forEach(e=>{switch(e._type){case"typedef":var r=p.type(e,this.scope);if(this.scope.hasType(r.name))throw r.scope.error(`Type ${r.name} has already been declared`);this.scope.addType(r);break;case"defv":var n=p.typevar(e,this.scope);if(this.scope.hasTypevar(n.name))throw n.scope.error(`Definition ${n.name} has already been declared`);this.scope.addTypevar(n);break;case"defun":var o=p.fun(e,this.scope);if(this.scope.hasTypevar(o.name))throw o.scope.error(`Definition ${o.name} has already been declared`);this.scope.addFun(o);break;case"defruleset":var i=p.ruleset(e,this.scope,t);if(this.scope.hasRuleset(i.name))throw i.scope.error(`Ruleset ${i.name} has already been declared`);this.scope.addRuleset(i);break;case"defschema":var a=p.schema(e,this.scope,t);if(this.scope.hasSchema(a.name))throw a.scope.error(`Schema ${a.name} has already been declared`);this.scope.addSchema(a);break;default:throw Error("Unknown line type "+e._type)}})}}d.prototype.ExpressionResolver=f,e.exports=d},function(e,t,r){"use strict";var n=r(2),o=r(3),i=r(4),a=r(6),s=r(7),u=r(8),l=r(9),h=r(5),c=r(15);function p(e,t){if(this.typedefMap={},this.defMap={},this.schemaMap={},this.rulesetMap={},this.Type=n,this.Typevar=o,this.Fun=i,this.Funcall=a,this.Tee=s,this.Ruleset=u,this.Schema=l,this.Schemacall=h,this.parent=e,this.root=e?e.root:this,t&&!(t instanceof c))throw Error("Assertion failed");this.trace=t||new c,this.baseType=e?e.baseType:null}p.prototype.extend=function(e,t,r){return new p(this,this.trace.extend(e,t,r))},p.prototype.error=function(e){return this.trace.error(e)},p.prototype.hasOwnType=function(e){if("string"==typeof e)return!!this.typedefMap[e];if(!(e instanceof Array))throw this.error("Argument is malformed");if(e.length<2)throw this.error("Illegal array length");return e.map(e=>this.hasOwnType(e)).every(e=>e)},p.prototype.hasType=function(e){if("string"==typeof e)return this.hasOwnType(e)||!!this.parent&&this.parent.hasType(e);if(!(e instanceof Array))throw this.error("Argument is malformed");if(e.length<2)throw this.error("Illegal array length");return e.map(e=>this.hasType(e)).every(e=>e)},p.prototype.addType=function(e){if(!(e instanceof n))throw this.error("Illegal argument type");if(!e.name)throw this.error("Something's wrong");if(this.hasOwnType(e.name))throw this.error(`Type ${e.name} has already been declared`);if(e.isBaseType){if(this.baseType)throw this.error("A base type already exists");!function t(r){r.baseType=e,r.parent&&t(r.parent)}(this)}return this.typedefMap[e.name]=e},p.prototype.getType=function(e){if("string"==typeof e){if(!this.hasType(e))throw this.error(`Type ${e} is not defined`);return this.typedefMap[e]||!!this.parent&&this.parent.getType(e)}if(!(e instanceof Array))throw this.error("Argument is malformed");if(e.length<2)throw this.error("Illegal array length");var t=e.slice(0,e.length-1).map(e=>this.getType(e)),r=this.getType(e[e.length-1]);return new n({functional:!0,from:t,to:r})},p.prototype.hasOwnTypevar=function(e){return!!this.defMap[e]},p.prototype.hasTypevar=function(e){return this.hasOwnTypevar(e)||!!this.parent&&this.parent.hasTypevar(e)},p.prototype.addTypevar=function(e){if(!(e instanceof o))throw this.error("Illegal argument type");if(this.hasOwnTypevar(e.name))throw this.error(`Definition ${e.name} has already been declared`);return this.defMap[e.name]=e},p.prototype.addFun=function(e){if(!(e instanceof i))throw this.error("Illegal argument type");if(!e.name)throw this.error("Cannot add anonymous fun to scope");if(this.hasOwnTypevar(e.name))throw this.error(`Definition ${e.name} has already been declared`);return this.defMap[e.name]=e},p.prototype.getTypevar=function(e){if(!this.hasTypevar(e))throw this.error(`Definition ${e} is not defined`);return this.defMap[e]||!!this.parent&&this.parent.getTypevar(e)},p.prototype.hasOwnRuleset=function(e){return!!this.rulesetMap[e]},p.prototype.hasRuleset=function(e){return this.hasOwnRuleset(e)||!!this.parent&&this.parent.hasRuleset(e)},p.prototype.addRuleset=function(e){if(!(e instanceof u))throw this.error("Illegal argument type");if(this.hasOwnRuleset(e.name))throw this.error(`Ruleset ${e.name} has already been declared`);return this.rulesetMap[e.name]=e},p.prototype.getRuleset=function(e){if(!this.hasRuleset(e))throw this.error(`Ruleset ${e} is not defined`);return this.rulesetMap[e]||!!this.parent&&this.parent.getRuleset(e)},p.prototype.hasOwnSchema=function(e){return!!this.schemaMap[e]||!!this.defMap[e]},p.prototype.hasSchema=function(e){return this.hasOwnSchema(e)||!!this.parent&&this.parent.hasSchema(e)},p.prototype.addSchema=function(e){if(!(e instanceof l))throw this.error("Illegal argument type");if(this.hasOwnSchema(e.name))throw this.error(`Schema ${e.name} has already been declared`);return this.schemaMap[e.name]=e},p.prototype.getSchema=function(e){if(!this.hasSchema(e))throw this.error(`Schema ${e} is not defined`);return this.schemaMap[e]||this.defMap[e]||!!this.parent&&this.parent.getSchema(e)},e.exports=p},function(e,t,r){"use strict";(function(t){function r(e){this.stack=e||[]}r.prototype.extend=function(e,t,n){return new r([[e,t,n]].concat(this.stack))},r.prototype.error=function(e){var r=void 0!==t&&t.argv[2];return new Error(e+"\n\tat "+(this.stack.length?this.stack.map(([e,t,n])=>`${e} ${t||"<anonymous>"} (${r||"<unknown>"}:${n.start.line}:${n.start.column})`).join("\n\tat "):`<root> (${r||"<unknown>"}:1:1)`))},e.exports=r}).call(this,r(16))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,l=[],h=!1,c=-1;function p(){h&&u&&(h=!1,u.length?l=u.concat(l):c=-1,l.length&&f())}function f(){if(!h){var e=s(p);h=!0;for(var t=l.length;t;){for(u=l,l=[];++c<t;)u&&u[c].run();c=-1,t=l.length}u=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new d(e,t)),1!==l.length||h||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){var n=r(2),o=r(3),i=r(4),a=r(6),s=r(7),u=r(8),l=r(9),h=r(5),c=r(18),p=r(1),f={};function d(e){if("type"!=e._type)throw Error("Assertion failed");return e.ftype?"["+e.from.map(d).join(", ")+" -> "+d(e.to)+"]":e.name}function m(e){if("type"!=e._type)throw Error("Assertion failed");if(e.ftype){if(!e.from||!e.to)throw Error("Assertion failed");return e.from.map(m).concat([m(e.to)])}if(!e.name)throw Error("Assertion failed");return e.name}f.type=function(e,t){if("typedef"!=e._type)throw Error("Assertion failed");var r=t.extend("type",e.name,e.location),o=e.origin?r.getType(m(e.origin)):null,i=e.name,a=e.doc,s=e.base;if(s&&o)throw r.error("Base type should not be an alias");return new n(o?{name:i,doc:a,base:s,origin:o}:{functional:!1,name:i,doc:a,base:s})},f.typevar=function(e,t){if(!["defv","var"].includes(e._type))throw Error("Assertion failed");var r=t.extend("typevar",e.name,e.location);if("var"==e._type){if(!r.hasTypevar(e.name))throw r.error("Undefined identifier "+e.name);return r.getTypevar(e.name)}if(!r.hasType(m(e.type)))throw r.error(`Type ${d(e.type)} is not defined`);var n=r.getType(m(e.type));return new o({type:n,isParam:!!e.isParam,guess:e.guess||null,name:e.name,doc:e.doc,tex:e.tex},r)},f.fun=function(e,t){if("defun"!=e._type&&"funexpr"!=e._type)throw Error("Assertion failed");var r=t.extend("fun",e.name||null,e.location),o=e.name||null,a=null,s=e.params.map(e=>{if(!r.hasType(m(e.type)))throw r.error(`Type ${d(e.type)} is not defined`);var t=f.typevar(e,r);if(r.hasOwnTypevar(t.name))throw t.scope.error(`Parameter ${t.name} has already been declared`);return r.addTypevar(t)}),u=null,l=e.doc||null,h=e.tex||null;switch(e._type){case"defun":if(!r.hasType(m(e.rettype)))throw r.error(`Type ${d(e.rettype)} is not defined`);var c=r.getType(m(e.rettype));if(e.expr){if(u=f.expr0(e.expr,r),!c.equals(u.type))throw r.error(`Expression type ${u.type} failed to match the return type ${c} of fun ${o}`)}else a=new n({functional:!0,from:s.map(e=>e.type),to:c});break;case"funexpr":u=f.expr0(e.expr,r),a=null;break;default:throw Error("wut")}return new i({name:o,type:a,params:s,expr:u,doc:l,tex:h},r)},f.funcall=function(e,t){if("funcall"!=e._type)throw Error("Assertion failed");var r=t.extend("funcall",e.fun.name||null,e.location),n=f.expr0(e.fun,r),o=e.args.map(e=>f.expr0(e,r));return new a({fun:n,args:o},r)},f.metaexpr=function(e,t){if(!["tee","reduction","schemacall","schemaexpr","var"].includes(e._type))throw Error("Assertion failed");var r=t;switch(e._type){case"tee":return f.tee(e,r);case"reduction":return f.reduction(e,r);case"schemacall":return f.schemacall(e,r);case"schemaexpr":return f.schema(e,r);case"var":return f.metavar(e,r);default:throw Error("wut")}},f.expr0=function(e,t){if(!["funcall","funexpr","var"].includes(e._type))throw console.log(e),Error("Assertion failed");var r=t;switch(e._type){case"funcall":return f.funcall(e,r);case"funexpr":return f.fun(e,r);case"var":return f.typevar(e,r);default:throw Error("wut")}},f.metavar=function(e,t){if("var"!=e._type)throw Error("Assertion failed");var r=t;switch(e.type){case"ruleset":if(!r.hasRuleset(e.rulesetName))throw r.error(`Ruleset ${e.rulesetName} is not defined`);var n=r.getRuleset(e.rulesetName);if(!n.native)throw r.error("Behavior undefined for non-native rulesets");var o=n.native.get(e.name,r);if(!o)throw r.error(`Schema ${function(e){switch(e.type){case"ruleset":return`${e.rulesetName}.${e.name}`;case"normal":return""+e.name;default:throw Error("Unknown type "+e.type)}}(e)} is not defined`);return o;case"normal":if(!r.hasSchema(e.name))throw r.error(`Schema ${e.name} is not defined`);return r.getSchema(e.name);default:throw r.error("Unknown type "+e.type)}},f.tee=function(e,t){if("tee"!=e._type)throw Error("Assertion failed");var r=t.extend("tee",null,e.location),n=e=>f.metaexpr(e,r),o=e.left.map(n),i=n(e.right);return new s({left:o,right:i},r)},f.schema=function(e,t,r){if("defschema"!=e._type&&"schemaexpr"!=e._type)throw Error("Assertion failed");var n=t.extend("schema",e.name,e.location),o=e.axiomatic,i=e.name;if(e.native){if(!r.schema[i])throw n.error(`Native code for native schema ${i} not found`);return new l({axiomatic:o,name:i,native:{get:e=>r.schema[i].get(e,n,p)},doc:e.doc},n)}var a=e.params.map(e=>{if(!n.hasType(m(e.type)))throw n.error(`Type ${d(e.type)} is not defined`);var t=f.typevar(e,n);if(n.hasOwnTypevar(t.name))throw t.scope.error(`Parameter ${t.name} has already been declared`);return n.addTypevar(t)}),s=f.metaexpr(e.expr,n);return new l({axiomatic:o,name:i,params:a,expr:s,doc:e.doc},n)},f.schemacall=function(e,t){if("schemacall"!=e._type)throw Error("Assertion failed");var r=t.extend("schemacall",e.schema.name||null,e.location),n=f.metaexpr(e.schema,r);if("type"==n.type._type)return f.funcall({_type:"funcall",fun:e.schema,args:e.args,location:e.location},t);var o=e.args.map(e=>f.expr0(e,r));return new h({schema:n,args:o},r)},f.ruleset=function(e,t,r){if("defruleset"!=e._type)throw Error("Assertion failed");var n=t.extend("ruleset",e.name,e.location),o=e.axiomatic,i=e.name;if(!e.native)throw n.error("Assertion failed");if(!r.ruleset[i])throw n.error(`Native code for native ruleset ${i} not found`);var a=r.ruleset[i];return new u({axiomatic:o,name:i,native:a,doc:e.doc},n)},f.reduction=function(e,t){if("reduction"!=e._type)throw Error("Assertion failed");var r=t.extend("reduction",e.subject.name||null,e.location),n=f.metaexpr(e.subject,r),o=e.guesses?e.guesses.map(e=>e&&f.expr0(e,r)):null,i=e.leftargs.map(e=>f.metaexpr(e,r));return new c({subject:n,guesses:o,leftargs:i},r)},e.exports=f},function(e,t,r){var n=r(0),o=r(5),i=r(1);function a({subject:e,guesses:t,leftargs:r},a){if(n.call(this,a),e.native||"schema"!=e._type){if(t)throw this.error("Something's wrong")}else{e.params.forEach((e,r)=>{if(!(t&&t[r]||e.guess))throw this.error(`Argument #${r+1} could not be guessed`)});var s=e.params.map((n,o)=>t&&t[o]?t[o]:this.query(n.guess,i.expandMeta(e.expr).left,r));e=new o({schema:e,args:s},a)}if(!(e.native||"metatype"==e.type._type&&e.type.isSimple))throw this.error("Subject is not reducible");if(!(r instanceof Array)||r.map(e=>e instanceof n).some(e=>!e))throw this.error("Assertion failed");if(this.subject=e,this.leftargs=r,e.native)this.reduced=e.native.get(r),this.type=this.reduced.type;else{var u=e.type.left,l=r.map(e=>e.type);if(u.length!=l.length)throw this.error(`Invalid number of arguments (expected ${u.length}): ${l.length}`);for(let e=0;e<u.length;e++)if(!u[e].equals(l[e]))throw this.error(`Illegal argument type (expected ${u[e]}): ${l[e]}`);this.type=e.type.right;var h=i.expandMetaAndFuncalls(e);if("tee"!=h._type)throw this.error("Assertion failed");for(let e=0;e<h.left.length;e++)if(!i.equals(h.left[e],r[e]))throw this.error(`LHS #${e+1} failed to match:\n\n--- EXPECTED ---\n${i.expandMetaAndFuncalls(h.left[e])}\n----------------\n\n--- RECEIVED ---\n${i.expandMetaAndFuncalls(r[e])}\n----------------`);this.reduced=h.right}}a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._type="reduction",a.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.subject.isProved(e)&&this.leftargs.every(t=>t.isProved(e))},a.prototype.query=function(e,t,r){if(0==e.length)throw this.error("wut");if(!(1<=1*e[0]&&1*e[0]<=r.length))throw this.error(`Cannot dereference @${e}: antecedent index out of range`);var n=t[1*e[0]-1],o=r[1*e[0]-1],a=this;return function e(t,r,n,o){if(n=i.expandMetaAndFuncalls(n),t.length<=o)return n;if(/[0-9]/.test(t[o])){var s=1*t[o];if("tee"==r._type&&"tee"==n._type){if(r.left.length!=n.left.length)throw a.error(`Cannot dereference @${t}: antecedent length mismatch`);if(!(1<=s&&s<=n.left.length))throw a.error(`Cannot dereference @${t}: antecedent index out of range`);return e(t,r.left[s-1],n.left[s-1],o+1)}for(;;){if(!r.fun||!n.fun)throw a.error("Cannot dereference @"+t);if(i.equals(r.fun,n.fun))break;if(!n.fun.expr)throw a.error("Cannot dereference @"+t);n=i.expandCallOnce(n)}if(!n.args||!(1<=s&&s<=n.args.length))throw a.error("Cannot dereference @"+t);return e(t,r.args[s-1],n.args[s-1],o+1)}if("r"==t[o]){if("tee"==r._type&&"tee"==n._type)return e(t,r.right,n.right,o+1);throw a.error("Cannot dereference @"+t)}throw a.error("Cannot dereference @"+t)}(e,n,o,1)},a.prototype.toString=function(){return this.toIndentedString(0)},a.prototype.toIndentedString=function(e){var t=this.leftargs.map(t=>t.toIndentedString(e+1));return t.join("").length<=50?(t=(t=this.leftargs.map(t=>t.toIndentedString(e))).join(", "),[this.subject.toIndentedString(e)+"[",t,"]"].join("")):(t=t.join(",\n"+"\t".repeat(e+1)),[this.subject.toIndentedString(e)+"[","\t"+t,"]"].join("\n"+"\t".repeat(e)))},a.prototype.toTeXString=function(e,t){return`${this.subject.toTeXString(!1)}[${this.leftargs.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}]`},e.exports=a}]);