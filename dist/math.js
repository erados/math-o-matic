var math=function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(r,n,function(t){return e[t]}.bind(null,n));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=11)}([function(e,t,r){var n=r(1),a=0;function Node(e){this._id=++a,this.scope=e||null}Node.prototype.error=function(e){return this.scope?this.scope.error(e):new Error(e)},Node.prototype.escapeTeX=function(e){return e.replace(/&|%|\$|#|_|{|}|~|\^|\\/g,e=>({"&":"\\&","%":"\\%",$:"\\$","#":"\\#",_:"\\_","{":"\\{","}":"\\}","~":"\\textasciitilde","^":"\\textasciicircum","\\":"\\textbackslash"}[e]))},Node.prototype.parseTeX=function(e){var t=!1,r=e.replace(/^!<prec=([0-9]+)>/,(e,r)=>(t=1*r,""));return{precedence:t,code:r}},Node.prototype.isProved=function(e){return!!(e=e||[]).some(e=>n.equals(e,this))},Node.prototype.PREC_FUNEXPR=1e3,Node.prototype.PREC_COMMA=1e3,Node.prototype.PREC_COLONEQQ=1e5,Node.prototype.normalizePrecedence=function(e){if(!1===e)return[0,0];if(!0===e)return[2,0];if("number"==typeof e)return[0,e];if(!(e instanceof Array&&2==e.length))throw console.log(e),Error("wut");return e},Node.prototype.shouldConsolidate=function(e){var t=this.normalizePrecedence(this.precedence||!1),r=this.normalizePrecedence(e||!1);return(0!=t[0]||0!=t[1])&&!(t[0]<r[0]||t[0]==r[0]&&t[1]<r[1])},Node.prototype.makeTeX=function(e,t,r){t=t||[],r=r||!1;var n=this.tex;return this.shouldConsolidate(r)&&(n="\\left("+n+"\\right)"),n.replace(/#([0-9]+)/g,(e,r)=>t[1*r-1]||`\\texttt{\\textcolor{red}{\\#${r}}}`).replace(/<<(.+?)>>/,(t,r)=>`\\href{#${e}}{${r}}`)},e.exports=Node},function(e,t){var r,n,a,i,o,s,p={};function iscall(e){return["schemacall","funcall"].includes(e._type)}function callee(e){return"schemacall"==e._type?e.schema:"funcall"==e._type?e.fun:(()=>{throw console.log(e),Error()})()}function makecall(e,t){return"fun"==e._type||"typevar"==e._type?new a({fun:e,args:t}):"schema"==e._type?new s({schema:e,args:t}):(()=>{throw console.log(e),Error()})()}p.init=function(e){e.Type,r=e.Typevar,n=e.Fun,a=e.Funcall,i=e.Tee,e.Ruleset,o=e.Schema,s=e.Schemacall},p.substitute=function(e,t){switch(e._type){case"funcall":return new a({fun:p.substitute(e.fun,t),args:e.args.map(e=>p.substitute(e,t))});case"fun":if(!e.expr)return t.get(e)||e;if(e.name)return t.get(e)||e;if(e.params.some(e=>t.has(e)))throw Error("Parameter collision");return new n({name:null,params:e.params,expr:p.substitute(e.expr,t)});case"typevar":return t.get(e)||e;case"tee":var r=e.left.map(e=>p.substitute(e,t)),l=p.substitute(e.right,t);return new i({left:r,right:l});case"schemacall":return new s({schema:p.substitute(e.schema,t),args:e.args.map(e=>p.substitute(e,t))});case"schema":if(e.name)return e;if(e.params.some(e=>t.has(e)))throw Error("Parameter collision");return new o({axiomatic:e.axiomatic,name:null,params:e.params,expr:p.substitute(e.expr,t)});case"reduction":return p.substitute(e.reduced,t);default:throw Error("Unknown type "+e._type)}},p.call=function(e,t){if(!function iscallable(e){return["schema","fun"].includes(e._type)}(e))throw console.log(e),Error("Illegal type");if(!e.expr)throw Error("Cannot call a callable without a body");if(e.params.length!=t.length)throw Error("Illegal arguments length");for(var r=new Map,n=0;n<e.params.length;n++)r.set(e.params[n],t[n]);return p.substitute(e.expr,r)},p.expandCallOnce=function(e){if(!iscall(e))throw Error("Illegal type");if(iscall(callee(e)))return makecall(p.expandCallOnce(callee(e)),e.args);if(!callee(e).expr)throw Error("Could not expand");return p.call(callee(e),e.args)},p.expand0Funcalls=function(e){if("funcall"==e._type){var t=p.expand0Funcalls(e.fun),r=e.args.map(p.expand0Funcalls);return"fun"!=t._type||t.name?new a({fun:t,args:r}):p.expand0Funcalls(p.call(t,r))}return"fun"!=e._type||e.name?e:new n({name:null,params:e.params,expr:p.expand0Funcalls(e.expr)})},p.expandMeta=function(e){if(e.native)return e;switch(e._type){case"tee":var t=e.left.map(p.expandMeta),r=p.expandMeta(e.right);return new i({left:t,right:r});case"schemacall":var n=p.expandMeta(e.schema),a=e.args;return p.expandMeta(p.call(n,a));case"reduction":return p.expandMeta(e.reduced);case"schema":return new o({axiomatic:e.axiomatic,name:null,params:e.params,expr:p.expandMeta(e.expr)});case"funcall":case"fun":case"typevar":return e;default:throw console.log(e),Error("Unknown metaexpr")}},p.expandMetaAndFuncalls=function(e){switch(e._type){case"tee":var t=e.left.map(p.expandMetaAndFuncalls),r=p.expandMetaAndFuncalls(e.right);return new i({left:t,right:r});case"schemacall":var n=p.expandMetaAndFuncalls(e.schema),a=e.args.map(p.expand0Funcalls);return p.expandMetaAndFuncalls(p.call(n,a));case"reduction":return p.expandMetaAndFuncalls(e.reduced);case"schema":return new o({axiomatic:e.axiomatic,name:null,params:e.params,expr:p.expandMetaAndFuncalls(e.expr)});case"funcall":case"fun":case"typevar":return p.expand0Funcalls(e);default:throw console.log(e),Error("Unknown metaexpr")}},p.nequalscall=p.nequalstrue=p.nrecursecall=p.nrecursetrue=0,p.equals=function(e,t){var n=function recurse(e,t,a){if(e==t)return!0;if(!e.type.equals(t.type))return!1;if("reduction"==e._type)return n(e.reduced,t,a+1);if("reduction"==t._type)return n(e,t.reduced,a+1);if(iscall(e)&&iscall(t)){if(iscall(callee(e)))return n(p.expandCallOnce(e),t,a+1);if(iscall(callee(t)))return n(e,p.expandCallOnce(t),a+1);if(callee(e)==callee(t)||!callee(e).expr&&!callee(t).expr){if(callee(e)!=callee(t))return!1;if(!callee(e).expr&&!callee(t).expr){for(var i=0;i<e.args.length;i++)if(!n(e.args[i],t.args[i],a+1))return!1;return!0}if(e.args.every((r,i)=>n(e.args[i],t.args[i],a+1)))return!0}return callee(e).expr?n(p.expandCallOnce(e),t,a+1):n(e,p.expandCallOnce(t),a+1)}if(iscall(e))return(iscall(callee(e))||!!callee(e).expr)&&n(p.expandCallOnce(e),t,a+1);if(iscall(t))return(iscall(callee(t))||!!callee(t).expr)&&n(e,p.expandCallOnce(t),a+1);if("tee"==e._type){for(i=0;i<e.left.length;i++)if(!n(e.left[i],t.left[i],a+1))return!1;return n(e.right,t.right,a+1)}if(e.type.isFunctional){var o=Array(e.type.resolve().from.length).fill().map((t,n)=>new r({type:e.type.resolve().from[n],name:"$"+n}));return n(makecall(e,o),makecall(t,o),a+1)}return!1};p.nequalscall++;var a=n(e,t,0);return a&&p.nequalstrue++,a},p.chain=function(e){if(!e.every(e=>"tee"==e._type))throw Error("no");return p.expandMetaAndFuncalls(e.reduceRight((e,t)=>{for(var r=0;r<e.left.length;r++)if(p.equals(t.right,e.left[r])){var n=e.left.slice(0,r).concat(t.left).concat(e.left.slice(r+1));return new i({left:n,right:e.right})}throw Error(`Chaining failed:\n\n--- LEFT ---\n${t}\n------------\n\n--- RIGHT ---\n${e}\n-------------`)}))},e.exports=p},function(e,t,r){var n=r(0);function Type(e){if(n.call(this),this.doc=e.doc,this.isBaseType=!!e.base,e.origin){if("string"!=typeof e.name)throw this.error("typeof o.name != 'string'");if(this.name=e.name,!(e.origin instanceof Type))throw this.error("!(o.origin instanceof Type)");this.isFunctional=e.origin.isFunctional,this.isSimple=e.origin.isSimple,this.origin=e.origin}else{if("boolean"!=typeof e.functional)throw this.error("typeof o.functional != 'boolean'");if(this.isFunctional=e.functional,this.isSimple=!e.functional,e.functional){if(e.from.map(e=>e instanceof Type).some(e=>!e))throw this.error("o.from.map(f => f instanceof Type).some(e => !e)");if(!(e.to instanceof Type))throw this.error("!(o.to instanceof Type)");this.from=e.from,this.to=e.to}else{if("string"!=typeof e.name)throw this.error("typeof o.name != 'string'");this.name=e.name}}}Type.prototype=Object.create(n.prototype),Type.prototype.constructor=Type,Type.prototype._type="type",Type.prototype.toString=function(){return this.toIndentedString(0)},Type.prototype.toSimpleString=function(){if(this.name)return this.name;var e=this.resolve();return`[${e.from.map(e=>e.toSimpleString()).join(", ")} -> ${e.to.toSimpleString()}]`},Type.prototype.toIndentedString=function(e){return this.isSimple?this.name:`${this.name?this.name+": ":""}[${this.resolve().from.join(", ")} -> ${this.resolve().to}]`},Type.prototype.toTeXString=function(e){return this.isSimple||!e&&this.name?`\\href{#type-${this.name}}\\mathsf{${this.name}}`:(this.name?`\\href{#type-${this.name}}\\mathsf{${this.name}}: `:"")+"\\left["+this.resolve().from.map(e=>e.toTeXString()).join(" \\times ")+` \\to ${this.resolve().to.toTeXString()} \\right]`},Type.prototype.resolve=function(){return this.origin?this.origin.resolve():this},Type.prototype.equals=function(e){if(!(e instanceof Type))return!1;if(this.origin)return this.origin.equals(e);if(e.origin)return this.equals(e.origin);if(this.isSimple!=e.isSimple)return!1;if(this.isSimple)return this===e;if(this.from.length!=e.from.length)return!1;for(var t=0;t<this.from.length;t++)if(!this.from[t].equals(e.from[t]))return!1;return this.to.equals(e.to)},e.exports=Type},function(e,t,r){var n=r(0);function Typevar({type:e,isParam:t,guess:r,name:a,doc:i,tex:o},s){if(n.call(this,s),this.doc=i,this.tex=o,this.isParam=!!t,this.guess=r||null,"type"!=e._type)throw this.error("Assertion failed");if("string"!=typeof a)throw this.error("Assertion failed");this.type=e,this.name=a}Typevar.prototype=Object.create(n.prototype),Typevar.prototype.constructor=Typevar,Typevar.prototype._type="typevar",Typevar.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)},Typevar.prototype.toString=function(){return this.toIndentedString(0)},Typevar.prototype.toSimpleString=function(){return this.type.toSimpleString()+" "+this.name},Typevar.prototype.toIndentedString=function(e,t){return`${t?this.type+" ":""}${this.name}<${this._id}>`},Typevar.prototype.toTeXString=function(e,t){return`\\href{#${this.isParam?"id-"+this._id:"def-"+this.name}}{${this.tex||(1==this.name.length?this.escapeTeX(this.name):`\\mathrm{${this.escapeTeX(this.name)}}`)}}`},e.exports=Typevar},function(e,t,r){var n=r(0),a=r(2),i=r(1);function Fun({name:e,type:t,params:r,expr:i,doc:o,tex:s},p){if(n.call(this,p),this.doc=o,s){var{precedence:l,code:c}=this.parseTeX(s);this.precedence=l,this.tex=c}else this.precedence=!1,this.tex=!1;if(!e&&!i)throw this.error("Anonymous fun cannot be primitive");if(t&&i)throw this.error("no");if(!t&&!i)throw this.error("Cannot guess the type of a primitive fun");if(null!==e&&"string"!=typeof e)throw this.error("Assertion failed");if(t&&"type"!=t._type)throw this.error("Assertion failed");if(!(r instanceof Array)||r.map(e=>e instanceof n).some(e=>!e))throw this.error("Assertion failed");if(null!==i&&!(i instanceof n))throw this.error("Assertion failed");this.name=e,this.type=t||new a({functional:!0,from:r.map(e=>e.type),to:i.type}),this.params=r,this.expr=i}Fun.prototype=Object.create(n.prototype),Fun.prototype.constructor=Fun,Fun.prototype._type="fun",Fun.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)},Fun.prototype.toString=function(){return this.toIndentedString(0)},Fun.prototype.toIndentedString=function(e){return this.expr?[(this.name?"ƒ "+this.type.to+" "+this.name:"ƒ ")+`(${this.params.join(", ")}) => {`,"\t"+this.expr.toIndentedString(e+1),"}"].join("\n"+"\t".repeat(e)):`ƒ ${this.type.to} ${this.name}(${this.params.join(", ")});`},Fun.prototype.toTeXString=function(e,t){return this.name?t?this.expr?this.funcallToTeXString(this.params,this.PREC_COLONEQQ)+"\\coloneqq "+this.expr.toTeXString(this.PREC_COLONEQQ):this.funcallToTeXString(this.params,e):`\\href{#def-${this.name}}\\mathrm{${this.escapeTeX(this.name)}}`:(this.precedence=this.PREC_FUNEXPR,[this.shouldConsolidate(e)?"\\left(":"",1==this.params.length?this.params[0].toTeXString(!1):`\\left(${this.params.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}\\right)`,"\\mapsto "+i.expandMetaAndFuncalls(this.expr).toTeXString(!1),this.shouldConsolidate(e)?"\\right)":""].join(""))},Fun.prototype.funcallToTeXString=function(e,t){return e=e.map(e=>e.toTeXString(this.tex?this.precedence:this.PREC_COMMA)),this.tex?this.makeTeX("def-"+this.name,e,t):(this.name?`\\href{#def-${this.name}}{${1==this.name.length?this.escapeTeX(this.name):`\\mathrm{${this.escapeTeX(this.name)}}`}}`:this.toTeXString(!1))+`(${e.join(", ")})`},e.exports=Fun},function(e,t,r){var n=r(0),a=r(3),i=r(1);function Schemacall({schema:e,args:t},r){if(n.call(this,r),!e)throw this.error("Assertion failed");if(!(t instanceof Array))throw this.error("Assertion failed");this.schema=e,this.args=t;var a=e.type.from,o=t.map(e=>e.type);if(a.length!=o.length)throw this.error(`Invalid number of arguments (expected ${a.length}): ${o.length}`);for(var s=0;s<a.length;s++)if(!a[s].equals(o[s]))throw this.error(`Argument #${s+1} has illegal argument type (expected ${a[s]}): ${o[s]}`);this.type=e.type.to,this.expanded=i.expandMetaAndFuncalls(this)}Schemacall.prototype=Object.create(n.prototype),Schemacall.prototype.constructor=Schemacall,Schemacall.prototype._type="schemacall",Schemacall.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.schema.isProved(e)},Schemacall.prototype.toString=function(){return this.toIndentedString(0)},Schemacall.prototype.toIndentedString=function(e){var t=this.args.map(t=>t instanceof a?`${t.name}<${t._id}>`:t.toIndentedString(e+1));return t.join("").length<=50?(t=(t=this.args.map(t=>t instanceof a?`${t.name}<${t._id}>`:t.toIndentedString(e))).join(", "),[(this.schema.name||`(${this.schema})`)+"(",t,")"].join("")):(t=t.join(",\n"+"\t".repeat(e+1)),[(this.schema.name||`(${this.schema.toIndentedString(e)})`)+"(","\t"+t,")"].join("\n"+"\t".repeat(e)))},Schemacall.prototype.toTeXString=function(e,t){return(this.schema.name?`\\href{#schema-${this.schema.name}-${this.schema.proved?"p":"np"}}{\\textsf{${this.escapeTeX(this.schema.name)}}}`:this.schema.toTeXString(!1))+`(${this.args.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")})`},e.exports=Schemacall},function(e,t,r){var n=r(0),a=r(3),i=r(4);function Funcall({fun:e,args:t},r){if(n.call(this,r),!(e instanceof n))throw this.error("Assertion failed");if(!["typevar","fun","funcall"].includes(e._type))throw console.log(e),this.error("Assertion failed");if(e.type.isSimple)throw this.error(e.name+" is not callable");if(!(t instanceof Array)||t.map(e=>e instanceof n).some(e=>!e))throw this.error("Assertion failed");var a=e.type.resolve(),i=a.from,o=t.map(e=>e.type);if(i.length!=o.length)throw this.error(`Invalid number of arguments (expected ${i.length}): ${o.length}`);for(var s=0;s<i.length;s++)if(!i[s].equals(o[s]))throw this.error(`Argument #${s+1} has illegal argument type (expected ${i[s]}): ${o[s]}`);this.fun=e,this.type=a.to,this.args=t}Funcall.prototype=Object.create(n.prototype),Funcall.prototype.constructor=Funcall,Funcall.prototype._type="funcall",Funcall.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)},Funcall.prototype.toString=function(){return this.toIndentedString(0)},Funcall.prototype.toIndentedString=function(e){var t=this.args.map(t=>t instanceof a?`${t.name}<${t._id}>`:t.toIndentedString(e+1));return t.join("").length<=50?(t=(t=this.args.map(t=>t instanceof a?`${t.name}<${t._id}>`:t.toIndentedString(e))).join(", "),[("fun"==this.fun._type&&this.fun.name?this.fun.name:"("+this.fun.toIndentedString(e)+")")+"(",t,")"].join("")):(t=t.join(",\n"+"\t".repeat(e+1)),[("fun"==this.fun._type&&this.fun.name?this.fun.name:"("+this.fun.toIndentedString(e)+")")+"(","\t"+t,")"].join("\n"+"\t".repeat(e)))},Funcall.prototype.toTeXString=function(e,t){if(this.fun instanceof i)return this.fun.funcallToTeXString(this.args,e);var r=this.args.map(e=>e.toTeXString(this.PREC_COMMA));return(this.fun.name&&"typevar"!=this.fun._type?1==this.fun.name.length?this.escapeTeX(this.fun.name):`\\mathrm{${this.escapeTeX(this.fun.name)}}`:this.fun.toTeXString(!1))+`(${r.join(", ")})`},e.exports=Funcall},function(e,t,r){var n=r(0),a=r(10),i=r(1);function Tee({left:e,right:t},r){if(n.call(this,r),!(e instanceof Array&&e.every(e=>["type","metatype"].includes(e.type._type))))throw console.log(e),this.error("Assertion failed");if(!["type","metatype"].includes(t.type._type))throw console.log(t),this.error("Assertion failed");if(t.type.isFunctional)throw this.error("RHS of a rule cannot be a schema");this.left=e.reduce((e,t)=>{for(var r=0;r<e.length;r++)if(i.equals(e[r],t))return e;return e.push(t),e},[]),this.right=t,this.type=new a({functional:!1,left:e.map(e=>e.type),right:t.type})}Tee.prototype=Object.create(n.prototype),Tee.prototype.constructor=Tee,Tee.prototype._type="tee",Tee.prototype.precedence=n.prototype.PREC_COMMA,Tee.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.right.isProved(e.concat(this.left))},Tee.prototype.toString=function(){return this.toIndentedString(0)},Tee.prototype.toIndentedString=function(e){return this.left.length?["\t"+this.left.map(t=>t.toIndentedString(e+1)).join(",\n"+"\t".repeat(e+1)),"|-","\t"+this.right.toIndentedString(e+1)].join("\n"+"\t".repeat(e)):"|- "+this.right.toIndentedString(e)},Tee.prototype.toTeXString=function(e,t){var r=i.expandMetaAndFuncalls(this);return[this.shouldConsolidate(e)?"\\left(":"",`{${r.left.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")} \\vdash ${r.right.toTeXString(this.PREC_COMMA)}}`,this.shouldConsolidate(e)?"\\right)":""].join("")},e.exports=Tee},function(e,t,r){var n=r(0);function Ruleset({axiomatic:e,name:t,native:r,doc:a},i){if(n.call(this,i),this.doc=a,"string"!=typeof t)throw this.error("Assertion failed");if(!r)throw this.error("Assertion failed");this.axiomatic=e,this.name=t,this.native=r||!1}Ruleset.prototype=Object.create(n.prototype),Ruleset.prototype.constructor=Ruleset,Ruleset.prototype._type="ruleset",Ruleset.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.axiomatic},Ruleset.prototype.toString=function(){return this.toIndentedString(0)},Ruleset.prototype.toIndentedString=function(e){return"RS "+this.name+(this.native?" <native>":" <error>")},Ruleset.prototype.toTeXString=function(e,t){return`\\href{#ruleset-${this.name}}{\\mathsf{${this.escapeTeX(this.name)}}}`+(this.native?"\\ (\\textrm{native})":"\\ (\\textit{error})")},e.exports=Ruleset},function(e,t,r){var n=r(0),a=r(2),i=r(10),o=r(1);function Schema({axiomatic:e,name:t,native:r,params:o,expr:s,doc:p},l){if(n.call(this,l),this.doc=p,"boolean"!=typeof e)throw this.error("Assertion failed");if(null!==t&&"string"!=typeof t)throw this.error("Assertion failed");if(!r&&!["type","metatype"].includes(s.type._type))throw this.error("Assertion failed");if(this.axiomatic=e,this.name=t,r)this.native=r,this.expr=null,this.type=null;else{if(!(o instanceof Array)||o.map(e=>"typevar"==e._type).some(e=>!e))throw this.error("Assertion failed");this.params=o,this.expr=s,this.type=new("type"==s.type._type?a:i)({functional:!0,from:o.map(e=>e.type),to:s.type})}this.proved=this.isProved()}Schema.prototype=Object.create(n.prototype),Schema.prototype.constructor=Schema,Schema.prototype._type="schema",Schema.prototype.isProved=function(e){return e=e||[],this.proved||!this.native&&n.prototype.isProved.call(this,e)||this.axiomatic||this.expr&&this.expr.isProved(e)},Schema.prototype.toString=function(){return this.toIndentedString(0)},Schema.prototype.toIndentedString=function(e){return this.native?`∫ ${this.name} <native>`:[`∫ ${this.name||""}(${this.params.map(t=>t.toIndentedString(e)).join(", ")}) => {`,"\t"+this.expr.toIndentedString(e+1),"}"].join("\n"+"\t".repeat(e))},Schema.prototype.toTeXString=function(e,t){if(!this.name)return this.precedence=this.PREC_FUNEXPR,[this.shouldConsolidate(e)?"\\left(":"",1==this.params.length?this.params[0].toTeXString():`\\left(${this.params.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}\\right)`,"\\mapsto "+this.expr.toTeXString(!1),this.shouldConsolidate(e)?"\\right)":""].join("");var r=`schema-${this.name}-${this.proved?"p":"np"}`;return t?this.native?`\\href{#${r}}{\\mathsf{${this.escapeTeX(this.name)}}}\\ (\\textrm{native})`:`\\href{#${r}}{\\mathsf{${this.escapeTeX(this.name)}}}(${this.params.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}):\\\\\\quad`+o.expandMetaAndFuncalls(this.expr).toTeXString(!0):`\\href{#${r}}\\mathsf{${this.escapeTeX(this.name)}}`},e.exports=Schema},function(e,t,r){var n=r(0),a=r(2);function MetaType(e){if(n.call(this),"boolean"!=typeof e.functional)throw this.error("typeof o.functional != 'boolean'");if(this.isFunctional=e.functional,this.isSimple=!e.functional,e.functional){if(e.from.some(e=>!(e instanceof a)))throw this.error("o.from.some(f => !(f instanceof Type))");if(!(e.to instanceof MetaType))throw this.error("!(o.to instanceof MetaType)");if(e.to.isFunctional)throw this.error("Functional metatype in functional metatype is not supported");this.from=e.from,this.to=e.to}else{if(!(e.left instanceof Array))throw this.error("left should be an array");this.left=e.left,this.right=e.right}}MetaType.prototype=Object.create(n.prototype),MetaType.prototype.constructor=MetaType,MetaType.prototype._type="metatype",MetaType.prototype.resolve=function(){return this},MetaType.prototype.toString=function(){return this.isSimple?`[${this.left.join(", ")} |- ${this.right}]`:`[${this.from.join(", ")} -> ${this.to}]`},MetaType.prototype.equals=function(e){if(!(e instanceof MetaType))return!1;if(this.isSimple!=e.isSimple)return!1;if(this.isSimple){if(this.left.length!=e.left.length)return!1;for(let t=0;t<this.left.length;t++)if(!this.left[t].equals(e.left[t]))return!1;return!!this.right.equals(e.right)}if(this.from.length!=e.from.length)return!1;for(let t=0;t<this.from.length;t++)if(!this.from[t].equals(e.from[t]))return!1;return this.to.equals(e.to)},e.exports=MetaType},function(e,t,r){var n=r(12),a=r(13);e.exports={parser:n,Program:a}},function(e,t,r){"use strict";function peg$SyntaxError(e,t,r,n){this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}!function peg$subclass(e,t){function ctor(){this.constructor=e}ctor.prototype=t.prototype,e.prototype=new ctor}(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(e,t){var r={literal:function(e){return'"'+literalEscape(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?classEscape(e.parts[t][0])+"-"+classEscape(e.parts[t][1]):classEscape(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function hex(e){return e.charCodeAt(0).toString(16).toUpperCase()}function literalEscape(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+hex(e)}))}function classEscape(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+hex(e)}))}return"Expected "+function describeExpected(e){var t,n,a,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(a=e[t],r[a.type](a));if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function describeFound(e){return e?'"'+literalEscape(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:peg$SyntaxError,parse:function peg$parse(e,t){t=void 0!==t?t:{};var r,n={},a={start:peg$parsestart},i=peg$parsestart,o="base",s=peg$literalExpectation("base",!1),p="type",l=peg$literalExpectation("type",!1),c=peg$literalExpectation(":",!1),u=peg$literalExpectation("@",!1),f=/^[a-z0-9_]/,h=peg$classExpectation([["a","z"],["0","9"],"_"],!1,!1),g="(",d=peg$literalExpectation("(",!1),m=",",y=peg$literalExpectation(",",!1),peg$c22=function(e,t,r,n,a,i){return i},$=")",_=peg$literalExpectation(")",!1),x="{",v=peg$literalExpectation("{",!1),w="}",T=peg$literalExpectation("}",!1),A="axiomatic",S=peg$literalExpectation("axiomatic",!1),b="native",C=peg$literalExpectation("native",!1),E="schema",P=peg$literalExpectation("schema",!1),peg$c41=function(e,t,r,n,a){return a},j="ruleset",M=peg$literalExpectation("ruleset",!1),O=peg$literalExpectation("?",!1),peg$c53=function(e,t,r){return r},F=peg$literalExpectation("[",!1),peg$c58=function(e,t,r,n){return n},peg$c59=function(e,t,r,n){return[r].concat(n)},R=peg$literalExpectation("]",!1),peg$c62=function(e,t,r){return r||[]},peg$c64=function(e,t,r){return r},peg$c68=function(e,t,r){return r},peg$c72=function(e,t){return t},peg$c73=function(e,t){return[e].concat(t)},peg$c74=function(e){return e||[]},k="=>",I=peg$literalExpectation("=>",!1),X=peg$literalExpectation("~",!1),peg$c82=function(e,t){return t},q=peg$literalExpectation("|-",!1),peg$c89=function(e,t){return t},N=peg$literalExpectation("->",!1),L=peg$literalExpectation(".",!1),U=/^[a-zA-Z0-9_]/,D=peg$classExpectation([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),Q='"',z=peg$literalExpectation('"',!1),B={type:"any"},H="$",Z=peg$literalExpectation("$",!1),G=peg$literalExpectation("#",!1),V=peg$literalExpectation("//",!1),J=peg$literalExpectation("/*",!1),K="*/",W=peg$literalExpectation("*/",!1),Y=peg$literalExpectation("\r\n",!1),ee=peg$literalExpectation("\r",!1),te=peg$literalExpectation("\n",!1),re=/^[ \t\n\r]/,ne=peg$classExpectation([" ","\t","\n","\r"],!1,!1),ae=peg$literalExpectation(";",!1),ie=0,oe=0,se=[{line:1,column:1}],pe=0,le=[],ce=0,ue={};if("startRule"in t){if(!(t.startRule in a))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=a[t.startRule]}function location(){return peg$computeLocation(oe,ie)}function peg$literalExpectation(e,t){return{type:"literal",text:e,ignoreCase:t}}function peg$classExpectation(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function peg$computePosDetails(t){var r,n=se[t];if(n)return n;for(r=t-1;!se[r];)r--;for(n={line:(n=se[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return se[t]=n,n}function peg$computeLocation(e,t){var r=peg$computePosDetails(e),n=peg$computePosDetails(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function peg$fail(e){ie<pe||(ie>pe&&(pe=ie,le=[]),le.push(e))}function peg$buildStructuredError(e,t,r){return new peg$SyntaxError(peg$SyntaxError.buildMessage(e,t),e,t,r)}function peg$parsestart(){var e,t,r,a,i=31*ie+0,o=ue[i];if(o)return ie=o.nextPos,o.result;if(e=ie,peg$parse_()!==n){for(t=[],r=ie,(a=peg$parseline())!==n&&peg$parse_()!==n?(oe=r,r=a=a):(ie=r,r=n);r!==n;)t.push(r),r=ie,(a=peg$parseline())!==n&&peg$parse_()!==n?(oe=r,r=a=a):(ie=r,r=n);t!==n?(oe=e,e=t):(ie=e,e=n)}else ie=e,e=n;return ue[i]={nextPos:ie,result:e},e}function peg$parseline(){var t,r=31*ie+1,a=ue[r];return a?(ie=a.nextPos,a.result):((t=function peg$parsetypedef(){var t,r,a,i,c,u,f,h=31*ie+2,g=ue[h];if(g)return ie=g.nextPos,g.result;t=ie,r=ie,(a=peg$parsedocumentation())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n);r===n&&(r=null);r!==n?(a=ie,e.substr(ie,4)===o?(i=o,ie+=4):(i=n,0===ce&&peg$fail(s)),i!==n&&(c=peg$parse__())!==n?a=i=[i,c]:(ie=a,a=n),a===n&&(a=null),a!==n?(e.substr(ie,4)===p?(i=p,ie+=4):(i=n,0===ce&&peg$fail(l)),i!==n&&(c=peg$parse__())!==n?(u=ie,(f=peg$parseftype())!==n&&peg$parse__()!==n?(oe=u,u=f=f):(ie=u,u=n),u===n&&(u=null),u!==n&&(f=peg$parseident())!==n&&peg$parse_()!==n&&peg$parsesem()!==n?(oe=t,m=a,y=u,$=f,t=r={_type:"typedef",doc:d=(d=r)&&d[0],base:!!m,origin:y,name:$,location:location()}):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n);var d,m,y,$;return ue[h]={nextPos:ie,result:t},t}())===n&&(t=function peg$parsedefv(){var e,t,r,a,i,o,s=31*ie+3,p=ue[s];if(p)return ie=p.nextPos,p.result;e=ie,t=ie,(r=peg$parsedocumentation())!==n&&(a=peg$parse__())!==n?t=r=[r,a]:(ie=t,t=n);t===n&&(t=null);t!==n?(r=ie,(a=peg$parsetex())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n),r===n&&(r=null),r!==n&&(a=peg$parsetype())!==n&&(i=peg$parse__())!==n&&(o=peg$parseident())!==n&&peg$parse_()!==n&&peg$parsesem()!==n?(oe=e,c=r,u=a,f=o,e=t={_type:"defv",doc:(l=t)&&l[0],tex:c&&c[0],type:u,name:f,location:location()}):(ie=e,e=n)):(ie=e,e=n);var l,c,u,f;return ue[s]={nextPos:ie,result:e},e}())===n&&(t=function peg$parsedefun(){var t,r,a,i,o,s,p,l,c,u,f,h,A,S,b,C=31*ie+6,E=ue[C];if(E)return ie=E.nextPos,E.result;t=ie,r=ie,(a=peg$parsedocumentation())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n);r===n&&(r=null);if(r!==n)if(a=ie,(i=peg$parsetex())!==n&&(o=peg$parse__())!==n?a=i=[i,o]:(ie=a,a=n),a===n&&(a=null),a!==n)if((i=peg$parsetype())!==n)if((o=peg$parse__())!==n)if((s=peg$parseident())!==n)if(peg$parse_()!==n){if(p=ie,40===e.charCodeAt(ie)?(l=g,ie++):(l=n,0===ce&&peg$fail(d)),l!==n)if((c=peg$parse_())!==n){if(u=ie,(f=peg$parsedefparam())!==n)if(peg$parse_()!==n){for(h=[],A=ie,44===e.charCodeAt(ie)?(S=m,ie++):(S=n,0===ce&&peg$fail(y)),S!==n&&peg$parse_()!==n&&(b=peg$parsedefparam())!==n&&peg$parse_()!==n?(oe=A,A=S=peg$c22(0,0,0,0,0,b)):(ie=A,A=n);A!==n;)h.push(A),A=ie,44===e.charCodeAt(ie)?(S=m,ie++):(S=n,0===ce&&peg$fail(y)),S!==n&&peg$parse_()!==n&&(b=peg$parsedefparam())!==n&&peg$parse_()!==n?(oe=A,A=S=peg$c22(0,0,0,0,0,b)):(ie=A,A=n);h!==n?(oe=u,u=f=[f].concat(h)):(ie=u,u=n)}else ie=u,u=n;else ie=u,u=n;u===n&&(u=null),u!==n?(41===e.charCodeAt(ie)?(f=$,ie++):(f=n,0===ce&&peg$fail(_)),f!==n&&peg$parse_()!==n?(oe=p,p=l=u||[]):(ie=p,p=n)):(ie=p,p=n)}else ie=p,p=n;else ie=p,p=n;p!==n?(l=ie,123===e.charCodeAt(ie)?(c=x,ie++):(c=n,0===ce&&peg$fail(v)),c!==n&&(u=peg$parse_())!==n&&(f=peg$parseexpr0())!==n&&peg$parse_()!==n?(125===e.charCodeAt(ie)?(h=w,ie++):(h=n,0===ce&&peg$fail(T)),h!==n?(oe=l,l=c=f):(ie=l,l=n)):(ie=l,l=n),l===n&&(l=ie,(c=peg$parsesem())!==n&&(oe=l,c=null),l=c),l!==n?(oe=t,t=r=function(e,t,r,n,a,i){return{_type:"defun",doc:e&&e[0],tex:t&&t[0],rettype:r,name:n,params:a,expr:i,location:location()}}(r,a,i,s,p,l)):(ie=t,t=n)):(ie=t,t=n)}else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;return ue[C]={nextPos:ie,result:t},t}())===n&&(t=function peg$parsedefruleset(){var t,r,a,i,o,s,p,l=31*ie+8,c=ue[l];if(c)return ie=c.nextPos,c.result;t=ie,r=ie,(a=peg$parsedocumentation())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n);r===n&&(r=null);r!==n?(a=ie,e.substr(ie,9)===A?(i=A,ie+=9):(i=n,0===ce&&peg$fail(S)),i!==n&&(o=peg$parse__())!==n?a=i=[i,o]:(ie=a,a=n),a===n&&(a=null),a!==n?(e.substr(ie,6)===b?(i=b,ie+=6):(i=n,0===ce&&peg$fail(C)),i!==n&&(o=peg$parse__())!==n?(e.substr(ie,7)===j?(s=j,ie+=7):(s=n,0===ce&&peg$fail(M)),s!==n&&peg$parse__()!==n&&(p=peg$parseident())!==n&&peg$parse_()!==n&&peg$parsesem()!==n?(oe=t,f=a,h=p,t=r={_type:"defruleset",doc:(u=r)&&u[0],axiomatic:!!f,name:h,native:!0,location:location()}):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n);var u,f,h;return ue[l]={nextPos:ie,result:t},t}())===n&&(t=function peg$parsedefschema(){var t,r,a,i,o,s,p,l,c,u,f,h,j,M,O,F=31*ie+7,R=ue[F];if(R)return ie=R.nextPos,R.result;t=ie,r=ie,(a=peg$parsedocumentation())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n);r===n&&(r=null);r!==n?(a=ie,e.substr(ie,9)===A?(i=A,ie+=9):(i=n,0===ce&&peg$fail(S)),i!==n&&(o=peg$parse__())!==n?a=i=[i,o]:(ie=a,a=n),a===n&&(a=null),a!==n?(e.substr(ie,6)===b?(i=b,ie+=6):(i=n,0===ce&&peg$fail(C)),i!==n&&(o=peg$parse__())!==n?(e.substr(ie,6)===E?(s=E,ie+=6):(s=n,0===ce&&peg$fail(P)),s!==n&&peg$parse__()!==n&&(p=peg$parseident())!==n&&(l=peg$parse_())!==n&&peg$parsesem()!==n?(oe=t,I=a,X=p,t=r={_type:"defschema",doc:(k=r)&&k[0],axiomatic:!!I,name:X,native:!0,location:location()}):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n);var k,I,X;if(t===n)if(t=ie,r=ie,(a=peg$parsedocumentation())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n),r===n&&(r=null),r!==n)if(a=ie,e.substr(ie,9)===A?(i=A,ie+=9):(i=n,0===ce&&peg$fail(S)),i!==n&&(o=peg$parse__())!==n?a=i=[i,o]:(ie=a,a=n),a===n&&(a=null),a!==n)if(e.substr(ie,6)===E?(i=E,ie+=6):(i=n,0===ce&&peg$fail(P)),i!==n)if((o=peg$parse__())!==n)if((s=peg$parseident())!==n)if(peg$parse_()!==n){if(p=ie,40===e.charCodeAt(ie)?(l=g,ie++):(l=n,0===ce&&peg$fail(d)),l!==n)if(peg$parse_()!==n){if(c=ie,(u=peg$parsedefschemaparam())!==n)if((f=peg$parse_())!==n){for(h=[],j=ie,44===e.charCodeAt(ie)?(M=m,ie++):(M=n,0===ce&&peg$fail(y)),M!==n&&peg$parse_()!==n&&(O=peg$parsedefschemaparam())!==n&&peg$parse_()!==n?(oe=j,j=M=peg$c41(0,0,0,0,O)):(ie=j,j=n);j!==n;)h.push(j),j=ie,44===e.charCodeAt(ie)?(M=m,ie++):(M=n,0===ce&&peg$fail(y)),M!==n&&peg$parse_()!==n&&(O=peg$parsedefschemaparam())!==n&&peg$parse_()!==n?(oe=j,j=M=peg$c41(0,0,0,0,O)):(ie=j,j=n);h!==n?(oe=c,c=u=[u].concat(h)):(ie=c,c=n)}else ie=c,c=n;else ie=c,c=n;c===n&&(c=null),c!==n?(41===e.charCodeAt(ie)?(u=$,ie++):(u=n,0===ce&&peg$fail(_)),u!==n&&(f=peg$parse_())!==n?(oe=p,p=l=c||[]):(ie=p,p=n)):(ie=p,p=n)}else ie=p,p=n;else ie=p,p=n;p!==n?(123===e.charCodeAt(ie)?(l=x,ie++):(l=n,0===ce&&peg$fail(v)),l!==n&&peg$parse_()!==n&&(c=peg$parsemetaexpr())!==n&&(u=peg$parse_())!==n?(125===e.charCodeAt(ie)?(f=w,ie++):(f=n,0===ce&&peg$fail(T)),f!==n?(oe=t,t=r=function(e,t,r,n,a){return{_type:"defschema",doc:e&&e[0],axiomatic:!!t,name:r,native:!1,params:n,expr:a,location:location()}}(r,a,s,p,c)):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)}else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;return ue[F]={nextPos:ie,result:t},t}()),ue[r]={nextPos:ie,result:t},t)}function peg$parsedefparam(){var e,t,r,a,i,o,s,p=31*ie+4,l=ue[p];return l?(ie=l.nextPos,l.result):(e=ie,t=ie,(r=peg$parsetex())!==n&&(a=peg$parse__())!==n?t=r=[r,a]:(ie=t,t=n),t===n&&(t=null),t!==n&&(r=peg$parsetype())!==n&&(a=peg$parse__())!==n&&(i=peg$parseident())!==n?(oe=e,s=i,e=t={_type:"defv",isParam:!0,type:r,tex:(o=t)&&o[0],name:s,location:location()}):(ie=e,e=n),ue[p]={nextPos:ie,result:e},e)}function peg$parsedefschemaparam(){var t,r,a,i,o,s,p,l,g,d,m,y,$,_=31*ie+5,x=ue[_];if(x)return ie=x.nextPos,x.result;if(t=ie,r=ie,(a=peg$parsetex())!==n&&(i=peg$parse__())!==n?r=a=[a,i]:(ie=r,r=n),r===n&&(r=null),r!==n)if((a=peg$parsetype())!==n)if((i=peg$parse__())!==n)if((o=peg$parseident())!==n){if(s=ie,peg$parse_()!==n)if(58===e.charCodeAt(ie)?(p=":",ie++):(p=n,0===ce&&peg$fail(c)),p!==n)if(peg$parse_()!==n)if(64===e.charCodeAt(ie)?(l="@",ie++):(l=n,0===ce&&peg$fail(u)),l!==n){if(g=ie,d=[],f.test(e.charAt(ie))?(m=e.charAt(ie),ie++):(m=n,0===ce&&peg$fail(h)),m!==n)for(;m!==n;)d.push(m),f.test(e.charAt(ie))?(m=e.charAt(ie),ie++):(m=n,0===ce&&peg$fail(h));else d=n;(g=d!==n?e.substring(g,ie):d)!==n?(oe=s,s=g):(ie=s,s=n)}else ie=s,s=n;else ie=s,s=n;else ie=s,s=n;else ie=s,s=n;s===n&&(s=null),s!==n?(oe=t,$=o,t=r={_type:"defv",isParam:!0,guess:s,type:a,tex:(y=r)&&y[0],name:$,location:location()}):(ie=t,t=n)}else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;else ie=t,t=n;return ue[_]={nextPos:ie,result:t},t}function peg$parsereduction(){var t,r,a,i,o,s,p,l,c,u,f,h,x,v,w,T,A=31*ie+9,S=ue[A];if(S)return ie=S.nextPos,S.result;if(t=ie,(r=peg$parseschemacall())===n&&(r=peg$parsevar())===n&&(r=ie,40===e.charCodeAt(ie)?(a=g,ie++):(a=n,0===ce&&peg$fail(d)),a!==n&&(i=peg$parse_())!==n&&(o=peg$parsemetaexpr())!==n&&(s=peg$parse_())!==n?(41===e.charCodeAt(ie)?(p=$,ie++):(p=n,0===ce&&peg$fail(_)),p!==n?(oe=r,r=a=o):(ie=r,r=n)):(ie=r,r=n)),r!==n)if((a=peg$parse_())!==n){if(i=ie,40===e.charCodeAt(ie)?(o=g,ie++):(o=n,0===ce&&peg$fail(d)),o!==n)if((s=peg$parse_())!==n){if(p=ie,l=ie,63===e.charCodeAt(ie)?(c="?",ie++):(c=n,0===ce&&peg$fail(O)),c!==n&&(oe=l,c=null),(l=c)===n&&(l=peg$parseexpr0()),l!==n)if((c=peg$parse_())!==n){for(u=[],f=ie,44===e.charCodeAt(ie)?(h=m,ie++):(h=n,0===ce&&peg$fail(y)),h!==n&&(x=peg$parse_())!==n?(v=ie,63===e.charCodeAt(ie)?(w="?",ie++):(w=n,0===ce&&peg$fail(O)),w!==n&&(oe=v,w=null),(v=w)===n&&(v=peg$parseexpr0()),v!==n&&(w=peg$parse_())!==n?(oe=f,f=h=peg$c53(0,0,v)):(ie=f,f=n)):(ie=f,f=n);f!==n;)u.push(f),f=ie,44===e.charCodeAt(ie)?(h=m,ie++):(h=n,0===ce&&peg$fail(y)),h!==n&&(x=peg$parse_())!==n?(v=ie,63===e.charCodeAt(ie)?(w="?",ie++):(w=n,0===ce&&peg$fail(O)),w!==n&&(oe=v,w=null),(v=w)===n&&(v=peg$parseexpr0()),v!==n&&(w=peg$parse_())!==n?(oe=f,f=h=peg$c53(0,0,v)):(ie=f,f=n)):(ie=f,f=n);u!==n?(oe=p,p=l=[l].concat(u)):(ie=p,p=n)}else ie=p,p=n;else ie=p,p=n;p===n&&(p=null),p!==n?(41===e.charCodeAt(ie)?(l=$,ie++):(l=n,0===ce&&peg$fail(_)),l!==n?(oe=i,i=o=p||[]):(ie=i,i=n)):(ie=i,i=n)}else ie=i,i=n;else ie=i,i=n;if(i===n&&(i=null),i!==n){if(o=[],s=ie,91===e.charCodeAt(ie)?(p="[",ie++):(p=n,0===ce&&peg$fail(F)),p!==n)if((l=peg$parse_())!==n){if(c=ie,(u=peg$parsemetaexpr())!==n)if((f=peg$parse_())!==n){for(h=[],x=ie,44===e.charCodeAt(ie)?(v=m,ie++):(v=n,0===ce&&peg$fail(y)),v!==n&&(w=peg$parse_())!==n&&(T=peg$parsemetaexpr())!==n&&peg$parse_()!==n?(oe=x,x=v=peg$c58(0,0,0,T)):(ie=x,x=n);x!==n;)h.push(x),x=ie,44===e.charCodeAt(ie)?(v=m,ie++):(v=n,0===ce&&peg$fail(y)),v!==n&&(w=peg$parse_())!==n&&(T=peg$parsemetaexpr())!==n&&peg$parse_()!==n?(oe=x,x=v=peg$c58(0,0,0,T)):(ie=x,x=n);h!==n?(oe=c,c=u=peg$c59(0,0,u,h)):(ie=c,c=n)}else ie=c,c=n;else ie=c,c=n;c===n&&(c=null),c!==n?(93===e.charCodeAt(ie)?(u="]",ie++):(u=n,0===ce&&peg$fail(R)),u!==n?(oe=s,s=p=peg$c62(0,0,c)):(ie=s,s=n)):(ie=s,s=n)}else ie=s,s=n;else ie=s,s=n;if(s!==n)for(;s!==n;)if(o.push(s),s=ie,91===e.charCodeAt(ie)?(p="[",ie++):(p=n,0===ce&&peg$fail(F)),p!==n)if((l=peg$parse_())!==n){if(c=ie,(u=peg$parsemetaexpr())!==n)if((f=peg$parse_())!==n){for(h=[],x=ie,44===e.charCodeAt(ie)?(v=m,ie++):(v=n,0===ce&&peg$fail(y)),v!==n&&(w=peg$parse_())!==n&&(T=peg$parsemetaexpr())!==n&&peg$parse_()!==n?(oe=x,x=v=peg$c58(0,0,0,T)):(ie=x,x=n);x!==n;)h.push(x),x=ie,44===e.charCodeAt(ie)?(v=m,ie++):(v=n,0===ce&&peg$fail(y)),v!==n&&(w=peg$parse_())!==n&&(T=peg$parsemetaexpr())!==n&&peg$parse_()!==n?(oe=x,x=v=peg$c58(0,0,0,T)):(ie=x,x=n);h!==n?(oe=c,c=u=peg$c59(0,0,u,h)):(ie=c,c=n)}else ie=c,c=n;else ie=c,c=n;c===n&&(c=null),c!==n?(93===e.charCodeAt(ie)?(u="]",ie++):(u=n,0===ce&&peg$fail(R)),u!==n?(oe=s,s=p=peg$c62(0,0,c)):(ie=s,s=n)):(ie=s,s=n)}else ie=s,s=n;else ie=s,s=n;else o=n;o!==n?(oe=t,t=r=function(e,t,r){for(var n={_type:"reduction",subject:e,guesses:t,leftargs:r[0],location:location()},a=1;a<r.length;a++)n={_type:"reduction",subject:n,guesses:null,leftargs:r[a],location:location()};return n}(r,i,o)):(ie=t,t=n)}else ie=t,t=n}else ie=t,t=n;else ie=t,t=n;return ue[A]={nextPos:ie,result:t},t}function peg$parseschemacall(){var t,r,a,i,o,s,p,l,c,u,f,h=31*ie+10,x=ue[h];if(x)return ie=x.nextPos,x.result;if(t=ie,(r=peg$parsevar())===n&&(r=ie,40===e.charCodeAt(ie)?(a=g,ie++):(a=n,0===ce&&peg$fail(d)),a!==n&&(i=peg$parse_())!==n&&(o=peg$parsemetaexpr())!==n&&peg$parse_()!==n?(41===e.charCodeAt(ie)?(s=$,ie++):(s=n,0===ce&&peg$fail(_)),s!==n?(oe=r,r=a=o):(ie=r,r=n)):(ie=r,r=n)),r!==n)if((a=peg$parse_())!==n){if(i=ie,40===e.charCodeAt(ie)?(o=g,ie++):(o=n,0===ce&&peg$fail(d)),o!==n)if(peg$parse_()!==n){if(s=ie,(p=peg$parseexpr0())!==n)if(peg$parse_()!==n){for(l=[],c=ie,44===e.charCodeAt(ie)?(u=m,ie++):(u=n,0===ce&&peg$fail(y)),u!==n&&peg$parse_()!==n&&(f=peg$parseexpr0())!==n&&peg$parse_()!==n?(oe=c,c=u=peg$c64(0,0,f)):(ie=c,c=n);c!==n;)l.push(c),c=ie,44===e.charCodeAt(ie)?(u=m,ie++):(u=n,0===ce&&peg$fail(y)),u!==n&&peg$parse_()!==n&&(f=peg$parseexpr0())!==n&&peg$parse_()!==n?(oe=c,c=u=peg$c64(0,0,f)):(ie=c,c=n);l!==n?(oe=s,s=p=[p].concat(l)):(ie=s,s=n)}else ie=s,s=n;else ie=s,s=n;s===n&&(s=null),s!==n?(41===e.charCodeAt(ie)?(p=$,ie++):(p=n,0===ce&&peg$fail(_)),p!==n?(oe=i,i=o=s||[]):(ie=i,i=n)):(ie=i,i=n)}else ie=i,i=n;else ie=i,i=n;i!==n?(oe=t,t=r={_type:"schemacall",schema:r,args:i,location:location()}):(ie=t,t=n)}else ie=t,t=n;else ie=t,t=n;return ue[h]={nextPos:ie,result:t},t}function peg$parsefuncall(){var t,r,a,i,o,s,p,l,c,u,f,h=31*ie+11,x=ue[h];if(x)return ie=x.nextPos,x.result;if(t=ie,(r=peg$parsevar())===n&&(r=ie,40===e.charCodeAt(ie)?(a=g,ie++):(a=n,0===ce&&peg$fail(d)),a!==n&&(i=peg$parse_())!==n&&(o=peg$parseexpr0())!==n&&peg$parse_()!==n?(41===e.charCodeAt(ie)?(s=$,ie++):(s=n,0===ce&&peg$fail(_)),s!==n?(oe=r,r=a=o):(ie=r,r=n)):(ie=r,r=n)),r!==n)if((a=peg$parse_())!==n){if(i=ie,40===e.charCodeAt(ie)?(o=g,ie++):(o=n,0===ce&&peg$fail(d)),o!==n)if(peg$parse_()!==n){if(s=ie,(p=peg$parseexpr0())!==n)if(peg$parse_()!==n){for(l=[],c=ie,44===e.charCodeAt(ie)?(u=m,ie++):(u=n,0===ce&&peg$fail(y)),u!==n&&peg$parse_()!==n&&(f=peg$parseexpr0())!==n&&peg$parse_()!==n?(oe=c,c=u=peg$c68(0,0,f)):(ie=c,c=n);c!==n;)l.push(c),c=ie,44===e.charCodeAt(ie)?(u=m,ie++):(u=n,0===ce&&peg$fail(y)),u!==n&&peg$parse_()!==n&&(f=peg$parseexpr0())!==n&&peg$parse_()!==n?(oe=c,c=u=peg$c68(0,0,f)):(ie=c,c=n);l!==n?(oe=s,s=p=[p].concat(l)):(ie=s,s=n)}else ie=s,s=n;else ie=s,s=n;s===n&&(s=null),s!==n?(41===e.charCodeAt(ie)?(p=$,ie++):(p=n,0===ce&&peg$fail(_)),p!==n?(oe=i,i=o=s||[]):(ie=i,i=n)):(ie=i,i=n)}else ie=i,i=n;else ie=i,i=n;i!==n?(oe=t,t=r={_type:"funcall",fun:r,args:i,location:location()}):(ie=t,t=n)}else ie=t,t=n;else ie=t,t=n;return ue[h]={nextPos:ie,result:t},t}function peg$parsefunexpr(){var t,r,a,i,o,s,p,l,c,u,f=31*ie+12,h=ue[f];if(h)return ie=h.nextPos,h.result;if(t=ie,r=ie,40===e.charCodeAt(ie)?(a=g,ie++):(a=n,0===ce&&peg$fail(d)),a!==n)if(peg$parse_()!==n){if(i=ie,(o=peg$parsedefparam())!==n)if((s=peg$parse_())!==n){for(p=[],l=ie,44===e.charCodeAt(ie)?(c=m,ie++):(c=n,0===ce&&peg$fail(y)),c!==n&&peg$parse_()!==n&&(u=peg$parsedefparam())!==n&&peg$parse_()!==n?(oe=l,l=c=peg$c72(0,u)):(ie=l,l=n);l!==n;)p.push(l),l=ie,44===e.charCodeAt(ie)?(c=m,ie++):(c=n,0===ce&&peg$fail(y)),c!==n&&peg$parse_()!==n&&(u=peg$parsedefparam())!==n&&peg$parse_()!==n?(oe=l,l=c=peg$c72(0,u)):(ie=l,l=n);p!==n?(oe=i,i=o=peg$c73(o,p)):(ie=i,i=n)}else ie=i,i=n;else ie=i,i=n;i===n&&(i=null),i!==n?(41===e.charCodeAt(ie)?(o=$,ie++):(o=n,0===ce&&peg$fail(_)),o!==n&&(s=peg$parse_())!==n?(oe=r,r=a=peg$c74(i)):(ie=r,r=n)):(ie=r,r=n)}else ie=r,r=n;else ie=r,r=n;return r!==n?(e.substr(ie,2)===k?(a=k,ie+=2):(a=n,0===ce&&peg$fail(I)),a!==n&&peg$parse_()!==n?(123===e.charCodeAt(ie)?(i=x,ie++):(i=n,0===ce&&peg$fail(v)),i!==n&&(o=peg$parse_())!==n&&(s=peg$parseexpr0())!==n&&(p=peg$parse_())!==n?(125===e.charCodeAt(ie)?(l=w,ie++):(l=n,0===ce&&peg$fail(T)),l!==n?(oe=t,t=r={_type:"funexpr",params:r,expr:s,location:location()}):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n),ue[f]={nextPos:ie,result:t},t}function peg$parseschemaexpr(){var t,r,a,i,o,s,p,l,c,u,f=31*ie+13,h=ue[f];if(h)return ie=h.nextPos,h.result;if(t=ie,r=ie,40===e.charCodeAt(ie)?(a=g,ie++):(a=n,0===ce&&peg$fail(d)),a!==n)if(peg$parse_()!==n){if(i=ie,(o=peg$parsedefparam())!==n)if((s=peg$parse_())!==n){for(p=[],l=ie,44===e.charCodeAt(ie)?(c=m,ie++):(c=n,0===ce&&peg$fail(y)),c!==n&&peg$parse_()!==n&&(u=peg$parsedefparam())!==n&&peg$parse_()!==n?(oe=l,l=c=peg$c72(0,u)):(ie=l,l=n);l!==n;)p.push(l),l=ie,44===e.charCodeAt(ie)?(c=m,ie++):(c=n,0===ce&&peg$fail(y)),c!==n&&peg$parse_()!==n&&(u=peg$parsedefparam())!==n&&peg$parse_()!==n?(oe=l,l=c=peg$c72(0,u)):(ie=l,l=n);p!==n?(oe=i,i=o=peg$c73(o,p)):(ie=i,i=n)}else ie=i,i=n;else ie=i,i=n;i===n&&(i=null),i!==n?(41===e.charCodeAt(ie)?(o=$,ie++):(o=n,0===ce&&peg$fail(_)),o!==n&&(s=peg$parse_())!==n?(oe=r,r=a=peg$c74(i)):(ie=r,r=n)):(ie=r,r=n)}else ie=r,r=n;else ie=r,r=n;return r!==n?(e.substr(ie,2)===k?(a=k,ie+=2):(a=n,0===ce&&peg$fail(I)),a!==n&&peg$parse_()!==n?(123===e.charCodeAt(ie)?(i=x,ie++):(i=n,0===ce&&peg$fail(v)),i!==n&&(o=peg$parse_())!==n&&(s=peg$parsemetaexpr())!==n&&(p=peg$parse_())!==n?(125===e.charCodeAt(ie)?(l=w,ie++):(l=n,0===ce&&peg$fail(T)),l!==n?(oe=t,t=r={_type:"schemaexpr",doc:!1,axiomatic:!1,name:null,params:r,expr:s,location:location()}):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n),ue[f]={nextPos:ie,result:t},t}function peg$parsemetaexpr(){var t,r,a,i,o,s,p=31*ie+14,l=ue[p];return l?(ie=l.nextPos,l.result):(t=ie,(r=peg$parsemetaexpr_internal_1())!==n&&peg$parse_()!==n?(126===e.charCodeAt(ie)?(a="~",ie++):(a=n,0===ce&&peg$fail(X)),a!==n&&peg$parse_()!==n&&(i=peg$parsemetaexpr())!==n?(oe=t,o=r,s=i,t=r={_type:"reduction",subject:{_type:"var",type:"normal",name:"cut",location:location()},leftargs:[o,s],location:location()}):(ie=t,t=n)):(ie=t,t=n),t===n&&(t=peg$parsemetaexpr_internal_1()),ue[p]={nextPos:ie,result:t},t)}function peg$parsemetaexpr_internal_1(){var t,r,a,i,o,s,p,l,c,u=31*ie+15,f=ue[u];if(f)return ie=f.nextPos,f.result;if(t=ie,r=ie,a=ie,(i=peg$parsemetaexpr_internal_2())!==n)if((o=peg$parse_())!==n){for(s=[],p=ie,44===e.charCodeAt(ie)?(l=m,ie++):(l=n,0===ce&&peg$fail(y)),l!==n&&peg$parse_()!==n&&(c=peg$parsemetaexpr_internal_2())!==n&&peg$parse_()!==n?(oe=p,p=l=peg$c82(0,c)):(ie=p,p=n);p!==n;)s.push(p),p=ie,44===e.charCodeAt(ie)?(l=m,ie++):(l=n,0===ce&&peg$fail(y)),l!==n&&peg$parse_()!==n&&(c=peg$parsemetaexpr_internal_2())!==n&&peg$parse_()!==n?(oe=p,p=l=peg$c82(0,c)):(ie=p,p=n);s!==n?(oe=a,a=i=peg$c73(i,s)):(ie=a,a=n)}else ie=a,a=n;else ie=a,a=n;return a===n&&(a=null),a!==n&&(oe=r,a=a||[]),(r=a)!==n?("|-"===e.substr(ie,2)?(a="|-",ie+=2):(a=n,0===ce&&peg$fail(q)),a!==n&&(i=peg$parse_())!==n&&(o=peg$parsemetaexpr_internal_1())!==n?(oe=t,t=r={_type:"tee",left:r,right:o,location:location()}):(ie=t,t=n)):(ie=t,t=n),t===n&&(t=peg$parsemetaexpr_internal_2()),ue[u]={nextPos:ie,result:t},t}function peg$parsemetaexpr_internal_2(){var t,r,a,i,o=31*ie+16,s=ue[o];return s?(ie=s.nextPos,s.result):((t=peg$parsereduction())===n&&(t=peg$parseschemacall())===n&&(t=peg$parsevar())===n&&(t=peg$parseschemaexpr())===n&&(t=ie,40===e.charCodeAt(ie)?(r=g,ie++):(r=n,0===ce&&peg$fail(d)),r!==n&&peg$parse_()!==n&&(a=peg$parsemetaexpr())!==n&&peg$parse_()!==n?(41===e.charCodeAt(ie)?(i=$,ie++):(i=n,0===ce&&peg$fail(_)),i!==n?(oe=t,t=r=a):(ie=t,t=n)):(ie=t,t=n)),ue[o]={nextPos:ie,result:t},t)}function peg$parseexpr0(){var t,r,a,i,o=31*ie+17,s=ue[o];return s?(ie=s.nextPos,s.result):((t=peg$parsefuncall())===n&&(t=peg$parsefunexpr())===n&&(t=peg$parsevar())===n&&(t=ie,40===e.charCodeAt(ie)?(r=g,ie++):(r=n,0===ce&&peg$fail(d)),r!==n&&peg$parse_()!==n&&(a=peg$parseexpr0())!==n&&peg$parse_()!==n?(41===e.charCodeAt(ie)?(i=$,ie++):(i=n,0===ce&&peg$fail(_)),i!==n?(oe=t,t=r=a):(ie=t,t=n)):(ie=t,t=n)),ue[o]={nextPos:ie,result:t},t)}function peg$parsetype(){var e,t=31*ie+18,r=ue[t];return r?(ie=r.nextPos,r.result):((e=function peg$parsestype(){var e,t,r=31*ie+19,a=ue[r];if(a)return ie=a.nextPos,a.result;e=ie,(t=peg$parseident())!==n&&(oe=e,t={_type:"type",ftype:!1,name:t,location:location()});return e=t,ue[r]={nextPos:ie,result:e},e}())===n&&(e=peg$parseftype()),ue[t]={nextPos:ie,result:e},e)}function peg$parseftype(){var t,r,a,i,o,s,p,l,c,u,f,h=31*ie+20,x=ue[h];if(x)return ie=x.nextPos,x.result;if(t=ie,91===e.charCodeAt(ie)?(r="[",ie++):(r=n,0===ce&&peg$fail(F)),r!==n)if(peg$parse_()!==n){if(a=ie,(i=peg$parsetype())!==n&&(oe=a,i=[i]),(a=i)===n){if(a=ie,i=ie,40===e.charCodeAt(ie)?(o=g,ie++):(o=n,0===ce&&peg$fail(d)),o!==n)if(peg$parse_()!==n)if((s=peg$parsetype())!==n){for(p=[],l=ie,(c=peg$parse_())!==n?(44===e.charCodeAt(ie)?(u=m,ie++):(u=n,0===ce&&peg$fail(y)),u!==n&&peg$parse_()!==n&&(f=peg$parsetype())!==n?(oe=l,l=c=peg$c89(0,f)):(ie=l,l=n)):(ie=l,l=n);l!==n;)p.push(l),l=ie,(c=peg$parse_())!==n?(44===e.charCodeAt(ie)?(u=m,ie++):(u=n,0===ce&&peg$fail(y)),u!==n&&peg$parse_()!==n&&(f=peg$parsetype())!==n?(oe=l,l=c=peg$c89(0,f)):(ie=l,l=n)):(ie=l,l=n);p!==n&&(l=peg$parse_())!==n?(41===e.charCodeAt(ie)?(c=$,ie++):(c=n,0===ce&&peg$fail(_)),c!==n?(oe=i,i=o=peg$c73(s,p)):(ie=i,i=n)):(ie=i,i=n)}else ie=i,i=n;else ie=i,i=n;else ie=i,i=n;i!==n&&(oe=a,i=i),a=i}a!==n&&(i=peg$parse_())!==n?("->"===e.substr(ie,2)?(o="->",ie+=2):(o=n,0===ce&&peg$fail(N)),o!==n&&peg$parse_()!==n&&(s=peg$parsetype())!==n&&(p=peg$parse_())!==n?(93===e.charCodeAt(ie)?(l="]",ie++):(l=n,0===ce&&peg$fail(R)),l!==n?(oe=t,t=r={_type:"type",ftype:!0,from:a,to:s,location:location()}):(ie=t,t=n)):(ie=t,t=n)):(ie=t,t=n)}else ie=t,t=n;else ie=t,t=n;return ue[h]={nextPos:ie,result:t},t}function peg$parsevar(){var t,r,a,i,o,s,p=31*ie+21,l=ue[p];return l?(ie=l.nextPos,l.result):(t=ie,r=ie,(a=peg$parseident())!==n&&peg$parse_()!==n?(46===e.charCodeAt(ie)?(i=".",ie++):(i=n,0===ce&&peg$fail(L)),i!==n&&peg$parse_()!==n?(oe=r,r=a=a):(ie=r,r=n)):(ie=r,r=n),r===n&&(r=null),r!==n&&(a=peg$parseident())!==n?(oe=t,s=a,t=r=(o=r)?{_type:"var",type:"ruleset",rulesetName:o,name:s,location:location()}:{_type:"var",type:"normal",name:s,location:location()}):(ie=t,t=n),ue[p]={nextPos:ie,result:t},t)}function peg$parseident(){var t,r,a,i,c,u,f=31*ie+23,h=ue[f];if(h)return ie=h.nextPos,h.result;if(t=ie,r=ie,a=ie,ce++,i=function peg$parsekeyword(){var t,r=31*ie+22,a=ue[r];return a?(ie=a.nextPos,a.result):(e.substr(ie,9)===A?(t=A,ie+=9):(t=n,0===ce&&peg$fail(S)),t===n&&(e.substr(ie,4)===o?(t=o,ie+=4):(t=n,0===ce&&peg$fail(s)),t===n&&(e.substr(ie,6)===b?(t=b,ie+=6):(t=n,0===ce&&peg$fail(C)),t===n&&(e.substr(ie,7)===j?(t=j,ie+=7):(t=n,0===ce&&peg$fail(M)),t===n&&(e.substr(ie,6)===E?(t=E,ie+=6):(t=n,0===ce&&peg$fail(P)),t===n&&(e.substr(ie,4)===p?(t=p,ie+=4):(t=n,0===ce&&peg$fail(l))))))),ue[r]={nextPos:ie,result:t},t)}(),ce--,i===n?a=void 0:(ie=a,a=n),a!==n){if(i=ie,c=[],U.test(e.charAt(ie))?(u=e.charAt(ie),ie++):(u=n,0===ce&&peg$fail(D)),u!==n)for(;u!==n;)c.push(u),U.test(e.charAt(ie))?(u=e.charAt(ie),ie++):(u=n,0===ce&&peg$fail(D));else c=n;(i=c!==n?e.substring(i,ie):c)!==n?r=a=[a,i]:(ie=r,r=n)}else ie=r,r=n;return t=r!==n?e.substring(t,ie):r,ue[f]={nextPos:ie,result:t},t}function peg$parsedocumentation(){var t,r,a,i,o,s,p=31*ie+24,l=ue[p];if(l)return ie=l.nextPos,l.result;if(t=ie,34===e.charCodeAt(ie)?(r=Q,ie++):(r=n,0===ce&&peg$fail(z)),r!==n){for(a=[],i=ie,o=ie,ce++,34===e.charCodeAt(ie)?(s=Q,ie++):(s=n,0===ce&&peg$fail(z)),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?(oe=i,i=o=s):(ie=i,i=n)):(ie=i,i=n);i!==n;)a.push(i),i=ie,o=ie,ce++,34===e.charCodeAt(ie)?(s=Q,ie++):(s=n,0===ce&&peg$fail(z)),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?(oe=i,i=o=s):(ie=i,i=n)):(ie=i,i=n);a!==n?(34===e.charCodeAt(ie)?(i=Q,ie++):(i=n,0===ce&&peg$fail(z)),i!==n?(oe=t,t=r=a.join("")):(ie=t,t=n)):(ie=t,t=n)}else ie=t,t=n;return ue[p]={nextPos:ie,result:t},t}function peg$parsetex(){var t,r,a,i,o,s,p,l=31*ie+25,c=ue[l];if(c)return ie=c.nextPos,c.result;if(t=ie,36===e.charCodeAt(ie)?(r=H,ie++):(r=n,0===ce&&peg$fail(Z)),r!==n){for(a=ie,i=[],o=ie,s=ie,ce++,36===e.charCodeAt(ie)?(p=H,ie++):(p=n,0===ce&&peg$fail(Z)),ce--,p===n?s=void 0:(ie=s,s=n),s!==n?(e.length>ie?(p=e.charAt(ie),ie++):(p=n,0===ce&&peg$fail(B)),p!==n?(oe=o,o=s=p):(ie=o,o=n)):(ie=o,o=n);o!==n;)i.push(o),o=ie,s=ie,ce++,36===e.charCodeAt(ie)?(p=H,ie++):(p=n,0===ce&&peg$fail(Z)),ce--,p===n?s=void 0:(ie=s,s=n),s!==n?(e.length>ie?(p=e.charAt(ie),ie++):(p=n,0===ce&&peg$fail(B)),p!==n?(oe=o,o=s=p):(ie=o,o=n)):(ie=o,o=n);(a=i!==n?e.substring(a,ie):i)!==n?(36===e.charCodeAt(ie)?(i=H,ie++):(i=n,0===ce&&peg$fail(Z)),i!==n?(oe=t,t=r=a):(ie=t,t=n)):(ie=t,t=n)}else ie=t,t=n;return ue[l]={nextPos:ie,result:t},t}function peg$parsecomment(){var t,r,a,i,o,s,p=31*ie+26,l=ue[p];if(l)return ie=l.nextPos,l.result;if(t=ie,35===e.charCodeAt(ie)?(r="#",ie++):(r=n,0===ce&&peg$fail(G)),r!==n){for(a=[],i=ie,o=ie,ce++,s=peg$parsenewline(),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?i=o=[o,s]:(ie=i,i=n)):(ie=i,i=n);i!==n;)a.push(i),i=ie,o=ie,ce++,s=peg$parsenewline(),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?i=o=[o,s]:(ie=i,i=n)):(ie=i,i=n);a!==n&&(i=peg$parse_())!==n?t=r=[r,a,i]:(ie=t,t=n)}else ie=t,t=n;if(t===n){if(t=ie,"//"===e.substr(ie,2)?(r="//",ie+=2):(r=n,0===ce&&peg$fail(V)),r!==n){for(a=[],i=ie,o=ie,ce++,s=peg$parsenewline(),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?i=o=[o,s]:(ie=i,i=n)):(ie=i,i=n);i!==n;)a.push(i),i=ie,o=ie,ce++,s=peg$parsenewline(),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?i=o=[o,s]:(ie=i,i=n)):(ie=i,i=n);a!==n&&(i=peg$parse_())!==n?t=r=[r,a,i]:(ie=t,t=n)}else ie=t,t=n;if(t===n)if(t=ie,"/*"===e.substr(ie,2)?(r="/*",ie+=2):(r=n,0===ce&&peg$fail(J)),r!==n){for(a=[],i=ie,o=ie,ce++,e.substr(ie,2)===K?(s=K,ie+=2):(s=n,0===ce&&peg$fail(W)),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?i=o=[o,s]:(ie=i,i=n)):(ie=i,i=n);i!==n;)a.push(i),i=ie,o=ie,ce++,e.substr(ie,2)===K?(s=K,ie+=2):(s=n,0===ce&&peg$fail(W)),ce--,s===n?o=void 0:(ie=o,o=n),o!==n?(e.length>ie?(s=e.charAt(ie),ie++):(s=n,0===ce&&peg$fail(B)),s!==n?i=o=[o,s]:(ie=i,i=n)):(ie=i,i=n);a!==n?(e.substr(ie,2)===K?(i=K,ie+=2):(i=n,0===ce&&peg$fail(W)),i!==n&&(o=peg$parse_())!==n?t=r=[r,a,i,o]:(ie=t,t=n)):(ie=t,t=n)}else ie=t,t=n}return ue[p]={nextPos:ie,result:t},t}function peg$parsenewline(){var t,r=31*ie+27,a=ue[r];return a?(ie=a.nextPos,a.result):("\r\n"===e.substr(ie,2)?(t="\r\n",ie+=2):(t=n,0===ce&&peg$fail(Y)),t===n&&(13===e.charCodeAt(ie)?(t="\r",ie++):(t=n,0===ce&&peg$fail(ee)),t===n&&(10===e.charCodeAt(ie)?(t="\n",ie++):(t=n,0===ce&&peg$fail(te)))),ue[r]={nextPos:ie,result:t},t)}function peg$parse_(){var t,r,a=31*ie+28,i=ue[a];if(i)return ie=i.nextPos,i.result;for(t=[],re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=n,0===ce&&peg$fail(ne)),r===n&&(r=peg$parsecomment());r!==n;)t.push(r),re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=n,0===ce&&peg$fail(ne)),r===n&&(r=peg$parsecomment());return ue[a]={nextPos:ie,result:t},t}function peg$parse__(){var t,r,a=31*ie+29,i=ue[a];if(i)return ie=i.nextPos,i.result;if(t=[],re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=n,0===ce&&peg$fail(ne)),r===n&&(r=peg$parsecomment()),r!==n)for(;r!==n;)t.push(r),re.test(e.charAt(ie))?(r=e.charAt(ie),ie++):(r=n,0===ce&&peg$fail(ne)),r===n&&(r=peg$parsecomment());else t=n;return ue[a]={nextPos:ie,result:t},t}function peg$parsesem(){var t,r=31*ie+30,a=ue[r];return a?(ie=a.nextPos,a.result):(59===e.charCodeAt(ie)?(t=";",ie++):(t=n,0===ce&&peg$fail(ae)),ue[r]={nextPos:ie,result:t},t)}if((r=i())!==n&&ie===e.length)return r;throw r!==n&&ie<e.length&&peg$fail({type:"end"}),peg$buildStructuredError(le,pe<e.length?e.charAt(pe):null,pe<e.length?peg$computeLocation(pe,pe+1):peg$computeLocation(pe,pe))}}},function(e,t,r){"use strict";var n=r(14),a=r(2),i=r(3),o=r(4),s=r(6),p=r(7),l=r(8),c=r(9),u=r(5),f=r(17),h=r(1);h.init({Type:a,Typevar:i,Fun:o,Funcall:s,Tee:p,Ruleset:l,Schema:c,Schemacall:u});class Program{constructor(){this.scope=new n(null)}feed(e,t){e.forEach(e=>{switch(e._type){case"typedef":var r=f.type(e,this.scope);if(this.scope.hasType(r.name))throw r.scope.error(`Type ${r.name} has already been declared`);this.scope.addType(r);break;case"defv":var n=f.typevar(e,this.scope);if(this.scope.hasTypevar(n.name))throw n.scope.error(`Definition ${n.name} has already been declared`);this.scope.addTypevar(n);break;case"defun":var a=f.fun(e,this.scope);if(this.scope.hasTypevar(a.name))throw a.scope.error(`Definition ${a.name} has already been declared`);this.scope.addFun(a);break;case"defruleset":var i=f.ruleset(e,this.scope,t);if(this.scope.hasRuleset(i.name))throw i.scope.error(`Ruleset ${i.name} has already been declared`);this.scope.addRuleset(i);break;case"defschema":var o=f.schema(e,this.scope,t);if(this.scope.hasSchema(o.name))throw o.scope.error(`Schema ${o.name} has already been declared`);this.scope.addSchema(o);break;default:throw Error("Unknown line type "+e._type)}})}}Program.prototype.ExpressionResolver=h,e.exports=Program},function(e,t,r){"use strict";var n=r(2),a=r(3),i=r(4),o=r(6),s=r(7),p=r(8),l=r(9),c=r(5),u=r(15);function Scope(e,t){if(this.typedefMap={},this.defMap={},this.schemaMap={},this.rulesetMap={},this.Type=n,this.Typevar=a,this.Fun=i,this.Funcall=o,this.Tee=s,this.Ruleset=p,this.Schema=l,this.Schemacall=c,this.parent=e,this.root=e?e.root:this,t&&!(t instanceof u))throw Error("Assertion failed");this.trace=t||new u,this.baseType=e?e.baseType:null}Scope.prototype.extend=function(e,t,r){return new Scope(this,this.trace.extend(e,t,r))},Scope.prototype.error=function(e){return this.trace.error(e)},Scope.prototype.hasOwnType=function(e){if("string"==typeof e)return!!this.typedefMap[e];if(!(e instanceof Array))throw this.error("Argument is malformed");if(e.length<2)throw this.error("Illegal array length");return e.map(e=>this.hasOwnType(e)).every(e=>e)},Scope.prototype.hasType=function(e){if("string"==typeof e)return this.hasOwnType(e)||!!this.parent&&this.parent.hasType(e);if(!(e instanceof Array))throw this.error("Argument is malformed");if(e.length<2)throw this.error("Illegal array length");return e.map(e=>this.hasType(e)).every(e=>e)},Scope.prototype.addType=function(e){if(!(e instanceof n))throw this.error("Illegal argument type");if(!e.name)throw this.error("Something's wrong");if(this.hasOwnType(e.name))throw this.error(`Type ${e.name} has already been declared`);if(e.isBaseType){if(this.baseType)throw this.error("A base type already exists");!function broadcast(t){t.baseType=e,t.parent&&broadcast(t.parent)}(this)}return this.typedefMap[e.name]=e},Scope.prototype.getType=function(e){if("string"==typeof e){if(!this.hasType(e))throw this.error(`Type ${e} is not defined`);return this.typedefMap[e]||!!this.parent&&this.parent.getType(e)}if(!(e instanceof Array))throw this.error("Argument is malformed");if(e.length<2)throw this.error("Illegal array length");var t=e.slice(0,e.length-1).map(e=>this.getType(e)),r=this.getType(e[e.length-1]);return new n({functional:!0,from:t,to:r})},Scope.prototype.hasOwnTypevar=function(e){return!!this.defMap[e]},Scope.prototype.hasTypevar=function(e){return this.hasOwnTypevar(e)||!!this.parent&&this.parent.hasTypevar(e)},Scope.prototype.addTypevar=function(e){if(!(e instanceof a))throw this.error("Illegal argument type");if(this.hasOwnTypevar(e.name))throw this.error(`Definition ${e.name} has already been declared`);return this.defMap[e.name]=e},Scope.prototype.addFun=function(e){if(!(e instanceof i))throw this.error("Illegal argument type");if(!e.name)throw this.error("Cannot add anonymous fun to scope");if(this.hasOwnTypevar(e.name))throw this.error(`Definition ${e.name} has already been declared`);return this.defMap[e.name]=e},Scope.prototype.getTypevar=function(e){if(!this.hasTypevar(e))throw this.error(`Definition ${e} is not defined`);return this.defMap[e]||!!this.parent&&this.parent.getTypevar(e)},Scope.prototype.hasOwnRuleset=function(e){return!!this.rulesetMap[e]},Scope.prototype.hasRuleset=function(e){return this.hasOwnRuleset(e)||!!this.parent&&this.parent.hasRuleset(e)},Scope.prototype.addRuleset=function(e){if(!(e instanceof p))throw this.error("Illegal argument type");if(this.hasOwnRuleset(e.name))throw this.error(`Ruleset ${e.name} has already been declared`);return this.rulesetMap[e.name]=e},Scope.prototype.getRuleset=function(e){if(!this.hasRuleset(e))throw this.error(`Ruleset ${e} is not defined`);return this.rulesetMap[e]||!!this.parent&&this.parent.getRuleset(e)},Scope.prototype.hasOwnSchema=function(e){return!!this.schemaMap[e]||!!this.defMap[e]},Scope.prototype.hasSchema=function(e){return this.hasOwnSchema(e)||!!this.parent&&this.parent.hasSchema(e)},Scope.prototype.addSchema=function(e){if(!(e instanceof l))throw this.error("Illegal argument type");if(this.hasOwnSchema(e.name))throw this.error(`Schema ${e.name} has already been declared`);return this.schemaMap[e.name]=e},Scope.prototype.getSchema=function(e){if(!this.hasSchema(e))throw this.error(`Schema ${e} is not defined`);return this.schemaMap[e]||this.defMap[e]||!!this.parent&&this.parent.getSchema(e)},e.exports=Scope},function(e,t,r){"use strict";(function(t){function StackTrace(e){this.stack=e||[]}StackTrace.prototype.extend=function(e,t,r){return new StackTrace([[e,t,r]].concat(this.stack))},StackTrace.prototype.error=function(e){var r=void 0!==t&&t.argv[2];return new Error(e+"\n\tat "+(this.stack.length?this.stack.map(([e,t,n])=>`${e} ${t||"<anonymous>"} (${r||"<unknown>"}:${n.start.line}:${n.start.column})`).join("\n\tat "):`<root> (${r||"<unknown>"}:1:1)`))},e.exports=StackTrace}).call(this,r(16))},function(e,t){var r,n,a=e.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(r===setTimeout)return setTimeout(e,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){r=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var i,o=[],s=!1,p=-1;function cleanUpNextTick(){s&&i&&(s=!1,i.length?o=i.concat(o):p=-1,o.length&&drainQueue())}function drainQueue(){if(!s){var e=runTimeout(cleanUpNextTick);s=!0;for(var t=o.length;t;){for(i=o,o=[];++p<t;)i&&i[p].run();p=-1,t=o.length}i=null,s=!1,function runClearTimeout(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new Item(e,t)),1!==o.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){var n=r(2),a=r(3),i=r(4),o=r(6),s=r(7),p=r(8),l=r(9),c=r(5),u=r(18),f=r(1),h={};function typeObjToString(e){if("type"!=e._type)throw Error("Assertion failed");return e.ftype?"["+e.from.map(typeObjToString).join(", ")+" -> "+typeObjToString(e.to)+"]":e.name}function typeObjToNestedArr(e){if("type"!=e._type)throw Error("Assertion failed");if(e.ftype){if(!e.from||!e.to)throw Error("Assertion failed");return e.from.map(typeObjToNestedArr).concat([typeObjToNestedArr(e.to)])}if(!e.name)throw Error("Assertion failed");return e.name}h.type=function(e,t){if("typedef"!=e._type)throw Error("Assertion failed");var r=t.extend("type",e.name,e.location),a=e.origin?r.getType(typeObjToNestedArr(e.origin)):null,i=e.name,o=e.doc,s=e.base;if(s&&a)throw r.error("Base type should not be an alias");return new n(a?{name:i,doc:o,base:s,origin:a}:{functional:!1,name:i,doc:o,base:s})},h.typevar=function(e,t){if(!["defv","var"].includes(e._type))throw Error("Assertion failed");var r=t.extend("typevar",e.name,e.location);if("var"==e._type){if(!r.hasTypevar(e.name))throw r.error("Undefined identifier "+e.name);return r.getTypevar(e.name)}if(!r.hasType(typeObjToNestedArr(e.type)))throw r.error(`Type ${typeObjToString(e.type)} is not defined`);var n=r.getType(typeObjToNestedArr(e.type));return new a({type:n,isParam:!!e.isParam,guess:e.guess||null,name:e.name,doc:e.doc,tex:e.tex},r)},h.fun=function(e,t){if("defun"!=e._type&&"funexpr"!=e._type)throw Error("Assertion failed");var r=t.extend("fun",e.name||null,e.location),a=e.name||null,o=null,s=e.params.map(e=>{if(!r.hasType(typeObjToNestedArr(e.type)))throw r.error(`Type ${typeObjToString(e.type)} is not defined`);var t=h.typevar(e,r);if(r.hasOwnTypevar(t.name))throw t.scope.error(`Parameter ${t.name} has already been declared`);return r.addTypevar(t)}),p=null,l=e.doc||null,c=e.tex||null;switch(e._type){case"defun":if(!r.hasType(typeObjToNestedArr(e.rettype)))throw r.error(`Type ${typeObjToString(e.rettype)} is not defined`);var u=r.getType(typeObjToNestedArr(e.rettype));if(e.expr){if(p=h.expr0(e.expr,r),!u.equals(p.type))throw r.error(`Expression type ${p.type} failed to match the return type ${u} of fun ${a}`)}else o=new n({functional:!0,from:s.map(e=>e.type),to:u});break;case"funexpr":p=h.expr0(e.expr,r),o=null;break;default:throw Error("wut")}return new i({name:a,type:o,params:s,expr:p,doc:l,tex:c},r)},h.funcall=function(e,t){if("funcall"!=e._type)throw Error("Assertion failed");var r=t.extend("funcall",e.fun.name||null,e.location),n=h.expr0(e.fun,r),a=e.args.map(e=>h.expr0(e,r));return new o({fun:n,args:a},r)},h.metaexpr=function(e,t){if(!["tee","reduction","schemacall","schemaexpr","var"].includes(e._type))throw Error("Assertion failed");var r=t;switch(e._type){case"tee":return h.tee(e,r);case"reduction":return h.reduction(e,r);case"schemacall":return h.schemacall(e,r);case"schemaexpr":return h.schema(e,r);case"var":return h.metavar(e,r);default:throw Error("wut")}},h.expr0=function(e,t){if(!["funcall","funexpr","var"].includes(e._type))throw console.log(e),Error("Assertion failed");var r=t;switch(e._type){case"funcall":return h.funcall(e,r);case"funexpr":return h.fun(e,r);case"var":return h.typevar(e,r);default:throw Error("wut")}},h.metavar=function(e,t){if("var"!=e._type)throw Error("Assertion failed");var r=t;switch(e.type){case"ruleset":if(!r.hasRuleset(e.rulesetName))throw r.error(`Ruleset ${e.rulesetName} is not defined`);var n=r.getRuleset(e.rulesetName);if(!n.native)throw r.error("Behavior undefined for non-native rulesets");var a=n.native.get(e.name,r);if(!a)throw r.error(`Schema ${function varObjToString(e){switch(e.type){case"ruleset":return`${e.rulesetName}.${e.name}`;case"normal":return""+e.name;default:throw Error("Unknown type "+e.type)}}(e)} is not defined`);return a;case"normal":if(!r.hasSchema(e.name))throw r.error(`Schema ${e.name} is not defined`);return r.getSchema(e.name);default:throw r.error("Unknown type "+e.type)}},h.tee=function(e,t){if("tee"!=e._type)throw Error("Assertion failed");var r=t.extend("tee",null,e.location),foo=e=>h.metaexpr(e,r),n=e.left.map(foo),a=foo(e.right);return new s({left:n,right:a},r)},h.schema=function(e,t,r){if("defschema"!=e._type&&"schemaexpr"!=e._type)throw Error("Assertion failed");var n=t.extend("schema",e.name,e.location),a=e.axiomatic,i=e.name;if(e.native){if(!r.schema[i])throw n.error(`Native code for native schema ${i} not found`);return new l({axiomatic:a,name:i,native:{get:e=>r.schema[i].get(e,n,f)},doc:e.doc},n)}var o=e.params.map(e=>{if(!n.hasType(typeObjToNestedArr(e.type)))throw n.error(`Type ${typeObjToString(e.type)} is not defined`);var t=h.typevar(e,n);if(n.hasOwnTypevar(t.name))throw t.scope.error(`Parameter ${t.name} has already been declared`);return n.addTypevar(t)}),s=h.metaexpr(e.expr,n);return new l({axiomatic:a,name:i,params:o,expr:s,doc:e.doc},n)},h.schemacall=function(e,t){if("schemacall"!=e._type)throw Error("Assertion failed");var r=t.extend("schemacall",e.schema.name||null,e.location),n=h.metaexpr(e.schema,r);if("type"==n.type._type)return h.funcall({_type:"funcall",fun:e.schema,args:e.args,location:e.location},t);var a=e.args.map(e=>h.expr0(e,r));return new c({schema:n,args:a},r)},h.ruleset=function(e,t,r){if("defruleset"!=e._type)throw Error("Assertion failed");var n=t.extend("ruleset",e.name,e.location),a=e.axiomatic,i=e.name;if(!e.native)throw n.error("Assertion failed");if(!r.ruleset[i])throw n.error(`Native code for native ruleset ${i} not found`);var o=r.ruleset[i];return new p({axiomatic:a,name:i,native:o,doc:e.doc},n)},h.reduction=function(e,t){if("reduction"!=e._type)throw Error("Assertion failed");var r=t.extend("reduction",e.subject.name||null,e.location),n=h.metaexpr(e.subject,r),a=e.guesses?e.guesses.map(e=>e&&h.expr0(e,r)):null,i=e.leftargs.map(e=>h.metaexpr(e,r));return new u({subject:n,guesses:a,leftargs:i},r)},e.exports=h},function(e,t,r){var n=r(0),a=r(5),i=r(1);function Reduction({subject:e,guesses:t,leftargs:r},o){if(n.call(this,o),e.native||"schema"!=e._type){if(t)throw this.error("Something's wrong")}else{e.params.forEach((e,r)=>{if(!(t&&t[r]||e.guess))throw this.error(`Argument #${r+1} could not be guessed`)});var s=e.params.map((n,a)=>t&&t[a]?t[a]:this.query(n.guess,i.expandMeta(e.expr).left,r));e=new a({schema:e,args:s},o)}if(!(e.native||"metatype"==e.type._type&&e.type.isSimple))throw this.error("Subject is not reducible");if(!(r instanceof Array)||r.map(e=>e instanceof n).some(e=>!e))throw this.error("Assertion failed");if(this.subject=e,this.leftargs=r,e.native)this.reduced=e.native.get(r),this.type=this.reduced.type;else{var p=e.type.left,l=r.map(e=>e.type);if(p.length!=l.length)throw this.error(`Invalid number of arguments (expected ${p.length}): ${l.length}`);for(let e=0;e<p.length;e++)if(!p[e].equals(l[e]))throw this.error(`Illegal argument type (expected ${p[e]}): ${l[e]}`);this.type=e.type.right;var c=i.expandMetaAndFuncalls(e);if("tee"!=c._type)throw this.error("Assertion failed");for(let e=0;e<c.left.length;e++)if(!i.equals(c.left[e],r[e]))throw this.error(`LHS #${e+1} failed to match:\n\n--- EXPECTED ---\n${i.expandMetaAndFuncalls(c.left[e])}\n----------------\n\n--- RECEIVED ---\n${i.expandMetaAndFuncalls(r[e])}\n----------------`);this.reduced=c.right}}Reduction.prototype=Object.create(n.prototype),Reduction.prototype.constructor=Reduction,Reduction.prototype._type="reduction",Reduction.prototype.isProved=function(e){return e=e||[],n.prototype.isProved.call(this,e)||this.subject.isProved(e)&&this.leftargs.every(t=>t.isProved(e))},Reduction.prototype.query=function(e,t,r){if(0==e.length)throw this.error("wut");if(!(1<=1*e[0]&&1*e[0]<=r.length))throw this.error(`Cannot dereference @${e}: antecedent index out of range`);var n=t[1*e[0]-1],a=r[1*e[0]-1],o=this;return function recurse(e,t,r,n){if(r=i.expandMetaAndFuncalls(r),e.length<=n)return r;if(/[0-9]/.test(e[n])){var a=1*e[n];if("tee"==t._type&&"tee"==r._type){if(t.left.length!=r.left.length)throw o.error(`Cannot dereference @${e}: antecedent length mismatch`);if(!(1<=a&&a<=r.left.length))throw o.error(`Cannot dereference @${e}: antecedent index out of range`);return recurse(e,t.left[a-1],r.left[a-1],n+1)}for(;;){if(!t.fun||!r.fun)throw o.error("Cannot dereference @"+e);if(i.equals(t.fun,r.fun))break;if(!r.fun.expr)throw o.error("Cannot dereference @"+e);r=i.expandCallOnce(r)}if(!r.args||!(1<=a&&a<=r.args.length))throw o.error("Cannot dereference @"+e);return recurse(e,t.args[a-1],r.args[a-1],n+1)}if("r"==e[n]){if("tee"==t._type&&"tee"==r._type)return recurse(e,t.right,r.right,n+1);throw o.error("Cannot dereference @"+e)}throw o.error("Cannot dereference @"+e)}(e,n,a,1)},Reduction.prototype.toString=function(){return this.toIndentedString(0)},Reduction.prototype.toIndentedString=function(e){var t=this.leftargs.map(t=>t.toIndentedString(e+1));return t.join("").length<=50?(t=(t=this.leftargs.map(t=>t.toIndentedString(e))).join(", "),[this.subject.toIndentedString(e)+"[",t,"]"].join("")):(t=t.join(",\n"+"\t".repeat(e+1)),[this.subject.toIndentedString(e)+"[","\t"+t,"]"].join("\n"+"\t".repeat(e)))},Reduction.prototype.toTeXString=function(e,t){return`${this.subject.toTeXString(!1)}[${this.leftargs.map(e=>e.toTeXString(this.PREC_COMMA)).join(", ")}]`},e.exports=Reduction}]);